
take note of this context, how c
Delete School Components by Subject ID
Fixing School Management System Grade Issues
Add Edit Functionality to Student Profile
Fixing Student Performance Card Component Issues
OptiScaler Setup for Assetto Corsa Issues
take note of this chat context
PGNLA SITE
Kompare
Fix yay libalpm.so.15 error reinstall
Unlink Steam Account for Bloodstrike Main Linking
what gt3 cars can I drive in the
Developing School Website Cost and Scope
Generate SSH Key for Private Repository
Elementary STEM Engineering Curriculum Guide
PS4 Controller MFD for Assetto Corsa
Fix Kitty delay in Hyprland terminal
I want to create an app for asse
Creating Pequenos Gigantes Website with Convex
Building Website for Pequenos Gigantes School
Create School Website with Convex Auth
Primary School Website Setup Guide
Creating HTML Website with Convex Backend
Assetto Corsa Content Manager Black Screen Fix
Set Laptop WiFi Card to Monitor Mode
Music Appreciation Presentation on Racing Tech
Adding 3D Model to Assetto Corsa Skin
Email Review for CPTR-321 Assignment Resubmission
Database Systems 9th Edition Citation Guide
Enterprise-Level Database Assignment Submission Review
Final Exam Answers for INFS428 Database
what will be my GPA if I get ano
Change Car Headlight Color to Pink
Install Wash on Arch Linux Guide
https://zsecurity.org/shop/?srsl
Dashboard Development for Fuel Division Metrics
Finding Matrix Inverse via Row Reduction
Guide to Creating File Type Identification Tool
Convex CLI Interactive Prompt Navigation Issue
Standard Error of 500ml Bottle Sample
Cover Letter for Pennacool Internship Application
Completed INFS428 Final Exam Answers Provided
Probability of Two Dice Summing to Four
Sezzle Software Engineer Interview Process Breakdown
Gym Course Transforms Health and Confidence
Git Commit Workflow from Installation to Push
Web Development and AI Project Ideas
Web Development Project Ideas and Tips
Setting Up Multiple Monitors in Hyprland
Creating Database System for Pet Store
Top 7 Developer Roles for 2025 Explained
Estimating W3Schools Website Size in GB
Creating and Selling AI Receptionists Guide
Convex NoSQL Database Implementation for Alumni Platform
Fixing Convex CLI Permission Denied Error
Database Assignment
Database to Convex Seed Data Migration
msg.txt
Global Alumni Engagement Platform Overview
Set Up Ollama Model Locally in VS Code
Implementing Product Search in Convex Database
Kendrick Lamar Concert Review for Assignment
Finding Matrix Inverse via Reduced Row Echelon
Initialize Tailwind CSS in Projects
Centered and Left-Aligned Div Layout Solution
Linear Algebra System Independence Analysis
HTML and CSS for ND Electronics Account Page
Free VSCode Chatbot Extensions Without Credits
Troubleshooting GitHub Authentication on Arch Linux
Git Push Error: Main Branch Issue Fix
Setting Up PostgreSQL for Flask App
Fix pgAdmin4 Data Directory Error
Force pip installation of pgadmin4 on Arch Linux
Fix DNS ModuleNotFoundError in Python Script
Screenshot Tools for Arch Linux Hyprland
Customizing Spotify with Spicetify Guide
Vector Span Check for Given Vector
Linear Combination Calculation Example
Adding Power Button Module to Waybar
Python Subdomain Enumeration and Asset Discovery Tool
Fixing pip install error in Arch Linux
Fix TypeError in Network Traffic Analyzer
Connect to WiFi with Username and Password
Top NoSQL Databases for Various Use Cases
Fix Python webview module error
Wireshark GUI Programming Languages and Toolkits
Best ThinkPad with backlit keyboard under $500
Fixing Asymmetrical Face with Comprehensive Guide
Waybar Battery Color Change Configuration Guide
JavaScript Guessing Game with Attempts
Prime Sum Checker with Prime List
Matrix Inverse and Cramer's Rule Practice
Eigenvalues and Eigenvectors Matrix Analysis Request
what time is the f1 mexico gp in
Question 1 (20 marks) Write a Ja
is sum += num the same as sum =
Fixing Auto-Complete in Arch Linux Code OSS
JavaScript Code for Sum and Prime Check
Sharing Access to Hugging Face Spaces Guide
Popular Apps Built with HTML/CSS/JS
Chrome Hearts Glasses Price Range Explained
Building a Website Business for Small Businesses
Python vs C++: Strengths and Use Cases
WiFi Password Cracking Tools for Linux Assignment
Testing Linear Dependence via RREF Method
Change Waybar Clock to 12-Hour Format
Arch Linux Network Connection Troubleshooting Guide
JavaScript Number Guessing Game Code
Refresh FastFetch on Arch Linux Guide
Running OneDrive on Arch Linux Guide
Install Steam on Arch Linux Guide
how can I add animations to my w
Add Laptop Brightness Buttons to Waybar
Image Editing Assistance and Tool Recommendations
University Database and Alumni Event ERD Design
Creating ER Diagrams in Figma Guide
Computer Generations and Interrupts Explained
View WiFi Devices Using CMD Commands
Eigenvalues and Eigenvectors Tutorial Solutions
Default Assist Preset in Content Manager
help
Matrix Characteristic Polynomial Calculation Explanation
Kali Linux软件源同步问题解决方案
Definitions of Fitness and Exercise Terms
Build Grocery Price Comparison App Guide
Write a 1–1.5 page essay explain
provide references for these def
Continuing Previous AI Chat Conversations
Ethics and Moral Philosophy Discussion
Ethics and Moral Life Discussion
Ethics and Moral Life Discussion Summary
Mrs. López Discusses Business Prices and Terms
APA Citation for AI in South African Manufacturing
Write a research paper follwing
Abortion and Stem Cell Research Ethics Discussion
Physician-Assisted Suicide and Euthanasia Analysis
Ethics of Reproductive Technologies Discussion
Venezuela's economic crisis amid COVID-19
Sexual Ethics and High School Counseling
Right Action, Harmful Consequences Explained
asnwer the following questions a
Embracing AI in Manufacturing Industry Proposal
here is all my code account.cpp
here is all my code account.cpp
Bank Management System Code Walkthrough Demo
Bank Management System Design and Reflection
Fixing C++ Bank App File and Loan Functions
Adding Deposit and Withdrawal to Customer Menu
You are tasked with designing an
did britain outlaw praising jesu
Holy Spirit's Role in Countering Postmodern Subjectivity
User Requests Straightforward Paragraph Answers
1. List and explain the various
Do the following in c++ Task: St
Satellite Internet Promotes Global Connectivity, Challenges
im about to send an essay, take
white a 5 page long PERSONAL REA
Assignment on Computer Memory P
Task: Create a full class diagra
answer questions 1 and 3 in what
Write a journal entry in in acco
take note of this context, how c
context.txt
TXT 279.01KB
take note of this context, how can I make it so that the admin side panel and staff panel still show on the account settings page
Length limit reached. DeepSeek can only read the first 80%.
Looking at your context, I can see the issue. The Account Settings page (/account) is a shared route for all roles, but it's currently outside the layout structures that include side panels. Here's how to fix this:

Solution 1: Wrap Account Settings in Role-Based Layouts
1. Update App.tsx to handle role-based layouts for the account page:
tsx
// In App.tsx
import { BrowserRouter, Routes, Route } from "react-router-dom";
import { useAuth } from "./hooks/useAuth"; // You'll need to move this or use a different approach

// ... other imports

// Create a wrapper component for role-based layouts
function RoleBasedAccountWrapper() {
  const { user, role } = useAuth();
  
  if (!user) return <Navigate to="/login" />;
  
  switch(role) {
    case "staff":
      return (
        <StaffLayout>
          <AccountSettings />
        </StaffLayout>
      );
    case "admin":
      return (
        <AdminLayout>
          <AccountSettings />
        </AdminLayout>
      );
    case "parent":
      return <AccountSettings />; // Parents might not need a side panel
    default:
      return <AccountSettings />;
  }
}

export default function App() {
  return (
    <BrowserRouter>
      <div className="min-h-screen flex flex-col">
        <ScrollToTop />
        <Navbar />
        <Routes>
          {/* Public Routes */}
          <Route path="/home" element={<Home />} />
          <Route path="/admissions" element={<Admissions />} />
          <Route path="/about" element={<About />} />
          <Route path="/calendar" element={<Calendar />} />
          <Route path="/contact" element={<Contact />} />
          <Route path="/financing" element={<Financing />} />
          <Route path="/login" element={<Login />} />
          <Route path="/registration" element={<Registration />} />
          <Route path="*" element={<Home />} />

          {/* Parent Routes */}
          <Route path="/parent-dashboard" element={<ParentDashboard />} />
          <Route path="/student/:studentId/grades" element={<GradesPage />} />
          <Route path="/parent/student/:studentId" element={<ParentStudentProfile />} />

          {/* Account Route - Now uses role-based layouts */}
          <Route path="/account" element={<RoleBasedAccountWrapper />} />

          {/* Staff Routes - uses StaffLayout with side panel */}
          <Route path="/staff" element={<StaffLayout />}>
            <Route index element={<StaffDashboard />} />
            <Route path="grades" element={<StaffGradesPage />} />
            <Route path="performance" element={<StudentPerformancePage />} />
            <Route path="performance/:studentId
here is my app.tsx

import { BrowserRouter, Routes, Route } from "react-router-dom";
import Navbar from "./components/Navbar";
import Home from "./pages/Home";
import Admissions from "./pages/Admissions";
import About from "./pages/About";
import Calendar from "./pages/Calendar";
import Contact from "./pages/Contact";
import Financing from "./pages/Financing";
import Login from "./pages/Login";
import Registration from "./pages/Registration";
import Footer from "./components/Footer";
import ParentDashboard from "./pages/ParentDashboard";
import GradesPage from "./pages/GradesPage";
import AccountSettings from "./pages/AccountSettings";
import StaffDashboard from "./pages/StaffDashboard";
import AdminDashboard from "./pages/AdminDashboard";
import AdminRegistrations from "./pages/AdminRegistrations";
import AdminRegistrationDetails from "./pages/AdminRegistrationDetails";
import ScrollToTop from "./components/ScrollToTop";
import AdminMessages from "./pages/AdminMessages";
import AdminLayout from "./components/AdminLayout";
import StaffLayout from "./pages/StaffLayout";
import StaffGradesPage from "./pages/StaffGradesPage";
import StudentPerformancePage from "./pages/StudentPerformancePage";
import StudentProfile from "./pages/StudentProfile";
import ParentStudentProfile from "./pages/ParentStudentProfile";

export default function App() {
  return (
    <BrowserRouter>
      <div className="min-h-screen flex flex-col">
        <ScrollToTop />
        <Navbar />
        <Routes>
          {/* Public Routes */}
          <Route path="/home" element={<Home />} />
          <Route path="/admissions" element={<Admissions />} />
          <Route path="/about" element={<About />} />
          <Route path="/calendar" element={<Calendar />} />
          <Route path="/contact" element={<Contact />} />
          <Route path="/financing" element={<Financing />} />
          <Route path="/login" element={<Login />} />
          <Route path="/registration" element={<Registration />} />
          <Route path="*" element={<Home />} />

          {/* Parent Routes */}
          <Route path="/parent-dashboard" element={<ParentDashboard />} />
          <Route path="/student/:studentId/grades" element={<GradesPage />} />
          <Route path="/parent/student/:studentId" element={<ParentStudentProfile />} />

          {/* Account Route (common for all roles) */}
          <Route path="/account" element={<AccountSettings />} />

          {/* Staff Routes - uses StaffLayout with side panel */}
          <Route path="/staff" element={<StaffLayout />}>
            <Route index element={<StaffDashboard />} />
            <Route path="grades" element={<StaffGradesPage />} />
            <Route path="performance" element={<StudentPerformancePage />} />
            <Route path="performance/:studentId" element={<StudentProfile />} />
            <Route path="account" element={<AccountSettings />} />
          </Route>

          {/* Admin Routes */}
          <Route path="/admin" element={<AdminDashboard />} />
          <Route
            path="/admin/registrations"
            element={
              <AdminLayout>
                <AdminRegistrations />
              </AdminLayout>
            }
          />
          <Route path="/admin/registrations/:id" element={<AdminRegistrationDetails />} />
          <Route path="/admin/messages" element={<AdminMessages />} />
          <Route path="account" element={<AccountSettings />} />
        </Routes>
        <Footer />
      </div>
    </BrowserRouter>
  );
}

my stafflayout.tsx
import { Outlet, Navigate } from "react-router-dom";
import { useAuth } from "../hooks/useAuth";
import StaffSidePanel from "../components/StaffSidePanel";
import { useState, useEffect } from "react";

export default function StaffLayout() {
  const { user, role, isLoading } = useAuth();
  const [isMobile, setIsMobile] = useState(false);

  // Check screen size
  useEffect(() => {
    const checkMobile = () => {
      setIsMobile(window.innerWidth < 768);
    };

    checkMobile();
    window.addEventListener('resize', checkMobile);
    return () => window.removeEventListener('resize', checkMobile);
  }, []);

  if (isLoading) return null;
  if (!user || role !== "staff") return <Navigate to="/login" />;

  return (
    <div className="flex flex-col md:flex-row min-h-screen bg-gray-50">
      {/* Side panel will handle its own responsive behavior */}
      <StaffSidePanel />

      {/* Main content area */}
      <main className={`flex-1 ${isMobile ? 'pt-0' : 'pt-0'} overflow-y-auto`}>
        <div className="p-4 md:p-6 lg:p-8">
          <Outlet />
        </div>
      </main>
    </div>
  );
}

change what needs to be changed based on this
Looking at your current structure, I can see the issue. The Account Settings page is defined in multiple places, but only the one inside /staff/account will show the staff side panel. Here's the solution:

1. Update App.tsx to remove duplicate /account route and fix admin routes:
tsx
import { BrowserRouter, Routes, Route } from "react-router-dom";
import Navbar from "./components/Navbar";
import Home from "./pages/Home";
import Admissions from "./pages/Admissions";
import About from "./pages/About";
import Calendar from "./pages/Calendar";
import Contact from "./pages/Contact";
import Financing from "./pages/Financing";
import Login from "./pages/Login";
import Registration from "./pages/Registration";
import Footer from "./components/Footer";
import ParentDashboard from "./pages/ParentDashboard";
import GradesPage from "./pages/GradesPage";
import AccountSettings from "./pages/AccountSettings";
import StaffDashboard from "./pages/StaffDashboard";
import AdminDashboard from "./pages/AdminDashboard";
import AdminRegistrations from "./pages/AdminRegistrations";
import AdminRegistrationDetails from "./pages/AdminRegistrationDetails";
import ScrollToTop from "./components/ScrollToTop";
import AdminMessages from "./pages/AdminMessages";
import AdminLayout from "./components/AdminLayout";
import StaffLayout from "./pages/StaffLayout";
import StaffGradesPage from "./pages/StaffGradesPage";
import StudentPerformancePage from "./pages/StudentPerformancePage";
import StudentProfile from "./pages/StudentProfile";
import ParentStudentProfile from "./pages/ParentStudentProfile";

export default function App() {
  return (
    <BrowserRouter>
      <div className="min-h-screen flex flex-col">
        <ScrollToTop />
        <Navbar />
        <Routes>
          {/* Public Routes */}
          <Route path="/home" element={<Home />} />
          <Route path="/admissions" element={<Admissions />} />
          <Route path="/about" element={<About />} />
          <Route path="/calendar" element={<Calendar />} />
          <Route path="/contact" element={<Contact />} />
          <Route path="/financing" element={<Financing />} />
          <Route path="/login" element={<Login />} />
          <Route path="/registration" element={<Registration />} />
          <Route path="*" element={<Home />} />

          {/* Parent Routes */}
          <Route path="/parent-dashboard" element={<ParentDashboard />} />
          <Route path="/student/:studentId/grades" element={<GradesPage />} />
          <Route path="/parent/student/:studentId" element={<ParentStudentProfile />} />

          {/* Staff Routes - uses StaffLayout with side panel */}
          <Route path="/staff" element={<StaffLayout />}>
            <Route index element={<StaffDashboard />} />
            <Route path="grades" element={<StaffGradesPage />} />
            <Route path="performance" element={<StudentPerformancePage />} />
            <Route path="performance/:studentId" element={<StudentProfile />} />
            <Route path="account" element={<AccountSettings />} />
          </Route>

          {/* Admin Routes - uses AdminLayout with side panel */}
          <Route path="/admin" element={<AdminLayout />}>
            <Route index element={<AdminDashboard />} />
            <Route path="registrations" element={<AdminRegistrations />} />
            <Route path="registrations/:id" element={<AdminRegistrationDetails />} />
            <Route path="messages" element={<AdminMessages />} />
            <Route path="account" element={<AccountSettings />} />
          </Route>

          {/* Fallback account route for other roles (parents, etc.) */}
          <Route path="/account" element={<AccountSettings />} />
        </Routes>
        <Footer />
      </div>
    </BrowserRouter>
  );
}
2. Create/Update AdminLayout.tsx (similar to StaffLayout):
tsx
// components/AdminLayout.tsx
import { Outlet, Navigate } from "react-router-dom";
import { useAuth } from "../hooks/useAuth";
import AdminSidePanel from "../components/AdminSidePanel";
import { useState, useEffect } from "react";

export default function AdminLayout() {
  const { user, role, isLoading } = useAuth();
  const [isMobile, setIsMobile] = useState(false);

  // Check screen size
  useEffect(() => {
    const checkMobile = () => {
      setIsMobile(window.innerWidth < 768);
    };

    checkMobile();
    window.addEventListener('resize', checkMobile);
    return () => window.removeEventListener('resize', checkMobile);
  }, []);

  if (isLoading) return null;
  if (!user || role !== "admin") return <Navigate to="/login" />;

  return (
    <div className="flex flex-col md:flex-row min-h-screen bg-gray-50">
      {/* Admin side panel */}
      <AdminSidePanel />

      {/* Main content area */}
      <main className={`flex-1 ${isMobile ? 'pt-0' : 'pt-0'} overflow-y-auto`}>
        <div className="p-4 md:p-6 lg:p-8">
          <Outlet />
        </div>
      </main>
    </div>
  );
}
3. Create AdminSidePanel.tsx (similar to StaffSidePanel):
tsx
// components/AdminSidePanel.tsx
import { NavLink, useLocation } from "react-router-dom";
import { useState, useEffect } from "react";

export default function AdminSidePanel() {
  const [isMobile, setIsMobile] = useState(false);
  const [isExpanded, setIsExpanded] = useState(false);
  const location = useLocation();

  // Check screen size
  useEffect(() => {
    const checkMobile = () => {
      const mobile = window.innerWidth < 768;
      setIsMobile(mobile);
      // On desktop, always expanded
      if (!mobile) {
        setIsExpanded(true);
      }
    };

    checkMobile();
    window.addEventListener('resize', checkMobile);
    return () => window.removeEventListener('resize', checkMobile);
  }, []);

  // Close mobile panel when route changes
  useEffect(() => {
    if (isMobile) {
      setIsExpanded(false);
    }
  }, [location.pathname, isMobile]);

  const linkClass = ({ isActive }: { isActive: boolean }) =>
    `block px-4 py-3 rounded-lg transition flex items-center gap-3 ${
      isActive
        ? "bg
here is my admin side bar, you can rename it to panel

import { NavLink } from "react-router-dom";
import { useAuth } from "../hooks/useAuth";

export default function AdminSidebar() {
  const { user, logout } = useAuth();

  if (!user || user.role !== "admin") return null;

  const linkClass = ({ isActive }: { isActive: boolean }) =>
    `flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition
     ${
       isActive
         ? "bg-primary-red text-white"
         : "text-gray-700 hover:bg-gray-100"
     }`;

  return (
    <aside className="w-64 min-h-screen bg-white border-r flex flex-col">
      {/* Logo */}
      <div className="px-6 py-6 border-b">
        <h1 className="text-xl font-bold text-primary-red">
          Admin Panel
        </h1>
        <p className="text-sm text-gray-500">
          Pequeños Gigantes
        </p>
      </div>

      {/* Navigation */}
      <nav className="flex-1 px-3 py-4 space-y-1">
        <NavLink to="/admin" className={linkClass}>
          <i className="fas fa-chart-line w-5"></i>
          Dashboard
        </NavLink>

        <NavLink to="/admin/registrations" className={linkClass}>
          <i className="fas fa-clipboard-list w-5"></i>
          Registrations
        </NavLink>

        <NavLink to="/admin/parents" className={linkClass}>
          <i className="fas fa-user-friends w-5"></i>
          Parents
        </NavLink>

        <NavLink to="/admin/staff" className={linkClass}>
          <i className="fas fa-chalkboard-teacher w-5"></i>
          Staff
        </NavLink>

        <NavLink to="/admin/messages" className={linkClass}>
          <i className="fas fa-envelope w-5"></i>
          Messages
        </NavLink>

        <NavLink to="/admin/settings" className={linkClass}>
          <i className="fas fa-cog w-5"></i>
          Settings
        </NavLink>
      </nav>

      {/* Footer */}
      <div className="border-t px-4 py-4">
        <div className="text-sm mb-3">
          <div className="font-semibold">{user.fullName}</div>
          <div className="text-gray-500">Administrator</div>
        </div>

        <button
          onClick={logout}
          className="w-full btn-secondary text-sm"
        >
          <i className="fas fa-sign-out-alt mr-2"></i>
          Logout
        </button>
      </div>
    </aside>
  );
}
Perfect! Now I'll help you make the admin sidebar mobile-responsive and update the structure so that the account settings page shows the appropriate side panel for each role. Here's the solution:

1. First, update AdminSidebar.tsx to be mobile-responsive (rename to AdminSidePanel.tsx):
tsx
// components/AdminSidePanel.tsx
import { NavLink, useLocation } from "react-router-dom";
import { useAuth } from "../hooks/useAuth";
import { useState, useEffect } from "react";

export default function AdminSidePanel() {
  const { user, logout } = useAuth();
  const [isMobile, setIsMobile] = useState(false);
  const [isExpanded, setIsExpanded] = useState(false);
  const location = useLocation();

  if (!user || user.role !== "admin") return null;

  // Check screen size
  useEffect(() => {
    const checkMobile = () => {
      const mobile = window.innerWidth < 768;
      setIsMobile(mobile);
      // On desktop, always expanded
      if (!mobile) {
        setIsExpanded(true);
      }
    };

    checkMobile();
    window.addEventListener('resize', checkMobile);
    return () => window.removeEventListener('resize', checkMobile);
  }, []);

  // Close mobile panel when route changes
  useEffect(() => {
    if (isMobile) {
      setIsExpanded(false);
    }
  }, [location.pathname, isMobile]);

  const linkClass = ({ isActive }: { isActive: boolean }) =>
    `flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition
     ${
       isActive
         ? "bg-primary-red text-white"
         : "text-gray-700 hover:bg-gray-100"
     }`;

  // Mobile toggle button
  if (isMobile) {
    return (
      <>
        {/* Mobile Toggle Button - Fixed at top */}
        <div className="sticky top-0 z-40 bg-white border-b border-gray-200 md:hidden">
          <button
            onClick={() => setIsExpanded(!isExpanded)}
            className="w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50"
          >
            <div className="flex items-center gap-3">
              <div className="w-8 h-8 rounded-full bg-primary-red flex items-center justify-center">
                <i className="fas fa-user-shield text-white text-sm"></i>
              </div>
              <span className="font-semibold text-gray-900">Admin Panel</span>
            </div>
            <i className={`fas fa-chevron-${isExpanded ? 'up' : 'down'} text-gray-500`}></i>
          </button>

          {/* Mobile Navigation Dropdown */}
          {isExpanded && (
            <div className="absolute top-full left-0 right-0 bg-white border-b border-gray-200 shadow-lg z-50">
              <nav className="p-3 space-y-1">
                <NavLink 
                  to="/admin" 
                  className={linkClass}
                  onClick={() => setIsExpanded(false)}
                >
                  <i className="fas fa-chart-line w-5"></i>
                  <span>Dashboard</span>
                </NavLink>

                <NavLink 
                  to="/admin/registrations" 
                  className={linkClass}
                  onClick={() => setIsExpanded(false)}
                >
                  <i className="fas fa-clipboard-list w-5"></i>
                  <span>Registrations</span>
                </NavLink>

                <NavLink 
                  to="/admin/messages" 
                  className={linkClass}
                  onClick={() => setIsExpanded(false)}
                >
                  <i className="fas fa-envelope w-5"></i>
                  <span>Messages</span>
                </NavLink>

                <NavLink 
                  to="/admin/account" 
                  className={linkClass}
                  onClick={() => setIsExpanded(false)}
                >
                  <i className="fas fa-cog w-5"></i>
                  <span>Account Settings</span>
                </NavLink>

                {/* Mobile Logout Button */}
                <button
                  onClick={() => {
                    logout();
                    setIsExpanded(false);
                  }}
                  className="w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium text-red-600 hover:bg-red-50"
                >
                  <i className="fas fa-sign-out-alt w-5"></i>
                  <span>Logout</span>
                </button>
              </nav>
            </div>
          )}
        </div>
      </>
    );
  }

  // Desktop Side Panel
  return (
    <aside className="w-64 min-h-screen bg-white border-r flex flex-col flex-shrink-0 hidden md:flex">
      {/* Logo */}
      <div className="px-6 py-6 border-b">
        <h1 className="text-xl font-bold text-primary-red">
          Admin Panel
        </h1>
        <p className="text-sm text-gray-500">
          Pequeños Gigantes
        </p>
      </div>

      {/* Navigation */}
      <nav className="flex-1 px-3 py-4 space-y-1">
        <NavLink to="/admin" className={linkClass}>
          <i className="fas fa-chart-line w-5"></i>
          Dashboard
        </NavLink>

        <NavLink to="/admin/registrations" className={linkClass}>
          <i className="fas fa-clipboard-list w-5"></i>
          Registrations
        </NavLink>

        <NavLink to="/admin/parents" className={linkClass}>
          <i className="fas fa-user-friends w-5"></i>
          Parents
        </NavLink>

        <NavLink to="/admin/staff" className={linkClass}>
          <i className="fas fa-chalkboard-teacher w-5"></i>
          Staff
        </NavLink>

        <NavLink to="/admin/messages" className={linkClass}>
          <i className="fas fa-envelope w-5"></i>
          Messages
        </NavLink>

        <NavLink to="/admin/account" className={linkClass}>
          <i className="fas fa-cog w-5"></i>
          Account Settings
        </NavLink>
      </nav>

      {/* Footer */}
      <div className="border-t px-4 py-4">
        <div className="text-sm mb-3">
          <div className="font-semibold">{user.fullName}</div>
          <div className="text-gray-500">Administrator</div>
        </div>

        <button
          onClick={logout}
          className="w-full btn-secondary text-sm"
        >
          <i className="fas fa-sign-out-alt mr-2"></i>
          Logout
        </button>
      </div>
    </aside>
  );
}
2. Update App.tsx with the correct routing structure:
tsx
import { BrowserRouter, Routes, Route } from "react-router-dom";
import Navbar from "./components/Navbar";
import Home from "./pages/Home";
import Admissions from "./pages/Admissions";
import About from "./pages/About";
import Calendar from "./pages/Calendar";
import Contact from "./pages/Contact";
import Financing from "./pages/Financing";
import Login from "./pages/Login";
import Registration from "./pages/Registration";
import Footer from "./components/Footer";
import ParentDashboard from "./pages/ParentDashboard";
import GradesPage from "./pages/GradesPage";
import AccountSettings from "./pages/AccountSettings";
import StaffDashboard from "./pages/StaffDashboard";
import AdminDashboard from "./pages/AdminDashboard";
import AdminRegistrations from "./pages/AdminRegistrations";
import AdminRegistrationDetails from "./pages/AdminRegistrationDetails";
import ScrollToTop from "./components/ScrollToTop";
import AdminMessages from "./pages/AdminMessages";
import AdminLayout from "./components/AdminLayout";
import StaffLayout from "./pages/StaffLayout";
import StaffGradesPage from "./pages/StaffGradesPage";
import StudentPerformancePage from "./pages/StudentPerformancePage";
import StudentProfile from "./pages/StudentProfile";
import ParentStudentProfile from "./pages/ParentStudentProfile";

export default function App() {
  return (
    <BrowserRouter>
      <div className="min-h-screen flex flex-col">
        <ScrollToTop />
        <Navbar />
        <Routes>
          {/* Public Routes */}
          <Route path="/home" element={<Home />} />
          <Route path="/admissions" element={<Admissions />} />
          <Route path="/about" element={<About />} />
          <Route path="/calendar" element={<Calendar />} />
          <Route path="/contact" element={<Contact />} />
          <Route path="/financing" element={<Financing />} />
          <Route path="/login" element={<Login />} />
          <Route path="/registration" element={<Registration />} />
          <Route path="*" element={<Home />} />

          {/* Parent Routes */}
          <Route path="/parent-dashboard" element={<ParentDashboard />} />
          <Route path="/student/:studentId/grades" element={<GradesPage />} />
          <Route path="/parent/student/:studentId" element={<ParentStudentProfile />} />

          {/* Staff Routes - uses StaffLayout with side panel */}
          <Route path="/staff" element={<StaffLayout />}>
            <Route index element={<StaffDashboard />} />
            <Route path="grades" element={<StaffGradesPage />} />
            <Route path="performance" element={<StudentPerformancePage />} />
            <Route path="performance/:studentId" element={<StudentProfile />} />
            <Route path="account" element={<AccountSettings />} />
          </Route>

          {/* Admin Routes - uses AdminLayout with side panel */}
          <Route path="/admin" element={<AdminLayout />}>
            <Route index element={<AdminDashboard />} />
            <Route path="registrations" element={<AdminRegistrations />} />
            <Route path="registrations/:id" element={<AdminRegistrationDetails />} />
            <Route path="messages" element={<AdminMessages />} />
            <Route path="parents" element={<>Parents Page - TODO</>} />
            <Route path="staff" element={<>Staff Management - TODO</>} />
            <Route path="settings" element={<>System Settings - TODO</>} />
            <Route path="account" element={<AccountSettings />} />
          </Route>

          {/* Fallback account route for parents and other roles */}
          <Route path="/account" element={<AccountSettings />} />
        </Routes>
        <Footer />
      </div>
    </BrowserRouter>
  );
}
3. Update StaffSidePanel.tsx to include Account Settings link:
Make sure your StaffSidePanel has the account settings link (it should already from our previous updates). If not, add this to the navigation:

tsx
// In StaffSidePanel.tsx navigation section
<NavLink to="/staff/account" className={linkClass}>
  <i className="fas fa-cog w-5"></i>
  <span>Account Settings</span>
</NavLink>
4. Update the AccountSettings component to handle being inside a layout:
You might want to adjust the AccountSettings page to account for the side panel layout:

tsx
// pages/AccountSettings.tsx
import { useAuth } from "../hooks/useAuth";
import { Navigate } from "react-router-dom";

export default function AccountSettings() {
  const { user, isLoading } = useAuth();

  if (isLoading) return null;
  if (!user) return <Navigate to="/login" />;

  return (
    <div className="max-w-4xl mx-auto">
      <h1 className="text-2xl md:text-3xl font-bold text-gray-900 mb-6">
        Account Settings
      </h1>
      
      {/* Your account settings form/content here */}
      <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
        <div className="mb-6">
          <h2 className="text-lg font-semibold text-gray-800 mb-2">
            Profile Information
          </h2>
          <p className="text-gray-600 text-sm">
            Update your account details and contact information.
          </p>
        </div>
        
        {/* Form fields would go here */}
        <div className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Full Name
            </label>
            <input
              type="text"
              className="w-full p-3 border border-gray-300 rounded-lg"
              value={user.fullName}
              readOnly
            />
          </div>
          
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Email
            </label>
            <input
              type="email"
              className="w-full p-3 border border-gray-300 rounded-lg"
              value={user.email}
              readOnly
            />
          </div>
          
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Role
            </label>
            <input
              type="text"
              className="w-full p-3 border border-gray-300 rounded-lg capitalize"
              value={user.role}
              readOnly
            />
          </div>
          
          {/* Add more account settings fields as needed */}
        </div>
      </div>
    </div>
  );
}
Key Points:
Staff Access: Go to /staff/account for staff side panel + account settings

Admin Access: Go to /admin/account for admin side panel + account settings

Parent Access: Go to /account for plain account settings (no side panel)

Mobile Responsive: Both side panels collapse to top on mobile

Consistent Navigation: Users stay within their respective layouts when accessing account settings

This structure ensures that when staff/admin users access their account settings, they remain within their familiar dashboard environment with the side panel visible.

create a page to manage staff and parent accounts for admins, for reference here is my old admin dashboard

import { useQuery } from "convex/react";
import { api } from "../../convex/_generated/api";
import { Navigate, Link } from "react-router-dom";
import { useAuth } from "../hooks/useAuth";
import { useState, useMemo } from "react";


type ViewMode = "parents" | "staff";

export default function AdminDashboard() {
  const { user, role, logout, isLoading } = useAuth();

  if (isLoading) return null;
  if (!user || role !== "admin") return <Navigate to="/login" />;

  const parents = useQuery(api.admin.listParents);
  const staff = useQuery(api.admin.listStaff);

  const [view, setView] = useState<ViewMode>("parents");
  const [search, setSearch] = useState("");

  const activeList = view === "parents" ? parents : staff;

  const filteredUsers = useMemo(() => {
    if (!activeList) return [];

    return activeList.filter((u) =>
      `${u.fullName} ${u.email}`
        .toLowerCase()
        .includes(search.toLowerCase())
    );
  }, [activeList, search]);

  return (
    <div className="container-wide px-4 py-10 space-y-8">
      {/* Header */}

      <header className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <h1 className="text-3xl font-bold">Admin Dashboard</h1>
          <p className="text-gray-600">
            Manage parents and staff accounts
          </p>


        </div>
      </header>

      <div className="flex gap-3 container-wide px-4 py-5 align-items-center">

        <Link
          to="/admin/registrations"
          className="btn-secondary border-color-red rounded-md p-6 hover:bg-red-50 transition group"
        >
          <div className="flex items-center justify-between">
            <div>
              <h3>Registrations</h3>
            </div>
          </div>
        </Link>

        <Link
          to="/admin/messages"
          className="btn-secondary border-color-red rounded-md p-6 hover:bg-red-50 transition group"
        >
          <div className="flex items-center justify-between">
            <div>
              <h3>Messages</h3>
            </div>
          </div>
        </Link>


        <button onClick={logout} className="btn-secondary">
          Logout
        </button>
        </div>



      {/* Tabs */}
      <div className="flex border-b">
        <button
          onClick={() => setView("parents")}
          className={`px-4 py-3 font-semibold border-b-2 ${view === "parents"
            ? "border-primary-red text-primary-red"
            : "border-transparent text-gray-500"
            }`}
        >
          Parents
        </button>

        <button
          onClick={() => setView("staff")}
          className={`px-4 py-3 font-semibold border-b-2 ${view === "staff"
            ? "border-primary-red text-primary-red"
            : "border-transparent text-gray-500"
            }`}
        >
          Staff
        </button>
      </div>

      {/* Search */}
      <div className="bg-white border rounded-xl p-4">
        <input
          type="text"
          placeholder={`Search ${view} by name or email…`}
          className="input w-full"
          value={search}
          onChange={(e) => setSearch(e.target.value)}
        />
      </div>

      {/* Results */}
      {activeList === undefined ? (
        <div>Loading {view}…</div>
      ) : filteredUsers.length === 0 ? (
        <div className="text-gray-600">
          No {view} match your search.
        </div>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {filteredUsers.map((u) => (
            <div
              key={u._id}
              className="border rounded-xl p-5 space-y-2"
            >
              <div>
                <h3 className="text-lg font-semibold">
                  {u.fullName}
                </h3>
                <p className="text-sm text-gray-600">
                  {u.email}
                </p>
              </div>

              <div className="text-sm">
                <span className="font-medium">Role:</span>{" "}
                {u.role}
              </div>

              <div className="text-sm">
                <span className="font-medium">Status:</span>{" "}
                {u.isActive ? "Active" : "Disabled"}
              </div>

              <div className="pt-3 flex gap-2">
                <button className="btn-secondary text-sm">
                  View
                </button>
                <button className="btn-secondary text-sm text-red-600">
                  Disable
                </button>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
}
I'll create a comprehensive staff and parent management page for admins. Based on your old admin dashboard, I'll create a new AdminManageAccounts.tsx page with enhanced features.

tsx
// pages/AdminManageAccounts.tsx
import { useQuery, useMutation } from "convex/react";
import { api } from "../../convex/_generated/api";
import { Navigate } from "react-router-dom";
import { useAuth } from "../hooks/useAuth";
import { useState, useMemo } from "react";
import { Id } from "../../convex/_generated/dataModel";

type ViewMode = "parents" | "staff";
type StatusFilter = "all" | "active" | "disabled";

interface UserAccount {
  _id: Id<"users">;
  fullName: string;
  email: string;
  role: "parent" | "staff" | "admin";
  isActive: boolean;
  createdAt: number;
  lastLogin?: number;
  // Additional fields for parents
  childrenCount?: number;
  // Additional fields for staff
  department?: string;
  position?: string;
}

export default function AdminManageAccounts() {
  const { user, role, isLoading } = useAuth();

  // State management
  const [view, setView] = useState<ViewMode>("parents");
  const [search, setSearch] = useState("");
  const [statusFilter, setStatusFilter] = useState<StatusFilter>("all");
  const [selectedUsers, setSelectedUsers] = useState<Set<string>>(new Set());
  const [bulkAction, setBulkAction] = useState<string>("");
  const [showCreateModal, setShowCreateModal] = useState(false);

  // Queries
  const parents = useQuery(api.admin.listParents);
  const staff = useQuery(api.admin.listStaff);
  
  // Mutations
  const toggleUserStatus = useMutation(api.admin.toggleUserStatus);
  const deleteUser = useMutation(api.admin.deleteUser);
  const updateUserRole = useMutation(api.admin.updateUserRole);
  const createStaffAccount = useMutation(api.admin.createStaffAccount);

  if (isLoading) return null;
  if (!user || role !== "admin") return <Navigate to="/login" />;

  // Process user data
  const processUsers = (users: any[] | undefined): UserAccount[] => {
    if (!users) return [];
    
    return users.map(user => ({
      ...user,
      childrenCount: user.children?.length || 0,
      createdAt: user._creationTime,
    }));
  };

  const parentsList = processUsers(parents);
  const staffList = processUsers(staff);
  const activeList = view === "parents" ? parentsList : staffList;

  // Filter and search
  const filteredUsers = useMemo(() => {
    if (!activeList) return [];

    return activeList.filter((u) => {
      // Search filter
      const matchesSearch = `${u.fullName} ${u.email} ${u.department || ''} ${u.position || ''}`
        .toLowerCase()
        .includes(search.toLowerCase());
      
      // Status filter
      let matchesStatus = true;
      if (statusFilter === "active") matchesStatus = u.isActive;
      if (statusFilter === "disabled") matchesStatus = !u.isActive;
      
      return matchesSearch && matchesStatus;
    });
  }, [activeList, search, statusFilter]);

  // Stats
  const stats = useMemo(() => {
    const list = view === "parents" ? parentsList : staffList;
    const total = list.length;
    const active = list.filter(u => u.isActive).length;
    const disabled = total - active;
    
    return { total, active, disabled };
  }, [view, parentsList, staffList]);

  // Handlers
  const handleToggleStatus = async (userId: string, currentStatus: boolean) => {
    try {
      await toggleUserStatus({ 
        userId: userId as Id<"users">, 
        status: !currentStatus 
      });
    } catch (error) {
      console.error("Error toggling user status:", error);
    }
  };

  const handleDeleteUser = async (userId: string) => {
    if (!window.confirm(`Are you sure you want to delete this user? This action cannot be undone.`)) {
      return;
    }
    
    try {
      await deleteUser({ userId: userId as Id<"users"> });
    } catch (error) {
      console.error("Error deleting user:", error);
    }
  };

  const handleBulkAction = async () => {
    if (selectedUsers.size === 0 || !bulkAction) return;
    
    const confirmMessage = bulkAction === "delete" 
      ? `Are you sure you want to delete ${selectedUsers.size} selected users? This cannot be undone.`
      : `Are you sure you want to ${bulkAction} ${selectedUsers.size} selected users?`;
    
    if (!window.confirm(confirmMessage)) return;
    
    try {
      for (const userId of selectedUsers) {
        switch (bulkAction) {
          case "activate":
            await toggleUserStatus({ userId: userId as Id<"users">, status: true });
            break;
          case "deactivate":
            await toggleUserStatus({ userId: userId as Id<"users">, status: false });
            break;
          case "delete":
            await deleteUser({ userId: userId as Id<"users"> });
            break;
        }
      }
      setSelectedUsers(new Set());
      setBulkAction("");
    } catch (error) {
      console.error("Error performing bulk action:", error);
    }
  };

  const toggleSelectUser = (userId: string) => {
    const newSelected = new Set(selectedUsers);
    if (newSelected.has(userId)) {
      newSelected.delete(userId);
    } else {
      newSelected.add(userId);
    }
    setSelectedUsers(newSelected);
  };

  const selectAll = () => {
    if (selectedUsers.size === filteredUsers.length) {
      setSelectedUsers(new Set());
    } else {
      const allIds = filteredUsers.map(u => u._id);
      setSelectedUsers(new Set(allIds));
    }
  };

  return (
    <div className="max-w-7xl mx-auto px-4 py-8 space-y-6">
      {/* Header */}
      <div className="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
        <div>
          <h1 className="text-2xl md:text-3xl font-bold text-gray-900">
            {view === "parents" ? "Parent" : "Staff"} Account Management
          </h1>
          <p className="text-gray-600 mt-1">
            Manage user accounts, permissions, and access
          </p>
        </div>

        <div className="flex flex-wrap gap-3">
          <button
            onClick={() => setShowCreateModal(true)}
            className="px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700 transition flex items-center gap-2"
          >
            <i className="fas fa-plus"></i>
            Create New {view === "staff" ? "Staff" : "Account"}
          </button>
          
          <Link
            to="/admin"
            className="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition flex items-center gap-2"
          >
            <i className="fas fa-arrow-left"></i>
            Back to Dashboard
          </Link>
        </div>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div className="bg-white border border-gray-200 rounded-xl p-5">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Total Accounts</p>
              <p className="text-2xl font-bold text-gray-900">{stats.total}</p>
            </div>
            <div className="w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center">
              <i className="fas fa-users text-blue-600 text-xl"></i>
            </div>
          </div>
        </div>

        <div className="bg-white border border-gray-200 rounded-xl p-5">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Active Accounts</p>
              <p className="text-2xl font-bold text-green-600">{stats.active}</p>
            </div>
            <div className="w-12 h-12 rounded-full bg-green-50 flex items-center justify-center">
              <i className="fas fa-check-circle text-green-600 text-xl"></i>
            </div>
          </div>
        </div>

        <div className="bg-white border border-gray-200 rounded-xl p-5">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Disabled Accounts</p>
              <p className="text-2xl font-bold text-red-600">{stats.disabled}</p>
            </div>
            <div className="w-12 h-12 rounded-full bg-red-50 flex items-center justify-center">
              <i className="fas fa-ban text-red-600 text-xl"></i>
            </div>
          </div>
        </div>
      </div>

      {/* Controls */}
      <div className="bg-white rounded-xl border border-gray-200 p-5">
        <div className="flex flex-col lg:flex-row lg:items-center gap-4">
          {/* View Toggle */}
          <div className="flex border rounded-lg p-1">
            <button
              onClick={() => {
                setView("parents");
                setSelectedUsers(new Set());
              }}
              className={`px-4 py-2 rounded-md transition ${view === "parents"
                ? "bg-primary-red text-white"
                : "text-gray-700 hover:bg-gray-100"
                }`}
            >
              Parents ({parentsList.length})
            </button>
            <button
              onClick={() => {
                setView("staff");
                setSelectedUsers(new Set());
              }}
              className={`px-4 py-2 rounded-md transition ${view === "staff"
                ? "bg-primary-red text-white"
                : "text-gray-700 hover:bg-gray-100"
                }`}
            >
              Staff ({staffList.length})
            </button>
          </div>

          {/* Status Filter */}
          <div className="flex items-center gap-2">
            <span className="text-sm font-medium text-gray-700">Status:</span>
            <select
              value={statusFilter}
              onChange={(e) => setStatusFilter(e.target.value as StatusFilter)}
              className="border border-gray-300 rounded-lg px-3 py-2 text-sm"
            >
              <option value="all">All</option>
              <option value="active">Active Only</option>
              <option value="disabled">Disabled Only</option>
            </select>
          </div>

          {/* Search */}
          <div className="flex-1">
            <div className="relative">
              <i className="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              <input
                type="text"
                placeholder="Search by name, email, or department..."
                className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:border-primary-red focus:ring-2 focus:ring-primary-red/20"
                value={search}
                onChange={(e) => setSearch(e.target.value)}
              />
            </div>
          </div>
        </div>

        {/* Bulk Actions */}
        {selectedUsers.size > 0 && (
          <div className="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
            <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
              <div className="flex items-center gap-3">
                <span className="font-medium text-blue-800">
                  {selectedUsers.size} user{selectedUsers.size !== 1 ? 's' : ''} selected
                </span>
                <button
                  onClick={selectAll}
                  className="text-sm text-blue-600 hover:text-blue-800"
                >
                  {selectedUsers.size === filteredUsers.length ? 'Deselect all' : 'Select all'}
                </button>
              </div>
              
              <div className="flex flex-wrap gap-2">
                <select
                  value={bulkAction}
                  onChange={(e) => setBulkAction(e.target.value)}
                  className="border border-gray-300 rounded-lg px-3 py-1.5 text-sm"
                >
                  <option value="">Bulk Actions</option>
                  <option value="activate">Activate</option>
                  <option value="deactivate">Deactivate</option>
                  <option value="delete">Delete</option>
                </select>
                <button
                  onClick={handleBulkAction}
                  disabled={!bulkAction}
                  className={`px-4 py-1.5 rounded-lg text-sm font-medium ${bulkAction
                    ? "bg-blue-600 text-white hover:bg-blue-700"
                    : "bg-gray-200 text-gray-400 cursor-not-allowed"
                    }`}
                >
                  Apply
                </button>
                <button
                  onClick={() => setSelectedUsers(new Set())}
                  className="px-4 py-1.5 border border-gray-300 rounded-lg text-sm hover:bg-gray-50"
                >
                  Clear Selection
                </button>
              </div>
            </div>
          </div>
        )}
      </div>

      {/* User Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {activeList === undefined ? (
          <div className="p-8 text-center">
            <i className="fas fa-spinner fa-spin text-2xl text-primary-red mb-3"></i>
            <p className="text-gray-600">Loading {view}...</p>
          </div>
        ) : filteredUsers.length === 0 ? (
          <div className="p-8 text-center">
            <i className="fas fa-users text-3xl text-gray-300 mb-3"></i>
            <h3 className="text-lg font-medium text-gray-700 mb-2">
              No {view} found
            </h3>
            <p className="text-gray-500">
              {search ? 'Try adjusting your search or filters' : `No ${view} accounts have been created yet`}
            </p>
          </div>
        ) : (
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead>
                <tr className="bg-gray-50 border-b">
                  <th className="px-6 py-3 text-left">
                    <input
                      type="checkbox"
                      checked={selectedUsers.size === filteredUsers.length && filteredUsers.length > 0}
                      onChange={selectAll}
                      className="rounded border-gray-300"
                    />
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    User
                  </th>
                  {view === "staff" && (
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Position
                    </th>
                  )}
                  {view === "parents" && (
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Children
                    </th>
                  )}
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Status
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Last Login
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Actions
                  </th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {filteredUsers.map((u) => (
                  <tr key={u._id} className="hover:bg-gray-50">
                    <td className="px-6 py-4">
                      <input
                        type="checkbox"
                        checked={selectedUsers.has(u._id)}
                        onChange={() => toggleSelectUser(u._id)}
                        className="rounded border-gray-300"
                      />
                    </td>
                    <td className="px-6 py-4">
                      <div>
                        <div className="font-medium text-gray-900">{u.fullName}</div>
                        <div className="text-sm text-gray-500">{u.email}</div>
                      </div>
                    </td>
                    {view === "staff" && (
                      <td className="px-6 py-4">
                        <div className="text-sm text-gray-900">{u.position || "Not specified"}</div>
                        {u.department && (
                          <div className="text-xs text-gray-500">{u.department}</div>
                        )}
                      </td>
                    )}
                    {view === "parents" && (
                      <td className="px-6 py-4">
                        <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                          {u.childrenCount || 0} children
                        </span>
                      </td>
                    )}
                    <td className="px-6 py-4">
                      <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${u.isActive
                          ? "bg-green-100 text-green-800"
                          : "bg-red-100 text-red-800"
                        }`}>
                        {u.isActive ? "Active" : "Disabled"}
                      </span>
                    </td>
                    <td className="px-6 py-4 text-sm text-gray-500">
                      {u.lastLogin
                        ? new Date(u.lastLogin).toLocaleDateString()
                        : "Never"}
                    </td>
                    <td className="px-6 py-4">
                      <div className="flex gap-2">
                        <button
                          onClick={() => handleToggleStatus(u._id, u.isActive)}
                          className={`px-3 py-1 rounded text-sm ${u.isActive
                              ? "bg-red-50 text-red-600 hover:bg-red-100"
                              : "bg-green-50 text-green-600 hover:bg-green-100"
                            }`}
                        >
                          {u.isActive ? "Disable" : "Activate"}
                        </button>
                        <button
                          onClick={() => handleDeleteUser(u._id)}
                          className="px-3 py-1 bg-red-50 text-red-600 rounded text-sm hover:bg-red-100"
                        >
                          Delete
                        </button>
                        <button className="px-3 py-1 bg-gray-50 text-gray-600 rounded text-sm hover:bg-gray-100">
                          Edit
                        </button>
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>

      {/* Create Staff Modal */}
      {showCreateModal && view === "staff" && (
        <CreateStaffModal
          onClose={() => setShowCreateModal(false)}
          onCreate={createStaffAccount}
        />
      )}

      {/* Create Parent Modal */}
      {showCreateModal && view === "parents" && (
        <CreateParentModal
          onClose={() => setShowCreateModal(false)}
        />
      )}
    </div>
  );
}

// Create Staff Modal Component
function CreateStaffModal({ onClose, onCreate }: { onClose: () => void; onCreate: any }) {
  const [formData, setFormData] = useState({
    fullName: "",
    email: "",
    password: "",
    position: "",
    department: "",
  });

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    try {
      await onCreate(formData);
      onClose();
    } catch (error) {
      console.error("Error creating staff account:", error);
    }
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        <div className="p-6">
          <div className="flex items-center justify-between mb-6">
            <h2 className="text-xl font-bold text-gray-900">Create New Staff Account</h2>
            <button
              onClick={onClose}
              className="text-gray-400 hover:text-gray-600"
            >
              <i className="fas fa-times"></i>
            </button>
          </div>

          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Full Name
              </label>
              <input
                type="text"
                required
                className="w-full p-2 border border-gray-300 rounded-lg"
                value={formData.fullName}
                onChange={(e) => setFormData({ ...formData, fullName: e.target.value })}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Email Address
              </label>
              <input
                type="email"
                required
                className="w-full p-2 border border-gray-300 rounded-lg"
                value={formData.email}
                onChange={(e) => setFormData({ ...formData, email: e.target.value })}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Password
              </label>
              <input
                type="password"
                required
                className="w-full p-2 border border-gray-300 rounded-lg"
                value={formData.password}
                onChange={(e) => setFormData({ ...formData, password: e.target.value })}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Position
              </label>
              <input
                type="text"
                className="w-full p-2 border border-gray-300 rounded-lg"
                value={formData.position}
                onChange={(e) => setFormData({ ...formData, position: e.target.value })}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Department
              </label>
              <input
                type="text"
                className="w-full p-2 border border-gray-300 rounded-lg"
                value={formData.department}
                onChange={(e) => setFormData({ ...formData, department: e.target.value })}
              />
            </div>

            <div className="flex gap-3 pt-4">
              <button
                type="submit"
                className="flex-1 bg-primary-red text-white py-2.5 rounded-lg hover:bg-red-700"
              >
                Create Staff Account
              </button>
              <button
                type="button"
                onClick={onClose}
                className="flex-1 border border-gray-300 py-2.5 rounded-lg hover:bg-gray-50"
              >
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}

// Create Parent Modal Component
function CreateParentModal({ onClose }: { onClose: () => void }) {
  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-md w-full">
        <div className="p-6">
          <div className="flex items-center justify-between mb-6">
            <h2 className="text-xl font-bold text-gray-900">Create Parent Account</h2>
            <button
              onClick={onClose}
              className="text-gray-400 hover:text-gray-600"
            >
              <i className="fas fa-times"></i>
            </button>
          </div>
          
          <p className="text-gray-600 mb-6">
            Parent accounts should be created through the registration process.
            You can approve pending registrations from the Registrations page.
          </p>
          
          <div className="flex gap-3">
            <Link
              to="/admin/registrations"
              className="flex-1 bg-primary-red text-white py-2.5 rounded-lg hover:bg-red-700 text-center"
            >
              Go to Registrations
            </Link>
            <button
              onClick={onClose}
              className="flex-1 border border-gray-300 py-2.5 rounded-lg hover:bg-gray-50"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}

// Import Link if not already imported
import { Link } from "react-router-dom";
You'll also need to add the corresponding Convex mutations. Here's an example of what you might add to your convex/admin.ts file:

typescript
// convex/admin.ts - Add these mutations
import { mutation } from "./_generated/server";
import { v } from "convex/values";

export const toggleUserStatus = mutation({
  args: {
    userId: v.id("users"),
    status: v.boolean(),
  },
  handler: async (ctx, args) => {
    await ctx.db.patch(args.userId, {
      isActive: args.status,
    });
  },
});

export const deleteUser = mutation({
  args: {
    userId: v.id("users"),
  },
  handler: async (ctx, args) => {
    // Optional: Check if user has associated data before deleting
    await ctx.db.delete(args.userId);
  },
});

export const createStaffAccount = mutation({
  args: {
    fullName: v.string(),
    email: v.string(),
    password: v.string(),
    position: v.optional(v.string()),
    department: v.optional(v.string()),
  },
  handler: async (ctx, args) => {
    // Check if user already exists
    const existing = await ctx.db
      .query("users")
      .withIndex("by_email", (q) => q.eq("email", args.email))
      .first();

    if (existing) {
      throw new Error("User with this email already exists");
    }

    // Create new staff account
    await ctx.db.insert("users", {
      fullName: args.fullName,
      email: args.email,
      password: args.password, // Note: You should hash passwords in production
      role: "staff",
      isActive: true,
      position: args.position,
      department: args.department,
    });
  },
});
Key Features of this Implementation:
Dual View: Toggle between parents and staff management

Advanced Filtering: Search by name, email, department with status filters

Bulk Actions: Select multiple users for activation/deactivation/deletion

Statistics: Quick overview cards showing total/active/disabled accounts

Create Staff: Modal form to create new staff accounts

Parent Creation Guidance: Directs to registrations page for parent accounts

Responsive Design: Works on mobile and desktop

User-friendly Interface: Clear status indicators, tooltips, and confirmations

Data Management: Edit, disable/enable, and delete user accounts

To Use:
Add this page to your routes in App.tsx:

tsx
<Route path="/admin/manage-accounts" element={<AdminManageAccounts />} />
Update your AdminSidePanel.tsx to include a link:

tsx
<NavLink to="/admin/manage-accounts" className={linkClass}>
  <i className="fas fa-user-cog w-5"></i>
  Manage Accounts
</NavLink>
This creates a comprehensive account management system that allows admins to efficiently manage all user accounts in your school system.

here is admin's account management page


// pages/AdminManageAccounts.tsx
import { useQuery, useMutation } from "convex/react";
import { api } from "../../convex/_generated/api";
import { Navigate, Link } from "react-router-dom";
import { useAuth } from "../hooks/useAuth";
import { useState, useMemo } from "react";
import { Id } from "../../convex/_generated/dataModel";

type ViewMode = "parents" | "staff";
type StatusFilter = "all" | "active" | "disabled";

interface UserAccount {
  _id: Id<"users">;
  fullName: string;
  email: string;
  role: "parent" | "staff" | "admin";
  isActive: boolean;
  createdAt: number;
  lastLogin?: number;
  // Additional fields for parents
  childrenCount?: number;
  // Additional fields for staff
  department?: string;
  position?: string;
}

export default function AdminManageAccounts() {
  const { user, role, isLoading } = useAuth();

  // State management
  const [view, setView] = useState<ViewMode>("parents");
  const [search, setSearch] = useState("");
  const [statusFilter, setStatusFilter] = useState<StatusFilter>("all");
  const [selectedUsers, setSelectedUsers] = useState<Set<string>>(new Set());
  const [bulkAction, setBulkAction] = useState<string>("");
  const [showCreateModal, setShowCreateModal] = useState(false);

  // Queries
  const parents = useQuery(api.admin.listParents);
  const staff = useQuery(api.admin.listStaff);


  // Mutations
  const toggleUserStatus = useMutation(api.admin.toggleUserStatus);
  const deleteUser = useMutation(api.admin.deleteUser);
  const createStaffAccount = useMutation(api.admin.createStaffAccount);
    const updateUserRole = useMutation(api.admin.updateUserRole);

  const handleRoleChange = async (userId: string, newRole: string) => {
    try {
      await updateUserRole({
        userId: userId as Id<"users">,
        newRole: newRole as "parent" | "staff" | "admin"
      });
    } catch (error) {
      console.error("Error updating user role:", error);
    }
  };


  if (isLoading) return null;
  if (!user || role !== "admin") return <Navigate to="/login" />;

  // Process user data
  const processUsers = (users: any[] | undefined): UserAccount[] => {
    if (!users) return [];

    return users.map(user => ({
      ...user,
      childrenCount: user.children?.length || 0,
      createdAt: user._creationTime,
    }));
  };

  const parentsList = processUsers(parents);
  const staffList = processUsers(staff);
  const activeList = view === "parents" ? parentsList : staffList;

  // Filter and search
  const filteredUsers = useMemo(() => {
    if (!activeList) return [];

    return activeList.filter((u) => {
      // Search filter
      const matchesSearch = `${u.fullName} ${u.email} ${u.department || ''} ${u.position || ''}`
        .toLowerCase()
        .includes(search.toLowerCase());

      // Status filter
      let matchesStatus = true;
      if (statusFilter === "active") matchesStatus = u.isActive;
      if (statusFilter === "disabled") matchesStatus = !u.isActive;

      return matchesSearch && matchesStatus;
    });
  }, [activeList, search, statusFilter]);

  // Stats
  const stats = useMemo(() => {
    const list = view === "parents" ? parentsList : staffList;
    const total = list.length;
    const active = list.filter(u => u.isActive).length;
    const disabled = total - active;

    return { total, active, disabled };
  }, [view, parentsList, staffList]);

  // Handlers
  const handleToggleStatus = async (userId: string, currentStatus: boolean) => {
    try {
      await toggleUserStatus({
        userId: userId as Id<"users">,
        status: !currentStatus
      });
    } catch (error) {
      console.error("Error toggling user status:", error);
    }
  };

  const handleDeleteUser = async (userId: string) => {
    if (!window.confirm(`Are you sure you want to delete this user? This action cannot be undone.`)) {
      return;
    }

    try {
      await deleteUser({ userId: userId as Id<"users"> });
    } catch (error) {
      console.error("Error deleting user:", error);
    }
  };

  const handleBulkAction = async () => {
    if (selectedUsers.size === 0 || !bulkAction) return;

    const confirmMessage = bulkAction === "delete"
      ? `Are you sure you want to delete ${selectedUsers.size} selected users? This cannot be undone.`
      : `Are you sure you want to ${bulkAction} ${selectedUsers.size} selected users?`;

    if (!window.confirm(confirmMessage)) return;

    try {
      for (const userId of selectedUsers) {
        switch (bulkAction) {
          case "activate":
            await toggleUserStatus({ userId: userId as Id<"users">, status: true });
            break;
          case "deactivate":
            await toggleUserStatus({ userId: userId as Id<"users">, status: false });
            break;
          case "delete":
            await deleteUser({ userId: userId as Id<"users"> });
            break;
        }
      }
      setSelectedUsers(new Set());
      setBulkAction("");
    } catch (error) {
      console.error("Error performing bulk action:", error);
    }
  };

  const toggleSelectUser = (userId: string) => {
    const newSelected = new Set(selectedUsers);
    if (newSelected.has(userId)) {
      newSelected.delete(userId);
    } else {
      newSelected.add(userId);
    }
    setSelectedUsers(newSelected);
  };

  const selectAll = () => {
    if (selectedUsers.size === filteredUsers.length) {
      setSelectedUsers(new Set());
    } else {
      const allIds = filteredUsers.map(u => u._id);
      setSelectedUsers(new Set(allIds));
    }
  };

  return (
    <div className="max-w-7xl mx-auto px-4 py-8 space-y-6">
      {/* Header */}
      <div className="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
        <div>
          <h1 className="text-2xl md:text-3xl font-bold text-gray-900">
            {view === "parents" ? "Parent" : "Staff"} Account Management
          </h1>
          <p className="text-gray-600 mt-1">
            Manage user accounts, permissions, and access
          </p>
        </div>

        <div className="flex flex-wrap gap-3">
          <button
            onClick={() => setShowCreateModal(true)}
            className="px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700 transition flex items-center gap-2"
          >
            <i className="fas fa-plus"></i>
            Create New {view === "staff" ? "Staff" : "Account"}
          </button>

          <Link
            to="/admin"
            className="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition flex items-center gap-2"
          >
            <i className="fas fa-arrow-left"></i>
            Back to Dashboard
          </Link>
        </div>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div className="bg-white border border-gray-200 rounded-xl p-5">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Total Accounts</p>
              <p className="text-2xl font-bold text-gray-900">{stats.total}</p>
            </div>
            <div className="w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center">
              <i className="fas fa-users text-blue-600 text-xl"></i>
            </div>
          </div>
        </div>

        <div className="bg-white border border-gray-200 rounded-xl p-5">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Active Accounts</p>
              <p className="text-2xl font-bold text-green-600">{stats.active}</p>
            </div>
            <div className="w-12 h-12 rounded-full bg-green-50 flex items-center justify-center">
              <i className="fas fa-check-circle text-green-600 text-xl"></i>
            </div>
          </div>
        </div>

        <div className="bg-white border border-gray-200 rounded-xl p-5">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Disabled Accounts</p>
              <p className="text-2xl font-bold text-red-600">{stats.disabled}</p>
            </div>
            <div className="w-12 h-12 rounded-full bg-red-50 flex items-center justify-center">
              <i className="fas fa-ban text-red-600 text-xl"></i>
            </div>
          </div>
        </div>
      </div>

      {/* Controls */}
      <div className="bg-white rounded-xl border border-gray-200 p-5">
        <div className="flex flex-col lg:flex-row lg:items-center gap-4">
          {/* View Toggle */}
          <div className="flex border rounded-lg p-1">
            <button
              onClick={() => {
                setView("parents");
                setSelectedUsers(new Set());
              }}
              className={`px-4 py-2 rounded-md transition ${view === "parents"
                ? "bg-primary-red text-white"
                : "text-gray-700 hover:bg-gray-100"
                }`}
            >
              Parents ({parentsList.length})
            </button>
            <button
              onClick={() => {
                setView("staff");
                setSelectedUsers(new Set());
              }}
              className={`px-4 py-2 rounded-md transition ${view === "staff"
                ? "bg-primary-red text-white"
                : "text-gray-700 hover:bg-gray-100"
                }`}
            >
              Staff ({staffList.length})
            </button>
          </div>

          {/* Status Filter */}
          <div className="flex items-center gap-2">
            <span className="text-sm font-medium text-gray-700">Status:</span>
            <select
              value={statusFilter}
              onChange={(e) => setStatusFilter(e.target.value as StatusFilter)}
              className="border border-gray-300 rounded-lg px-3 py-2 text-sm"
            >
              <option value="all">All</option>
              <option value="active">Active Only</option>
              <option value="disabled">Disabled Only</option>
            </select>
          </div>

          {/* Search */}
          <div className="flex-1">
            <div className="relative">
              <i className="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              <input
                type="text"
                placeholder="Search by name, email, or department..."
                className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:border-primary-red focus:ring-2 focus:ring-primary-red/20"
                value={search}
                onChange={(e) => setSearch(e.target.value)}
              />
            </div>
          </div>
        </div>

        {/* Bulk Actions */}
        {selectedUsers.size > 0 && (
          <div className="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
            <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
              <div className="flex items-center gap-3">
                <span className="font-medium text-blue-800">
                  {selectedUsers.size} user{selectedUsers.size !== 1 ? 's' : ''} selected
                </span>
                <button
                  onClick={selectAll}
                  className="text-sm text-blue-600 hover:text-blue-800"
                >
                  {selectedUsers.size === filteredUsers.length ? 'Deselect all' : 'Select all'}
                </button>
              </div>

              <div className="flex flex-wrap gap-2">
                <select
                  value={bulkAction}
                  onChange={(e) => setBulkAction(e.target.value)}
                  className="border border-gray-300 rounded-lg px-3 py-1.5 text-sm"
                >
                  <option value="">Bulk Actions</option>
                  <option value="activate">Activate</option>
                  <option value="deactivate">Deactivate</option>
                  <option value="delete">Delete</option>
                </select>
                <button
                  onClick={handleBulkAction}
                  disabled={!bulkAction}
                  className={`px-4 py-1.5 rounded-lg text-sm font-medium ${bulkAction
                    ? "bg-blue-600 text-white hover:bg-blue-700"
                    : "bg-gray-200 text-gray-400 cursor-not-allowed"
                    }`}
                >
                  Apply
                </button>
                <button
                  onClick={() => setSelectedUsers(new Set())}
                  className="px-4 py-1.5 border border-gray-300 rounded-lg text-sm hover:bg-gray-50"
                >
                  Clear Selection
                </button>
              </div>
            </div>
          </div>
        )}
      </div>

      {/* User Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {activeList === undefined ? (
          <div className="p-8 text-center">
            <i className="fas fa-spinner fa-spin text-2xl text-primary-red mb-3"></i>
            <p className="text-gray-600">Loading {view}...</p>
          </div>
        ) : filteredUsers.length === 0 ? (
          <div className="p-8 text-center">
            <i className="fas fa-users text-3xl text-gray-300 mb-3"></i>
            <h3 className="text-lg font-medium text-gray-700 mb-2">
              No {view} found
            </h3>
            <p className="text-gray-500">
              {search ? 'Try adjusting your search or filters' : `No ${view} accounts have been created yet`}
            </p>
          </div>
        ) : (
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead>
                <tr className="bg-gray-50 border-b">
                  <th className="px-6 py-3 text-left">
                    <input
                      type="checkbox"
                      checked={selectedUsers.size === filteredUsers.length && filteredUsers.length > 0}
                      onChange={selectAll}
                      className="rounded border-gray-300"
                    />
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    User
                  </th>
                  {view === "staff" && (
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Position
                    </th>
                  )}
                  {view === "parents" && (
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Children
                    </th>
                  )}
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Status
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Last Login
                  </th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Actions
                  </th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {filteredUsers.map((u) => (
                  <tr key={u._id} className="hover:bg-gray-50">
                    <td className="px-6 py-4">
                      <input
                        type="checkbox"
                        checked={selectedUsers.has(u._id)}
                        onChange={() => toggleSelectUser(u._id)}
                        className="rounded border-gray-300"
                      />
                    </td>
                    <td className="px-6 py-4">
                      <div>
                        <div className="font-medium text-gray-900">{u.fullName}</div>
                        <div className="text-sm text-gray-500">{u.email}</div>
                      </div>
                    </td>
                    {view === "staff" && (
                      <td className="px-6 py-4">
                        <div className="text-sm text-gray-900">{u.position || "Not specified"}</div>
                        {u.department && (
                          <div className="text-xs text-gray-500">{u.department}</div>
                        )}
                      </td>
                    )}
                    {view === "parents" && (
                      <td className="px-6 py-4">
                        <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                          {u.childrenCount || 0} children
                        </span>
                      </td>
                    )}
                    <td className="px-6 py-4">
                      <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${u.isActive
                        ? "bg-green-100 text-green-800"
                        : "bg-red-100 text-red-800"
                        }`}>
                        {u.isActive ? "Active" : "Disabled"}
                      </span>
                    </td>
                    <td className="px-6 py-4 text-sm text-gray-500">
                      {u.lastLogin
                        ? new Date(u.lastLogin).toLocaleDateString()
                        : "Never"}
                    </td>
                    <td className="px-6 py-4">
                      <div className="flex gap-2">
                        <button
                          onClick={() => handleToggleStatus(u._id, u.isActive)}
                          className={`px-3 py-1 rounded text-sm ${u.isActive
                            ? "bg-red-50 text-red-600 hover:bg-red-100"
                            : "bg-green-50 text-green-600 hover:bg-green-100"
                            }`}
                        >
                          {u.isActive ? "Disable" : "Activate"}
                        </button>
                        <button
                          onClick={() => handleDeleteUser(u._id)}
                          className="px-3 py-1 bg-red-50 text-red-600 rounded text-sm hover:bg-red-100"
                        >
                          Delete
                        </button>
                        <button className="px-3 py-1 bg-gray-50 text-gray-600 rounded text-sm hover:bg-gray-100">
                          Edit
                        </button>
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>

      {/* Create Staff Modal */}
      {showCreateModal && view === "staff" && (
        <CreateStaffModal
          onClose={() => setShowCreateModal(false)}
          onCreate={createStaffAccount}
        />
      )}

      {/* Create Parent Modal */}
      {showCreateModal && view === "parents" && (
        <CreateParentModal
          onClose={() => setShowCreateModal(false)}
        />
      )}
    </div>
  );
}

// Create Staff Modal Component
function CreateStaffModal({ onClose, onCreate }: { onClose: () => void; onCreate: any }) {
  const [formData, setFormData] = useState({
    fullName: "",
    email: "",
    password: "",
    position: "",
    department: "",
  });

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    try {
      await onCreate(formData);
      onClose();
    } catch (error) {
      console.error("Error creating staff account:", error);
    }
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        <div className="p-6">
          <div className="flex items-center justify-between mb-6">
            <h2 className="text-xl font-bold text-gray-900">Create New Staff Account</h2>
            <button
              onClick={onClose}
              className="text-gray-400 hover:text-gray-600"
            >
              <i className="fas fa-times"></i>
            </button>
          </div>

          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Full Name
              </label>
              <input
                type="text"
                required
                className="w-full p-2 border border-gray-300 rounded-lg"
                value={formData.fullName}
                onChange={(e) => setFormData({ ...formData, fullName: e.target.value })}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Email Address
              </label>
              <input
                type="email"
                required
                className="w-full p-2 border border-gray-300 rounded-lg"
                value={formData.email}
                onChange={(e) => setFormData({ ...formData, email: e.target.value })}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Password
              </label>
              <input
                type="password"
                required
                className="w-full p-2 border border-gray-300 rounded-lg"
                value={formData.password}
                onChange={(e) => setFormData({ ...formData, password: e.target.value })}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Position
              </label>
              <input
                type="text"
                className="w-full p-2 border border-gray-300 rounded-lg"
                value={formData.position}
                onChange={(e) => setFormData({ ...formData, position: e.target.value })}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Department
              </label>
              <input
                type="text"
                className="w-full p-2 border border-gray-300 rounded-lg"
                value={formData.department}
                onChange={(e) => setFormData({ ...formData, department: e.target.value })}
              />
            </div>

            <div className="flex gap-3 pt-4">
              <button
                type="submit"
                className="flex-1 bg-primary-red text-white py-2.5 rounded-lg hover:bg-red-700"
              >
                Create Staff Account
              </button>
              <button
                type="button"
                onClick={onClose}
                className="flex-1 border border-gray-300 py-2.5 rounded-lg hover:bg-gray-50"
              >
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}

// Create Parent Modal Component
function CreateParentModal({ onClose }: { onClose: () => void }) {
  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-md w-full">
        <div className="p-6">
          <div className="flex items-center justify-between mb-6">
            <h2 className="text-xl font-bold text-gray-900">Create Parent Account</h2>
            <button
              onClick={onClose}
              className="text-gray-400 hover:text-gray-600"
            >
              <i className="fas fa-times"></i>
            </button>
          </div>

          <p className="text-gray-600 mb-6">
            Parent accounts should be created through the registration process.
            You can approve pending registrations from the Registrations page.
          </p>

          <div className="flex gap-3">
            <Link
              to="/admin/registrations"
              className="flex-1 bg-primary-red text-white py-2.5 rounded-lg hover:bg-red-700 text-center"
            >
              Go to Registrations
            </Link>
            <button
              onClick={onClose}
              className="flex-1 border border-gray-300 py-2.5 rounded-lg hover:bg-gray-50"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}

create a parent profile page, similar to the student profile page in a sense that provides all information about the parent including their registered students etc
I'll create a comprehensive parent profile page for admins that shows all parent information including their registered students. Here's the complete implementation:

tsx
// pages/AdminParentProfile.tsx
import { useQuery, useMutation } from "convex/react";
import { api } from "../../convex/_generated/api";
import { Navigate, Link, useParams } from "react-router-dom";
import { useAuth } from "../hooks/useAuth";
import { useState, useMemo } from "react";
import { Id } from "../../convex/_generated/dataModel";

export default function AdminParentProfile() {
  const { user, role, isLoading } = useAuth();
  const { parentId } = useParams<{ parentId: string }>();
  
  // State
  const [activeTab, setActiveTab] = useState<"overview" | "students" | "activity">("overview");
  const [showEditModal, setShowEditModal] = useState(false);
  const [showAddStudentModal, setShowAddStudentModal] = useState(false);
  const [showConfirmDelete, setShowConfirmDelete] = useState(false);

  // Queries
  const parent = useQuery(api.admin.getParentDetails, 
    parentId ? { parentId: parentId as Id<"users"> } : "skip"
  );
  
  const students = useQuery(api.admin.getParentStudents, 
    parentId ? { parentId: parentId as Id<"users"> } : "skip"
  );
  
  const activityLog = useQuery(api.admin.getParentActivity, 
    parentId ? { parentId: parentId as Id<"users"> } : "skip"
  );

  // Mutations
  const updateParent = useMutation(api.admin.updateParent);
  const toggleParentStatus = useMutation(api.admin.toggleUserStatus);
  const deleteParent = useMutation(api.admin.deleteUser);
  const addStudentToParent = useMutation(api.admin.addStudentToParent);
  const removeStudentFromParent = useMutation(api.admin.removeStudentFromParent);

  if (isLoading) return null;
  if (!user || role !== "admin") return <Navigate to="/login" />;
  if (!parentId) return <Navigate to="/admin/manage-accounts" />;

  if (parent === undefined) {
    return (
      <div className="flex items-center justify-center min-h-[400px]">
        <div className="text-center">
          <i className="fas fa-spinner fa-spin text-3xl text-primary-red mb-3"></i>
          <p className="text-gray-600">Loading parent information...</p>
        </div>
      </div>
    );
  }

  if (parent === null) {
    return (
      <div className="max-w-4xl mx-auto px-4 py-8">
        <div className="bg-white rounded-xl border border-gray-200 p-8 text-center">
          <i className="fas fa-user-slash text-4xl text-gray-300 mb-4"></i>
          <h2 className="text-xl font-bold text-gray-800 mb-2">Parent Not Found</h2>
          <p className="text-gray-600 mb-6">The parent account you're looking for doesn't exist or has been deleted.</p>
          <Link
            to="/admin/manage-accounts"
            className="inline-flex items-center gap-2 px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700"
          >
            <i className="fas fa-arrow-left"></i>
            Back to Parent Management
          </Link>
        </div>
      </div>
    );
  }

  // Handlers
  const handleToggleStatus = async () => {
    try {
      await toggleParentStatus({ 
        userId: parent._id, 
        status: !parent.isActive 
      });
    } catch (error) {
      console.error("Error toggling parent status:", error);
    }
  };

  const handleDeleteParent = async () => {
    try {
      await deleteParent({ userId: parent._id });
      // Redirect after deletion
      window.location.href = "/admin/manage-accounts";
    } catch (error) {
      console.error("Error deleting parent:", error);
    }
  };

  const handleRemoveStudent = async (studentId: Id<"students">) => {
    if (!window.confirm("Are you sure you want to remove this student from the parent?")) return;
    
    try {
      await removeStudentFromParent({
        parentId: parent._id,
        studentId
      });
    } catch (error) {
      console.error("Error removing student:", error);
    }
  };

  // Calculate statistics
  const stats = useMemo(() => {
    return {
      totalStudents: students?.length || 0,
      activeStudents: students?.filter(s => s.isActive).length || 0,
      pendingTasks: 0, // You can add this if you have a task system
      totalLogins: activityLog?.filter(a => a.type === "login").length || 0,
      lastActive: parent.lastLogin 
        ? new Date(parent.lastLogin).toLocaleDateString()
        : "Never"
    };
  }, [students, activityLog, parent]);

  return (
    <div className="max-w-7xl mx-auto px-4 py-8 space-y-6">
      {/* Header with breadcrumb */}
      <div className="flex items-center gap-2 text-sm text-gray-600 mb-4">
        <Link to="/admin" className="hover:text-primary-red">Dashboard</Link>
        <i className="fas fa-chevron-right text-xs"></i>
        <Link to="/admin/manage-accounts" className="hover:text-primary-red">Manage Accounts</Link>
        <i className="fas fa-chevron-right text-xs"></i>
        <span className="font-medium text-gray-900">{parent.fullName}</span>
      </div>

      {/* Parent Header */}
      <div className="bg-white rounded-xl border border-gray-200 p-6">
        <div className="flex flex-col md:flex-row md:items-center justify-between gap-6">
          <div className="flex items-center gap-4">
            <div className="w-20 h-20 rounded-full bg-primary-red/10 flex items-center justify-center">
              <i className="fas fa-user text-3xl text-primary-red"></i>
            </div>
            <div>
              <h1 className="text-2xl md:text-3xl font-bold text-gray-900">{parent.fullName}</h1>
              <div className="flex flex-wrap items-center gap-2 mt-2">
                <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                  parent.isActive 
                    ? "bg-green-100 text-green-800" 
                    : "bg-red-100 text-red-800"
                }`}>
                  {parent.isActive ? "Active" : "Disabled"}
                </span>
                <span className="text-gray-600">•</span>
                <span className="text-gray-600">{parent.email}</span>
                <span className="text-gray-600">•</span>
                <span className="text-gray-600">Parent since {new Date(parent._creationTime).toLocaleDateString()}</span>
              </div>
            </div>
          </div>

          <div className="flex flex-wrap gap-2">
            <button
              onClick={() => setShowEditModal(true)}
              className="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2"
            >
              <i className="fas fa-edit"></i>
              Edit Profile
            </button>
            <button
              onClick={handleToggleStatus}
              className={`px-4 py-2 rounded-lg flex items-center gap-2 ${
                parent.isActive
                  ? "bg-red-50 text-red-600 hover:bg-red-100"
                  : "bg-green-50 text-green-600 hover:bg-green-100"
              }`}
            >
              <i className={`fas fa-${parent.isActive ? "ban" : "check"}`}></i>
              {parent.isActive ? "Disable Account" : "Activate Account"}
            </button>
            <button
              onClick={() => setShowConfirmDelete(true)}
              className="px-4 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 flex items-center gap-2"
            >
              <i className="fas fa-trash"></i>
              Delete
            </button>
          </div>
        </div>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <div className="bg-white border border-gray-200 rounded-xl p-5">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Registered Students</p>
              <p className="text-2xl font-bold text-gray-900">{stats.totalStudents}</p>
            </div>
            <div className="w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center">
              <i className="fas fa-user-graduate text-blue-600 text-xl"></i>
            </div>
          </div>
        </div>

        <div className="bg-white border border-gray-200 rounded-xl p-5">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Active Students</p>
              <p className="text-2xl font-bold text-green-600">{stats.activeStudents}</p>
            </div>
            <div className="w-12 h-12 rounded-full bg-green-50 flex items-center justify-center">
              <i className="fas fa-check-circle text-green-600 text-xl"></i>
            </div>
          </div>
        </div>

        <div className="bg-white border border-gray-200 rounded-xl p-5">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Total Logins</p>
              <p className="text-2xl font-bold text-purple-600">{stats.totalLogins}</p>
            </div>
            <div className="w-12 h-12 rounded-full bg-purple-50 flex items-center justify-center">
              <i className="fas fa-sign-in-alt text-purple-600 text-xl"></i>
            </div>
          </div>
        </div>

        <div className="bg-white border border-gray-200 rounded-xl p-5">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Last Active</p>
              <p className="text-2xl font-bold text-amber-600">{stats.lastActive}</p>
            </div>
            <div className="w-12 h-12 rounded-full bg-amber-50 flex items-center justify-center">
              <i className="fas fa-clock text-amber-600 text-xl"></i>
            </div>
          </div>
        </div>
      </div>

      {/* Tabs */}
      <div className="bg-white rounded-xl border border-gray-200">
        <div className="border-b border-gray-200">
          <nav className="flex -mb-px">
            <button
              onClick={() => setActiveTab("overview")}
              className={`px-6 py-4 font-medium text-sm border-b-2 ${
                activeTab === "overview"
                  ? "border-primary-red text-primary-red"
                  : "border-transparent text-gray-500 hover:text-gray-700"
              }`}
            >
              <i className="fas fa-info-circle mr-2"></i>
              Overview
            </button>
            <button
              onClick={() => setActiveTab("students")}
              className={`px-6 py-4 font-medium text-sm border-b-2 ${
                activeTab === "students"
                  ? "border-primary-red text-primary-red"
                  : "border-transparent text-gray-500 hover:text-gray-700"
              }`}
            >
              <i className="fas fa-user-graduate mr-2"></i>
              Students ({students?.length || 0})
            </button>
            <button
              onClick={() => setActiveTab("activity")}
              className={`px-6 py-4 font-medium text-sm border-b-2 ${
                activeTab === "activity"
                  ? "border-primary-red text-primary-red"
                  : "border-transparent text-gray-500 hover:text-gray-700"
              }`}
            >
              <i className="fas fa-history mr-2"></i>
              Activity Log
            </button>
          </nav>
        </div>

        <div className="p-6">
          {/* Overview Tab */}
          {activeTab === "overview" && (
            <div className="space-y-6">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {/* Contact Information */}
                <div className="bg-gray-50 rounded-lg p-5">
                  <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                    <i className="fas fa-address-card text-primary-red"></i>
                    Contact Information
                  </h3>
                  <div className="space-y-3">
                    <div>
                      <p className="text-sm text-gray-500">Full Name</p>
                      <p className="font-medium">{parent.fullName}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Email Address</p>
                      <p className="font-medium">{parent.email}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Phone Number</p>
                      <p className="font-medium">{parent.phone || "Not provided"}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Address</p>
                      <p className="font-medium">{parent.address || "Not provided"}</p>
                    </div>
                  </div>
                </div>

                {/* Account Information */}
                <div className="bg-gray-50 rounded-lg p-5">
                  <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                    <i className="fas fa-user-cog text-primary-red"></i>
                    Account Information
                  </h3>
                  <div className="space-y-3">
                    <div>
                      <p className="text-sm text-gray-500">Account Status</p>
                      <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                        parent.isActive 
                          ? "bg-green-100 text-green-800" 
                          : "bg-red-100 text-red-800"
                      }`}>
                        {parent.isActive ? "Active" : "Disabled"}
                      </span>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Account Created</p>
                      <p className="font-medium">{new Date(parent._creationTime).toLocaleDateString()}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Last Login</p>
                      <p className="font-medium">
                        {parent.lastLogin 
                          ? new Date(parent.lastLogin).toLocaleString()
                          : "Never logged in"
                        }
                      </p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">User ID</p>
                      <p className="font-medium font-mono text-sm">{parent._id}</p>
                    </div>
                  </div>
                </div>
              </div>

              {/* Additional Information */}
              {(parent.emergencyContact || parent.notes) && (
                <div className="bg-gray-50 rounded-lg p-5">
                  <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                    <i className="fas fa-sticky-note text-primary-red"></i>
                    Additional Information
                  </h3>
                  <div className="space-y-4">
                    {parent.emergencyContact && (
                      <div>
                        <p className="text-sm text-gray-500">Emergency Contact</p>
                        <p className="font-medium">{parent.emergencyContact}</p>
                      </div>
                    )}
                    {parent.notes && (
                      <div>
                        <p className="text-sm text-gray-500">Admin Notes</p>
                        <p className="font-medium whitespace-pre-wrap">{parent.notes}</p>
                      </div>
                    )}
                  </div>
                </div>
              )}
            </div>
          )}

          {/* Students Tab */}
          {activeTab === "students" && (
            <div className="space-y-6">
              <div className="flex items-center justify-between">
                <h3 className="text-lg font-semibold text-gray-900">
                  Registered Students
                </h3>
                <button
                  onClick={() => setShowAddStudentModal(true)}
                  className="px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700 flex items-center gap-2"
                >
                  <i className="fas fa-plus"></i>
                  Add Student
                </button>
              </div>

              {students === undefined ? (
                <div className="text-center py-8">
                  <i className="fas fa-spinner fa-spin text-2xl text-primary-red mb-3"></i>
                  <p className="text-gray-600">Loading students...</p>
                </div>
              ) : students.length === 0 ? (
                <div className="text-center py-12 bg-gray-50 rounded-lg">
                  <i className="fas fa-user-graduate text-4xl text-gray-300 mb-4"></i>
                  <h4 className="text-lg font-medium text-gray-700 mb-2">No Students Registered</h4>
                  <p className="text-gray-500 mb-6">This parent doesn't have any registered students yet.</p>
                  <button
                    onClick={() => setShowAddStudentModal(true)}
                    className="px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700 flex items-center gap-2 mx-auto"
                  >
                    <i className="fas fa-plus"></i>
                    Add First Student
                  </button>
                </div>
              ) : (
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                  {students.map(student => (
                    <div key={student._id} className="bg-white border border-gray-200 rounded-xl p-5 hover:shadow-sm transition-shadow">
                      <div className="flex items-start justify-between mb-4">
                        <div>
                          <h4 className="font-semibold text-gray-900">{student.fullName}</h4>
                          <p className="text-sm text-gray-500">{student.gradeLevel}</p>
                        </div>
                        <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                          student.isActive 
                            ? "bg-green-100 text-green-800" 
                            : "bg-red-100 text-red-800"
                        }`}>
                          {student.isActive ? "Active" : "Inactive"}
                        </span>
                      </div>
                      
                      <div className="space-y-2 mb-4">
                        <div className="flex items-center gap-2 text-sm">
                          <i className="fas fa-id-card text-gray-400"></i>
                          <span>Student ID: {student.studentId || "N/A"}</span>
                        </div>
                        <div className="flex items-center gap-2 text-sm">
                          <i className="fas fa-birthday-cake text-gray-400"></i>
                          <span>Age: {student.dateOfBirth 
                            ? `${Math.floor((Date.now() - new Date(student.dateOfBirth).getTime()) / (365.25 * 24 * 60 * 60 * 1000))} years`
                            : "N/A"
                          }</span>
                        </div>
                        <div className="flex items-center gap-2 text-sm">
                          <i className="fas fa-calendar-alt text-gray-400"></i>
                          <span>Enrolled: {student.enrollmentDate 
                            ? new Date(student.enrollmentDate).toLocaleDateString()
                            : "N/A"
                          }</span>
                        </div>
                      </div>

                      <div className="flex gap-2 pt-4 border-t border-gray-100">
                        <Link
                          to={`/staff/performance/${student._id}`}
                          className="flex-1 px-3 py-1.5 bg-gray-50 text-gray-700 rounded text-sm hover:bg-gray-100 text-center"
                        >
                          View Profile
                        </Link>
                        <button
                          onClick={() => handleRemoveStudent(student._id)}
                          className="px-3 py-1.5 bg-red-50 text-red-600 rounded text-sm hover:bg-red-100"
                        >
                          Remove
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}

          {/* Activity Log Tab */}
          {activeTab === "activity" && (
            <div className="space-y-6">
              <h3 className="text-lg font-semibold text-gray-900">
                Activity History
              </h3>

              {activityLog === undefined ? (
                <div className="text-center py-8">
                  <i className="fas fa-spinner fa-spin text-2xl text-primary-red mb-3"></i>
                  <p className="text-gray-600">Loading activity log...</p>
                </div>
              ) : activityLog.length === 0 ? (
                <div className="text-center py-12 bg-gray-50 rounded-lg">
                  <i className="fas fa-history text-4xl text-gray-300 mb-4"></i>
                  <h4 className="text-lg font-medium text-gray-700 mb-2">No Activity Found</h4>
                  <p className="text-gray-500">This parent hasn't performed any recorded activities yet.</p>
                </div>
              ) : (
                <div className="space-y-3">
                  {activityLog.map((activity, index) => (
                    <div key={index} className="flex items-start gap-3 p-3 border-b border-gray-100 last:border-0">
                      <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${
                        activity.type === "login" ? "bg-green-100" :
                        activity.type === "logout" ? "bg-red-100" :
                        activity.type === "profile_update" ? "bg-blue-100" :
                        "bg-gray-100"
                      }`}>
                        <i className={`fas ${
                          activity.type === "login" ? "fa-sign-in-alt text-green-600" :
                          activity.type === "logout" ? "fa-sign-out-alt text-red-600" :
                          activity.type === "profile_update" ? "fa-edit text-blue-600" :
                          "fa-info-circle text-gray-600"
                        }`}></i>
                      </div>
                      <div className="flex-1 min-w-0">
                        <p className="font-medium text-gray-900">{activity.description}</p>
                        <p className="text-sm text-gray-500">
                          {new Date(activity.timestamp).toLocaleString()}
                        </p>
                      </div>
                      {activity.ipAddress && (
                        <span className="text-xs text-gray-400 bg-gray-50 px-2 py-1 rounded">
                          {activity.ipAddress}
                        </span>
                      )}
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}
        </div>
      </div>

      {/* Edit Parent Modal */}
      {showEditModal && (
        <EditParentModal
          parent={parent}
          onClose={() => setShowEditModal(false)}
          onSave={updateParent}
        />
      )}

      {/* Add Student Modal */}
      {showAddStudentModal && (
        <AddStudentModal
          parentId={parent._id}
          onClose={() => setShowAddStudentModal(false)}
          onAdd={addStudentToParent}
        />
      )}

      {/* Confirm Delete Modal */}
      {showConfirmDelete && (
        <ConfirmDeleteModal
          parentName={parent.fullName}
          studentCount={students?.length || 0}
          onClose={() => setShowConfirmDelete(false)}
          onConfirm={handleDeleteParent}
        />
      )}
    </div>
  );
}

// Edit Parent Modal Component
function EditParentModal({ parent, onClose, onSave }: { 
  parent: any; 
  onClose: () => void; 
  onSave: any;
}) {
  const [formData, setFormData] = useState({
    fullName: parent.fullName || "",
    email: parent.email || "",
    phone: parent.phone || "",
    address: parent.address || "",
    emergencyContact: parent.emergencyContact || "",
    notes: parent.notes || "",
  });

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    try {
      await onSave({
        parentId: parent._id,
        ...formData
      });
      onClose();
    } catch (error) {
      console.error("Error updating parent:", error);
    }
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        <div className="p-6">
          <div className="flex items-center justify-between mb-6">
            <h2 className="text-xl font-bold text-gray-900">Edit Parent Profile</h2>
            <button
              onClick={onClose}
              className="text-gray-400 hover:text-gray-600"
            >
              <i className="fas fa-times"></i>
            </button>
          </div>

          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Full Name
              </label>
              <input
                type="text"
                required
                className="w-full p-2 border border-gray-300 rounded-lg"
                value={formData.fullName}
                onChange={(e) => setFormData({ ...formData, fullName: e.target.value })}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Email Address
              </label>
              <input
                type="email"
                required
                className="w-full p-2 border border-gray-300 rounded-lg"
                value={formData.email}
                onChange={(e) => setFormData({ ...formData, email: e.target.value })}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Phone Number
              </label>
              <input
                type="tel"
                className="w-full p-2 border border-gray-300 rounded-lg"
                value={formData.phone}
                onChange={(e) => setFormData({ ...formData, phone: e.target.value })}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Address
              </label>
              <textarea
                className="w-full p-2 border border-gray-300 rounded-lg"
                rows={2}
                value={formData.address}
                onChange={(e) => setFormData({ ...formData, address: e.target.value })}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Emergency Contact
              </label>
              <input
                type="text"
                className="w-full p-2 border border-gray-300 rounded-lg"
                value={formData.emergencyContact}
                onChange={(e) => setFormData({ ...formData, emergencyContact: e.target.value })}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Admin Notes
              </label>
              <textarea
                className="w-full p-2 border border-gray-300 rounded-lg"
                rows={3}
                value={formData.notes}
                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                placeholder="Add any additional notes about this parent..."
              />
            </div>

            <div className="flex gap-3 pt-4">
              <button
                type="submit"
                className="flex-1 bg-primary-red text-white py-2.5 rounded-lg hover:bg-red-700"
              >
                Save Changes
              </button>
              <button
                type="button"
                onClick={onClose}
                className="flex-1 border border-gray-300 py-2.5 rounded-lg hover:bg-gray-50"
              >
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}

// Add Student Modal Component
function AddStudentModal({ parentId, onClose, onAdd }: { 
  parentId: Id<"users">; 
  onClose: () => void; 
  onAdd: any;
}) {
  const [search, setSearch] = useState("");
  const [selectedStudent, setSelectedStudent] = useState<string>("");
  const allStudents = useQuery(api.admin.getAllStudents);
  
  const filteredStudents = useMemo(() => {
    if (!allStudents) return [];
    
    // Filter out students already assigned to this parent
    // You'll need to check if student is already assigned
    return allStudents.filter(student => 
      student.fullName.toLowerCase().includes(search.toLowerCase()) ||
      student.gradeLevel.toLowerCase().includes(search.toLowerCase())
    );
  }, [allStudents, search]);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!selectedStudent) return;
    
    try {
      await onAdd({
        parentId,
        studentId: selectedStudent as Id<"students">
      });
      onClose();
    } catch (error) {
      console.error("Error adding student:", error);
    }
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        <div className="p-6">
          <div className="flex items-center justify-between mb-6">
            <h2 className="text-xl font-bold text-gray-900">Add Student to Parent</h2>
            <button
              onClick={onClose}
              className="text-gray-400 hover:text-gray-600"
            >
              <i className="fas fa-times"></i>
            </button>
          </div>

          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Search Students
              </label>
              <input
                type="text"
                className="w-full p-2 border border-gray-300 rounded-lg"
                placeholder="Search by name or grade level..."
                value={search}
                onChange={(e) => setSearch(e.target.value)}
              />
            </div>

            <div className="max-h-60 overflow-y-auto border border-gray-200 rounded-lg">
              {allStudents === undefined ? (
                <div className="p-4 text-center">
                  <i className="fas fa-spinner fa-spin text-primary-red mr-2"></i>
                  Loading students...
                </div>
              ) : filteredStudents.length === 0 ? (
                <div className="p-4 text-center text-gray-500">
                  No students found
                </div>
              ) : (
                <div className="divide-y divide-gray-100">
                  {filteredStudents.map(student => (
                    <label
                      key={student._id}
                      className={`flex items-center gap-3 p-3 cursor-pointer hover:bg-gray-50 ${
                        selectedStudent === student._id ? "bg-blue-50" : ""
                      }`}
                    >
                      <input
                        type="radio"
                        name="student"
                        value={student._id}
                        checked={selectedStudent === student._id}
                        onChange={(e) => setSelectedStudent(e.target.value)}
                        className="text-primary-red"
                      />
                      <div>
                        <div className="font-medium">{student.fullName}</div>
                        <div className="text-sm text-gray-500">{student.gradeLevel}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>

            <div className="flex gap-3 pt-4">
              <button
                type="submit"
                disabled={!selectedStudent}
                className={`flex-1 py-2.5 rounded-lg ${
                  selectedStudent
                    ? "bg-primary-red text-white hover:bg-red-700"
                    : "bg-gray-200 text-gray-400 cursor-not-allowed"
                }`}
              >
                Add Student
              </button>
              <button
                type="button"
                onClick={onClose}
                className="flex-1 border border-gray-300 py-2.5 rounded-lg hover:bg-gray-50"
              >
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}

// Confirm Delete Modal Component
function ConfirmDeleteModal({ 
  parentName, 
  studentCount, 
  onClose, 
  onConfirm 
}: { 
  parentName: string;
  studentCount: number;
  onClose: () => void;
  onConfirm: () => void;
}) {
  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-md w-full">
        <div className="p-6">
          <div className="text-center mb-6">
            <div className="w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4">
              <i className="fas fa-exclamation-triangle text-2xl text-red-600"></i>
            </div>
            <h2 className="text-xl font-bold text-gray-900 mb-2">Delete Parent Account</h2>
            <p className="text-gray-600">
              Are you sure you want to delete <span className="font-semibold">{parentName}</span>?
            </p>
          </div>

          <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
            <div className="flex items-start gap-3">
              <i className="fas fa-exclamation-circle text-red-600 mt-0.5"></i>
              <div>
                <p className="font-medium text-red-800 mb-1">This action cannot be undone</p>
                <ul className="text-sm text-red-700 space-y-1">
                  <li>• The parent account will be permanently deleted</li>
                  <li>• All associated login credentials will be removed</li>
                  {studentCount > 0 && (
                    <li>• {studentCount} student{studentCount !== 1 ? 's' : ''} will lose access to this parent account</li>
                  )}
                </ul>
              </div>
            </div>
          </div>

          <div className="flex gap-3">
            <button
              onClick={onConfirm}
              className="flex-1 bg-red-600 text-white py-2.5 rounded-lg hover:bg-red-700 font-medium"
            >
              Yes, Delete Account
            </button>
            <button
              onClick={onClose}
              className="flex-1 border border-gray-300 py-2.5 rounded-lg hover:bg-gray-50"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}
You'll need to add these Convex queries and mutations to your admin functions:

typescript
// convex/admin.ts - Add these functions
import { query, mutation } from "./_generated/server";
import { v } from "convex/values";

// Get detailed parent information
export const getParentDetails = query({
  args: { parentId: v.id("users") },
  handler: async (ctx, args) => {
    const parent = await ctx.db.get(args.parentId);
    if (!parent || parent.role !== "parent") return null;
    
    return parent;
  },
});

// Get parent's students
export const getParentStudents = query({
  args: { parentId: v.id("users") },
  handler: async (ctx, args) => {
    const students = await ctx.db
      .query("students")
      .filter((q) => q.eq(q.field("parentId"), args.parentId))
      .collect();
    
    return students;
  },
});

// Get parent activity log
export const getParentActivity = query({
  args: { parentId: v.id("users") },
  handler: async (ctx, args) => {
    const activities = await ctx.db
      .query("userActivity")
      .withIndex
for reference this is admin.ts 

import { query } from "./_generated/server";
import { mutation } from "./_generated/server";
import { v } from "convex/values";
import bcrypt from "bcryptjs";



const hashPassword = async (password: string): Promise<string> => {
  return await bcrypt.hash(password, 10);
};



export const listParents = query({
  handler: async (ctx) => {
    return ctx.db
      .query("users")
      .filter(q => q.eq(q.field("role"), "parent"))
      .collect();
  },
});

export const listStaff = query({
  handler: async (ctx) => {
    return ctx.db
      .query("users")
      .filter(q => q.eq(q.field("role"), "staff"))
      .collect();
  },
});

export const toggleUserStatus = mutation({
  args: {
    userId: v.id("users"),
    status: v.boolean(),
  },
  handler: async (ctx, args) => {
    await ctx.db.patch(args.userId, {
      isActive: args.status,
    });
  },
});


export const updateUserRole = mutation({
  args: {
    userId: v.id("users"),
    newRole: v.union(v.literal("parent"), v.literal("staff"), v.literal("admin")),
  },
  handler: async (ctx, args) => {
    const user = await ctx.db.get(args.userId);
    if (!user) throw new Error("User not found");
    
    await ctx.db.patch(args.userId, { role: args.newRole });
    return args.userId;
  },
});

export const deleteUser = mutation({
  args: {
    userId: v.id("users"),
  },
  handler: async (ctx, args) => {
    const user = await ctx.db.get(args.userId);
    if (!user) throw new Error("User not found");
    
    await ctx.db.delete(args.userId);
    return args.userId;
  },
});

export const createStaffAccount = mutation({
  args: {
    email: v.string(),
    password: v.string(),
    fullName: v.string(),
    position: v.optional(v.string()),
    department: v.optional(v.string()),
  },
  handler: async (ctx, args) => {
    // Check if email already exists
    const existing = await ctx.db
      .query("users")
      .withIndex("by_email", (q) => q.eq("email", args.email))
      .first();
    
    if (existing) throw new Error("Email already exists");

    // Create the staff account
    const userId = await ctx.db.insert("users", {
      email: args.email,
      passwordHash: await hashPassword(args.password),
      fullName: args.fullName,
      role: "staff",
      isActive: true,
    });

    return userId;
  },
});
Now I'll create the complete parent profile page with all the necessary Convex functions. Here's the updated AdminParentProfile.tsx and the required additions to your admin.ts:

tsx
// pages/AdminParentProfile.tsx
import { useQuery, useMutation } from "convex/react";
import { api } from "../../convex/_generated/api";
import { Navigate, Link, useParams } from "react-router-dom";
import { useAuth } from "../hooks/useAuth";
import { useState, useMemo, useEffect } from "react";
import { Id } from "../../convex/_generated/dataModel";

type TabType = "overview" | "students" | "activity";

interface ActivityLog {
  _id: Id<"userActivity">;
  userId: Id<"users">;
  type: string;
  description: string;
  timestamp: number;
  ipAddress?: string;
}

export default function AdminParentProfile() {
  const { user, role, isLoading } = useAuth();
  const { parentId } = useParams<{ parentId: string }>();
  
  // State
  const [activeTab, setActiveTab] = useState<TabType>("overview");
  const [showEditModal, setShowEditModal] = useState(false);
  const [showAddStudentModal, setShowAddStudentModal] = useState(false);
  const [showConfirmDelete, setShowConfirmDelete] = useState(false);
  const [searchQuery, setSearchQuery] = useState("");

  // Queries
  const parent = useQuery(api.admin.getParentDetails, 
    parentId ? { parentId: parentId as Id<"users"> } : "skip"
  );
  
  const allStudents = useQuery(api.students.listAll);
  const activityLog = useQuery(api.admin.getParentActivity, 
    parentId ? { parentId: parentId as Id<"users"> } : "skip"
  );

  // Mutations
  const updateParent = useMutation(api.admin.updateParent);
  const toggleParentStatus = useMutation(api.admin.toggleUserStatus);
  const deleteParent = useMutation(api.admin.deleteUser);
  const addStudentToParent = useMutation(api.admin.addStudentToParent);
  const removeStudentFromParent = useMutation(api.admin.removeStudentFromParent);
  const createActivityLog = useMutation(api.admin.createActivityLog);

  if (isLoading) return null;
  if (!user || role !== "admin") return <Navigate to="/login" />;
  if (!parentId) return <Navigate to="/admin/manage-accounts" />;

  // Get parent's students
  const parentStudents = useMemo(() => {
    if (!parent || !allStudents) return [];
    
    return allStudents.filter(student => 
      student.parentId === parent._id ||
      (student.parents && student.parents.includes(parent._id))
    );
  }, [parent, allStudents]);

  // Filter students by search
  const filteredStudents = useMemo(() => {
    if (!parentStudents) return [];
    
    return parentStudents.filter(student => 
      searchQuery === "" ||
      student.fullName.toLowerCase().includes(searchQuery.toLowerCase()) ||
      student.gradeLevel.toLowerCase().includes(searchQuery.toLowerCase())
    );
  }, [parentStudents, searchQuery]);

  // Calculate statistics
  const stats = useMemo(() => {
    return {
      totalStudents: parentStudents?.length || 0,
      activeStudents: parentStudents?.filter(s => s.isActive).length || 0,
      totalLogins: activityLog?.filter(a => a.type === "login").length || 0,
      lastActive: parent?.lastLogin 
        ? new Date(parent.lastLogin).toLocaleDateString()
        : "Never"
    };
  }, [parentStudents, activityLog, parent]);

  // Handlers
  const handleToggleStatus = async () => {
    if (!parent) return;
    
    try {
      await toggleParentStatus({ 
        userId: parent._id, 
        status: !parent.isActive 
      });
      
      // Log the activity
      await createActivityLog({
        userId: parent._id,
        type: "status_change",
        description: `Account ${!parent.isActive ? "activated" : "disabled"} by admin`,
      });
    } catch (error) {
      console.error("Error toggling parent status:", error);
    }
  };

  const handleDeleteParent = async () => {
    if (!parent) return;
    
    try {
      await deleteParent({ userId: parent._id });
      // Redirect after deletion
      window.location.href = "/admin/manage-accounts";
    } catch (error) {
      console.error("Error deleting parent:", error);
    }
  };

  const handleRemoveStudent = async (studentId: Id<"students">) => {
    if (!parent) return;
    
    if (!window.confirm("Are you sure you want to remove this student from the parent?")) return;
    
    try {
      await removeStudentFromParent({
        parentId: parent._id,
        studentId
      });
      
      // Log the activity
      await createActivityLog({
        userId: parent._id,
        type: "student_removed",
        description: `Student removed by admin`,
      });
    } catch (error) {
      console.error("Error removing student:", error);
    }
  };

  const handleAddStudent = async (studentId: string) => {
    if (!parent) return;
    
    try {
      await addStudentToParent({
        parentId: parent._id,
        studentId: studentId as Id<"students">
      });
      
      // Log the activity
      await createActivityLog({
        userId: parent._id,
        type: "student_added",
        description: `Student added by admin`,
      });
      
      setShowAddStudentModal(false);
    } catch (error) {
      console.error("Error adding student:", error);
    }
  };

  if (parent === undefined) {
    return (
      <div className="flex items-center justify-center min-h-[400px]">
        <div className="text-center">
          <i className="fas fa-spinner fa-spin text-3xl text-primary-red mb-3"></i>
          <p className="text-gray-600">Loading parent information...</p>
        </div>
      </div>
    );
  }

  if (parent === null) {
    return (
      <div className="max-w-4xl mx-auto px-4 py-8">
        <div className="bg-white rounded-xl border border-gray-200 p-8 text-center">
          <i className="fas fa-user-slash text-4xl text-gray-300 mb-4"></i>
          <h2 className="text-xl font-bold text-gray-800 mb-2">Parent Not Found</h2>
          <p className="text-gray-600 mb-6">The parent account you're looking for doesn't exist or has been deleted.</p>
          <Link
            to="/admin/manage-accounts"
            className="inline-flex items-center gap-2 px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700"
          >
            <i className="fas fa-arrow-left"></i>
            Back to Parent Management
          </Link>
        </div>
      </div>
    );
  }

  return (
    <div className="max-w-7xl mx-auto px-4 py-8 space-y-6">
      {/* Header with breadcrumb */}
      <div className="flex items-center gap-2 text-sm text-gray-600 mb-4">
        <Link to="/admin" className="hover:text-primary-red">Dashboard</Link>
        <i className="fas fa-chevron-right text-xs"></i>
        <Link to="/admin/manage-accounts" className="hover:text-primary-red">Manage Accounts</Link>
        <i className="fas fa-chevron-right text-xs"></i>
        <span className="font-medium text-gray-900">{parent.fullName}</span>
      </div>

      {/* Parent Header */}
      <div className="bg-white rounded-xl border border-gray-200 p-6">
        <div className="flex flex-col md:flex-row md:items-center justify-between gap-6">
          <div className="flex items-center gap-4">
            <div className="w-20 h-20 rounded-full bg-primary-red/10 flex items-center justify-center">
              <i className="fas fa-user text-3xl text-primary-red"></i>
            </div>
            <div>
              <h1 className="text-2xl md:text-3xl font-bold text-gray-900">{parent.fullName}</h1>
              <div className="flex flex-wrap items-center gap-2 mt-2">
                <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                  parent.isActive 
                    ? "bg-green-100 text-green-800" 
                    : "bg-red-100 text-red-800"
                }`}>
                  {parent.isActive ? "Active" : "Disabled"}
                </span>
                <span className="text-gray-600">•</span>
                <span className="text-gray-600">{parent.email}</span>
                <span className="text-gray-600">•</span>
                <span className="text-gray-600">Parent since {new Date(parent._creationTime).toLocaleDateString()}</span>
              </div>
            </div>
          </div>

          <div className="flex flex-wrap gap-2">
            <button
              onClick={() => setShowEditModal(true)}
              className="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2"
            >
              <i className="fas fa-edit"></i>
              Edit Profile
            </button>
            <button
              onClick={handleToggleStatus}
              className={`px-4 py-2 rounded-lg flex items-center gap-2 ${
                parent.isActive
                  ? "bg-red-50 text-red-600 hover:bg-red-100"
                  : "bg-green-50 text-green-600 hover:bg-green-100"
              }`}
            >
              <i className={`fas fa-${parent.isActive ? "ban" : "check"}`}></i>
              {parent.isActive ? "Disable Account" : "Activate Account"}
            </button>
            <button
              onClick={() => setShowConfirmDelete(true)}
              className="px-4 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 flex items-center gap-2"
            >
              <i className="fas fa-trash"></i>
              Delete
            </button>
          </div>
        </div>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <div className="bg-white border border-gray-200 rounded-xl p-5">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Registered Students</p>
              <p className="text-2xl font-bold text-gray-900">{stats.totalStudents}</p>
            </div>
            <div className="w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center">
              <i className="fas fa-user-graduate text-blue-600 text-xl"></i>
            </div>
          </div>
        </div>

        <div className="bg-white border border-gray-200 rounded-xl p-5">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Active Students</p>
              <p className="text-2xl font-bold text-green-600">{stats.activeStudents}</p>
            </div>
            <div className="w-12 h-12 rounded-full bg-green-50 flex items-center justify-center">
              <i className="fas fa-check-circle text-green-600 text-xl"></i>
            </div>
          </div>
        </div>

        <div className="bg-white border border-gray-200 rounded-xl p-5">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Total Logins</p>
              <p className="text-2xl font-bold text-purple-600">{stats.totalLogins}</p>
            </div>
            <div className="w-12 h-12 rounded-full bg-purple-50 flex items-center justify-center">
              <i className="fas fa-sign-in-alt text-purple-600 text-xl"></i>
            </div>
          </div>
        </div>

        <div className="bg-white border border-gray-200 rounded-xl p-5">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Last Active</p>
              <p className="text-2xl font-bold text-amber-600">{stats.lastActive}</p>
            </div>
            <div className="w-12 h-12 rounded-full bg-amber-50 flex items-center justify-center">
              <i className="fas fa-clock text-amber-600 text-xl"></i>
            </div>
          </div>
        </div>
      </div>

      {/* Tabs */}
      <div className="bg-white rounded-xl border border-gray-200">
        <div className="border-b border-gray-200">
          <nav className="flex -mb-px">
            <button
              onClick={() => setActiveTab("overview")}
              className={`px-6 py-4 font-medium text-sm border-b-2 ${
                activeTab === "overview"
                  ? "border-primary-red text-primary-red"
                  : "border-transparent text-gray-500 hover:text-gray-700"
              }`}
            >
              <i className="fas fa-info-circle mr-2"></i>
              Overview
            </button>
            <button
              onClick={() => setActiveTab("students")}
              className={`px-6 py-4 font-medium text-sm border-b-2 ${
                activeTab === "students"
                  ? "border-primary-red text-primary-red"
                  : "border-transparent text-gray-500 hover:text-gray-700"
              }`}
            >
              <i className="fas fa-user-graduate mr-2"></i>
              Students ({parentStudents.length})
            </button>
            <button
              onClick={() => setActiveTab("activity")}
              className={`px-6 py-4 font-medium text-sm border-b-2 ${
                activeTab === "activity"
                  ? "border-primary-red text-primary-red"
                  : "border-transparent text-gray-500 hover:text-gray-700"
              }`}
            >
              <i className="fas fa-history mr-2"></i>
              Activity Log
            </button>
          </nav>
        </div>

        <div className="p-6">
          {/* Overview Tab */}
          {activeTab === "overview" && (
            <div className="space-y-6">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {/* Contact Information */}
                <div className="bg-gray-50 rounded-lg p-5">
                  <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                    <i className="fas fa-address-card text-primary-red"></i>
                    Contact Information
                  </h3>
                  <div className="space-y-3">
                    <div>
                      <p className="text-sm text-gray-500">Full Name</p>
                      <p className="font-medium">{parent.fullName}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Email Address</p>
                      <p className="font-medium">{parent.email}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Phone Number</p>
                      <p className="font-medium">{parent.phone || "Not provided"}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Address</p>
                      <p className="font-medium">{parent.address || "Not provided"}</p>
                    </div>
                  </div>
                </div>

                {/* Account Information */}
                <div className="bg-gray-50 rounded-lg p-5">
                  <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                    <i className="fas fa-user-cog text-primary-red"></i>
                    Account Information
                  </h3>
                  <div className="space-y-3">
                    <div>
                      <p className="text-sm text-gray-500">Account Status</p>
                      <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                        parent.isActive 
                          ? "bg-green-100 text-green-800" 
                          : "bg-red-100 text-red-800"
                      }`}>
                        {parent.isActive ? "Active" : "Disabled"}
                      </span>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Account Created</p>
                      <p className="font-medium">{new Date(parent._creationTime).toLocaleDateString()}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Last Login</p>
                      <p className="font-medium">
                        {parent.lastLogin 
                          ? new Date(parent.lastLogin).toLocaleString()
                          : "Never logged in"
                        }
                      </p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">User ID</p>
                      <p className="font-medium font-mono text-sm">{parent._id}</p>
                    </div>
                  </div>
                </div>
              </div>

              {/* Additional Information */}
              {(parent.emergencyContact || parent.notes) && (
                <div className="bg-gray-50 rounded-lg p-5">
                  <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                    <i className="fas fa-sticky-note text-primary-red"></i>
                    Additional Information
                  </h3>
                  <div className="space-y-4">
                    {parent.emergencyContact && (
                      <div>
                        <p className="text-sm text-gray-500">Emergency Contact</p>
                        <p className="font-medium">{parent.emergencyContact}</p>
                      </div>
                    )}
                    {parent.notes && (
                      <div>
                        <p className="text-sm text-gray-500">Admin Notes</p>
                        <p className="font-medium whitespace-pre-wrap">{parent.notes}</p>
                      </div>
                    )}
                  </div>
                </div>
              )}
            </div>
          )}

          {/* Students Tab */}
          {activeTab === "students" && (
            <div className="space-y-6">
              <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                <h3 className="text-lg font-semibold text-gray-900">
                  Registered Students ({parentStudents.length})
                </h3>
                <div className="flex gap-2">
                  <div className="relative">
                    <i className="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    <input
                      type="text"
                      placeholder="Search students..."
                      className="pl-10 pr-4 py-2 border border-gray-300 rounded-lg w-full sm:w-64"
                      value={searchQuery}
                      onChange={(e) => setSearchQuery(e.target.value)}
                    />
                  </div>
                  <button
                    onClick={() => setShowAddStudentModal(true)}
                    className="px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700 flex items-center gap-2"
                  >
                    <i className="fas fa-plus"></i>
                    Add Student
                  </button>
                </div>
              </div>

              {parentStudents.length === 0 ? (
                <div className="text-center py-12 bg-gray-50 rounded-lg">
                  <i className="fas fa-user-graduate text-4xl text-gray-300 mb-4"></i>
                  <h4 className="text-lg font-medium text-gray-700 mb-2">No Students Registered</h4>
                  <p className="text-gray-500 mb-6">This parent doesn't have any registered students yet.</p>
                  <button
                    onClick={() => setShowAddStudentModal(true)}
                    className="px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700 flex items-center gap-2 mx-auto"
                  >
                    <i className="fas fa-plus"></i>
                    Add First Student
                  </button>
                </div>
              ) : filteredStudents.length === 0 ? (
                <div className="text-center py-12 bg-gray-50 rounded-lg">
                  <i className="fas fa-search text-4xl text-gray-300 mb-4"></i>
                  <h4 className="text-lg font-medium text-gray-700 mb-2">No Students Found</h4>
                  <p className="text-gray-500">Try adjusting your search query.</p>
                </div>
              ) : (
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                  {filteredStudents.map(student => (
                    <div key={student._id} className="bg-white border border-gray-200 rounded-xl p-5 hover:shadow-sm transition-shadow">
                      <div className="flex items-start justify-between mb-4">
                        <div>
                          <h4 className="font-semibold text-gray-900">{student.fullName}</h4>
                          <p className="text-sm text-gray-500">{student.gradeLevel}</p>
                        </div>
                        <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                          student.isActive 
                            ? "bg-green-100 text-green-800" 
                            : "bg-red-100 text-red-800"
                        }`}>
                          {student.isActive ? "Active" : "Inactive"}
                        </span>
                      </div>
                      
                      <div className="space-y-2 mb-4">
                        <div className="flex items-center gap-2 text-sm">
                          <i className="fas fa-id-card text-gray-400"></i>
                          <span>ID: {student.studentId || "N/A"}</span>
                        </div>
                        <div className="flex items-center gap-2 text-sm">
                          <i className="fas fa-birthday-cake text-gray-400"></i>
                          <span>DOB: {student.dateOfBirth 
                            ? new Date(student.dateOfBirth).toLocaleDateString()
                            : "N/A"
                          }</span>
                        </div>
                        <div className="flex items-center gap-2 text-sm">
                          <i className="fas fa-calendar-alt text-gray-400"></i>
                          <span>Enrolled: {student.enrollmentDate 
                            ? new Date(student.enrollmentDate).toLocaleDateString()
                            : "N/A"
                          }</span>
                        </div>
                      </div>

                      <div className="flex gap-2 pt-4 border-t border-gray-100">
                        <Link
                          to={`/staff/performance/${student._id}`}
                          className="flex-1 px-3 py-1.5 bg-gray-50 text-gray-700 rounded text-sm hover:bg-gray-100 text-center"
                        >
                          View Profile
                        </Link>
                        <button
                          onClick={() => handleRemoveStudent(student._id)}
                          className="px-3 py-1.5 bg-red-50 text-red-600 rounded text-sm hover:bg-red-100"
                        >
                          Remove
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}

          {/* Activity Log Tab */}
          {activeTab === "activity" && (
            <div className="space-y-6">
              <h3 className="text-lg font-semibold text-gray-900">
                Activity History
              </h3>

              {activityLog === undefined ? (
                <div className="text-center py-8">
                  <i className="fas fa-spinner fa-spin text-2xl text-primary-red mb-3"></i>
                  <p className="text-gray-600">Loading activity log...</p>
                </div>
              ) : activityLog.length === 0 ? (
                <div className="text-center py-12 bg-gray-50 rounded-lg">
                  <i className="fas fa-history text-4xl text-gray-300 mb-4"></i>
                  <h4 className="text-lg font-medium text-gray-700 mb-2">No Activity Found</h4>
                  <p className="text-gray-500">This parent hasn't performed any recorded activities yet.</p>
                </div>
              ) : (
                <div className="space-y-3">
                  {activityLog.map((activity) => (
                    <div key={activity._id} className="flex items-start gap-3 p-3 border-b border-gray-100 last:border-0">
                      <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${
                        activity.type === "login" ? "bg-green-100" :
                        activity.type === "logout" ? "bg-red-100" :
                        activity.type === "profile_update" ? "bg-blue-100" :
                        "bg-gray-100"
                      }`}>
                        <i className={`fas ${
                          activity.type === "login" ? "fa-sign-in-alt text-green-600" :
                          activity.type === "logout" ? "fa-sign-out-alt text-red-600" :
                          activity.type === "profile_update" ? "fa-edit text-blue-600" :
                          "fa-info-circle text-gray-600"
                        }`}></i>
                      </div>
                      <div className="flex-1 min-w-0">
                        <p className="font-medium text-gray-900">{activity.description}</p>
                        <p className="text-sm text-gray-500">
                          {new Date(activity.timestamp).toLocaleString()}
                        </p>
                      </div>
                      {activity.ipAddress && (
                        <span className="text-xs text-gray-400 bg-gray-50 px-2 py-1 rounded">
                          {activity.ipAddress}
                        </span>
                      )}
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}
        </div>
      </div>

      {/* Edit Parent Modal */}
      {showEditModal && (
        <EditParentModal
          parent={parent}
          onClose={() => setShowEditModal(false)}
          onSave={updateParent}
        />
      )}

      {/* Add Student Modal */}
      {showAddStudentModal && (
        <AddStudentModal
          parentId={parent._id}
          parentStudents={parentStudents}
          allStudents={allStudents || []}
          onClose={() => setShowAddStudentModal(false)}
          onAdd={handleAddStudent}
        />
      )}

      {/* Confirm Delete Modal */}
      {showConfirmDelete && (
        <ConfirmDeleteModal
          parentName={parent.fullName}
          studentCount={parentStudents.length}
          onClose={() => setShowConfirmDelete(false)}
          onConfirm={handleDeleteParent}
        />
      )}
    </div>
  );
}

// Edit Parent Modal Component
function EditParentModal({ parent, onClose, onSave }: { 
  parent: any; 
  onClose: () => void; 
  onSave: any;
}) {
  const [formData, setFormData] = useState({
    fullName: parent.fullName || "",
    email: parent.email || "",
    phone: parent.phone || "",
    address: parent.address || "",
    emergencyContact: parent.emergencyContact || "",
    notes: parent.notes || "",
  });

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    try {
      await onSave({
        parentId: parent._id,
        ...formData
      });
      onClose();
    } catch (error) {
      console.error("Error updating parent:", error);
    }
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        <div className="p-6">
          <div className="flex items-center justify-between mb-6">
            <h2 className="text-xl font-bold text-gray-900">Edit Parent Profile</h2>
            <button
              onClick={onClose}
              className="text-gray-400 hover:text-gray-600"
            >
              <i className="fas fa-times"></i>
            </button>
          </div>

          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Full Name
              </label>
              <input
                type="text"
                required
                className="w-full p-2 border border-gray-300 rounded-lg"
                value={formData.fullName}
                onChange={(e) => setFormData({ ...formData, fullName: e.target.value })}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Email Address
              </label>
              <input
                type="email"
                required
                className="w-full p-2 border border-gray-300 rounded-lg"
                value={formData.email}
                onChange={(e) => setFormData({ ...formData, email: e.target.value })}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Phone Number
              </label>
              <input
                type="tel"
                className="w-full p-2 border border-gray-300 rounded-lg"
                value={formData.phone}
                onChange={(e) => setFormData({ ...formData, phone: e.target.value })}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Address
              </label>
              <textarea
                className="w-full p-2 border border-gray-300 rounded-lg"
                rows={2}
                value={formData.address}
                onChange={(e) => setFormData({ ...formData, address: e.target.value })}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Emergency Contact
              </label>
              <input
                type="text"
                className="w-full p-2 border border-gray-300 rounded-lg"
                value={formData.emergencyContact}
                onChange={(e) => setFormData({ ...formData, emergencyContact: e.target.value })}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Admin Notes
              </label>
              <textarea
                className="w-full p-2 border border-gray-300 rounded-lg"
                rows={3}
                value={formData.notes}
                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                placeholder="Add any additional notes about this parent..."
              />
            </div>

            <div className="flex gap-3 pt-4">
              <button
                type="submit"
                className="flex-1 bg-primary-red text-white py-2.5 rounded-lg hover:bg-red-700"
              >
                Save Changes
              </button>
              <button
                type="button"
                onClick={onClose}
                className="flex-1 border border-gray-300 py-2.5 rounded-lg hover:bg-gray-50"
              >
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}

// Add Student Modal Component
function AddStudentModal({ 
  parentId, 
  parentStudents, 
  allStudents, 
  onClose, 
  onAdd 
}: { 
  parentId: Id<"users">; 
  parentStudents: any[];
  allStudents: any[];
  onClose: () => void; 
  onAdd: (studentId: string) => void;
}) {
  const [search, setSearch] = useState("");
  const [selectedStudent, setSelectedStudent] = useState<string>("");
  
  // Get student IDs already assigned to this parent
  const assignedStudentIds = useMemo(() => {
    return new Set(parentStudents.map(student => student._id));
  }, [parentStudents]);

  const filteredStudents = useMemo(() => {
    return allStudents.filter(student => 
      // Filter out already assigned students
      !assignedStudentIds.has(student._id) &&
      // Filter by search
      (search === "" ||
        student.fullName.toLowerCase().includes(search.toLowerCase()) ||
        student.gradeLevel.toLowerCase().includes(search.toLowerCase()))
    );
  }, [allStudents, search, assignedStudentIds]);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!selectedStudent) return;
    await onAdd(selectedStudent);
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        <div className="p-6">
          <div className="flex items-center justify-between mb-6">
            <h2 className="text-xl font-bold text-gray-900">Add Student to Parent</h2>
            <button
              onClick={onClose}
              className="text-gray-400 hover:text-gray-600"
            >
              <i className="fas fa-times"></i>
            </button>
          </div>

          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Search Students
              </label>
              <input
                type="text"
                className="w-full p-2 border border-gray-300 rounded-lg"
                placeholder="Search by name or grade level..."
                value={search}
                onChange={(e) => setSearch(e.target.value)}
              />
            </div>

            <div className="max-h-60 overflow-y-auto border border-gray-200 rounded-lg">
              {filteredStudents.length === 0 ? (
                <div className="p-4 text-center text-gray-500">
                  {search ? "No unassigned students found" : "All students are already assigned"}
                </div>
              ) : (
                <div className="divide-y divide-gray-100">
                  {filteredStudents.map(student => (
                    <label
                      key={student._id}
                      className={`flex items-center gap-3 p-3 cursor-pointer hover:bg-gray-50 ${
                        selectedStudent === student._id ? "bg-blue-50" : ""
                      }`}
                    >
                      <input
                        type="radio"
                        name="student"
                        value={student._id}
                        checked={selectedStudent === student._id}
                        onChange={(e) => setSelectedStudent(e.target.value)}
                        className="text-primary-red"
                      />
                      <div className="flex-1 min-w-0">
                        <div className="font-medium truncate">{student.fullName}</div>
                        <div className="text-sm text-gray-500">{student.gradeLevel}</div>
                      </div>
                      {student.parentId && (
                        <span className="text-xs text-gray-400">Already has parent</span>
                      )}
                    </label>
                  ))}
                </div>
              )}
            </div>

            <div className="flex gap-3 pt-4">
              <button
                type="submit"
                disabled={!selectedStudent}
                className={`flex-1 py-2.5 rounded-lg ${
                  selectedStudent
                    ? "bg-primary-red text-white hover:bg-red-700"
                    : "bg-gray-200 text-gray-400 cursor-not-allowed"
                }`}
              >
                Add Student
              </button>
              <button
                type="button"
                onClick={onClose}
                className="flex-1 border border-gray-300 py-2.5 rounded-lg hover:bg-gray-50"
              >
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}

// Confirm Delete Modal Component
function ConfirmDeleteModal({ 
  parentName, 
  studentCount, 
  onClose, 
  onConfirm 
}: { 
  parentName: string;
  studentCount: number;
  onClose: () => void;
  onConfirm: () => void;
}) {
  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-md w-full">
        <div className="p-6">
          <div className="text-center mb-6">
            <div className="w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4">
              <i className="fas fa-exclamation-triangle text-2xl text-red-600"></i>
            </div>
            <h2 className="text-xl font-bold text-gray-900 mb-2">Delete Parent Account</h2>
            <p className="text-gray-600">
              Are you sure you want to delete <span className="font-semibold">{parentName}</span>?
            </p>
          </div>

          <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
            <div className="flex items-start gap-3">
              <i className="fas fa-exclamation-circle text-red-600 mt-0.5"></i>
              <div>
                <p className="font-medium text-red-800 mb-1">This action cannot be undone</p>
                <ul className="text-sm text-red-700 space-y-1">
                  <li>• The parent account will be permanently deleted</li>
                  <li>• All associated login credentials will be removed</li>
                  {studentCount > 0 && (
                    <li>• {studentCount} student{studentCount !== 1 ? 's' : ''} will lose access to this parent account</li>
                  )}
                </ul>
              </div>
            </div>
          </div>

          <div className="flex gap-3">
            <button
              onClick={onConfirm}
              className="flex-1 bg-red-600 text-white py-2.5 rounded-lg hover:bg-red-700 font-medium"
            >
              Yes, Delete Account
            </button>
            <button
              onClick={onClose}
              className="flex-1 border border-gray-300 py-2.5 rounded-lg hover:bg-gray-50"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}
Now, add these functions to your convex/admin.ts file:

typescript
// Add these to your existing admin.ts file

// Get detailed parent information
export const getParentDetails = query({
  args: { parentId: v.id("users") },
  handler: async (ctx, args) => {
    const parent = await ctx.db.get(args.parentId);
    if (!parent || parent.role !== "parent") return null;
    
    return parent;
  },
});

// Get parent activity log
export const getParentActivity = query({
  args: { parentId: v.id("users") },
  handler: async (ctx, args) => {
    const activities = await ctx.db
      .query("userActivity")
      .withIndex("by_user", (q) => q.eq("userId", args.parentId))
      .order("desc")
      .collect();
    
    return activities;
  },
});

// Update parent information
export const updateParent = mutation({
  args: {
    parentId: v.id("users"),
    fullName: v.string(),
    email: v.string(),
    phone: v.optional(v.string()),
    address: v.optional(v.string()),
    emergencyContact: v.optional(v.string()),
    notes: v.optional(v.string()),
  },
  handler: async (ctx, args) => {
    const { parentId, ...updates } = args;
    
    // Check if email already exists for another user
    if (updates.email) {
      const existingUser = await ctx.db
        .query("users")
        .withIndex("by_email", (q) => q.eq("email", updates.email))
        .first();
      
      if (existingUser && existingUser._id !== parentId) {
        throw new Error("Email already exists for another user");
      }
    }
    
    await ctx.db.patch(parentId, updates);
    
    // Log the activity
    await ctx.db.insert("userActivity", {
      userId: parentId,
      type: "profile_update",
      description: "Profile updated by administrator",
      timestamp: Date.now(),
    });
    
    return parentId;
  },
});

// Add student to parent
export const addStudentToParent = mutation({
  args: {
    parentId: v.id("users"),
    studentId: v.id("students"),
  },
  handler: async (ctx, args) => {
    const student = await ctx.db.get(args.studentId);
    if (!student) throw new Error("Student not found");
    
    // Update student's parentId field
    await ctx.db.patch(args.studentId, {
      parentId: args.parentId,
    });
    
    // Log the activity
    await ctx.db.insert("userActivity", {
      userId: args.parentId,
      type: "student_added",
      description: `Student ${student.fullName} was added to parent account`,
      timestamp: Date.now(),
    });
    
    return args.studentId;
  },
});

// Remove student from parent
export const removeStudentFromParent = mutation({
  args: {
    parentId: v.id("users"),
    studentId: v.id("students"),
  },
  handler: async (ctx, args) => {
    const student = await ctx.db.get(args.studentId);
    if (!student) throw new Error("Student not found");
    
    // Remove parentId from student
    await ctx.db.patch(args.studentId, {
      parentId: undefined,
    });
    
    // Log the activity
    await ctx.db.insert("userActivity", {
      userId: args.parentId,
      type: "student_removed",
      description: `Student ${student.fullName} was removed from parent account`,
      timestamp: Date.now(),
    });
    
    return args.studentId;
  },
});

// Create activity log
export const createActivityLog = mutation({
  args: {
    userId: v.id("users"),
    type: v.string(),
    description: v.string(),
    ipAddress: v.optional(v.string()),
  },
  handler: async (ctx, args) => {
    const activityId = await ctx.db.insert("userActivity", {
      userId: args.userId,
      type: args.type,
      description: args.description,
      timestamp: Date.now(),
      ipAddress: args.ipAddress,
    });
    
    return activityId;
  },
});
You'll also need to create a userActivity table in your schema. Add this to your schema definition:

typescript
// In your schema.ts or where you define tables
userActivity: defineTable({
  userId: v.id("users"),
  type: v.string(), // "login", "logout", "profile_update", "status_change", etc.
  description: v.string(),
  timestamp: v.number(),
  ipAddress: v.optional(v.string()),
})
.index("by_user", ["userId"]),
Finally, add the route to your App.tsx:

tsx
// In App.tsx, add this to your admin routes
<Route path="/admin/parents/:parentId" element={<AdminParentProfile />} />
And update your AdminManageAccounts page to link to parent profiles:

tsx
// In AdminManageAccounts.tsx, update the View button
<Link
  to={`/admin/parents/${u._id}`}
  className="px-3 py-1 bg-gray-50 text-gray-700 rounded text-sm hover:bg-gray-100"
>
  View Profile
</Link>
This parent profile page provides:

Complete parent information - contact details, account status, activity history

Student management - view, add, and remove students from parent account

Activity tracking - log of all parent activities

Account management - edit, disable/enable, delete parent accounts

Responsive design - works on mobile and desktop

Confirmation modals - for destructive actions

Search functionality - for finding students

Statistics - quick overview of parent data

is the useractivity this really needed? if not remake this without it
You're right! The userActivity table isn't necessary for a basic parent profile page. Let me simplify this significantly by removing all activity log functionality and focusing on the essential parent information and student management.

Here's the simplified version without the activity log:

tsx
// pages/AdminParentProfile.tsx
import { useQuery, useMutation } from "convex/react";
import { api } from "../../convex/_generated/api";
import { Navigate, Link, useParams } from "react-router-dom";
import { useAuth } from "../hooks/useAuth";
import { useState, useMemo } from "react";
import { Id } from "../../convex/_generated/dataModel";

type TabType = "overview" | "students";

export default function AdminParentProfile() {
  const { user, role, isLoading } = useAuth();
  const { parentId } = useParams<{ parentId: string }>();
  
  // State
  const [activeTab, setActiveTab] = useState<TabType>("overview");
  const [showEditModal, setShowEditModal] = useState(false);
  const [showAddStudentModal, setShowAddStudentModal] = useState(false);
  const [showConfirmDelete, setShowConfirmDelete] = useState(false);
  const [searchQuery, setSearchQuery] = useState("");

  // Queries
  const parent = useQuery(api.admin.getParentDetails, 
    parentId ? { parentId: parentId as Id<"users"> } : "skip"
  );
  
  const allStudents = useQuery(api.students.listAll);

  // Mutations
  const updateParent = useMutation(api.admin.updateParent);
  const toggleParentStatus = useMutation(api.admin.toggleUserStatus);
  const deleteParent = useMutation(api.admin.deleteUser);
  const addStudentToParent = useMutation(api.admin.addStudentToParent);
  const removeStudentFromParent = useMutation(api.admin.removeStudentFromParent);

  if (isLoading) return null;
  if (!user || role !== "admin") return <Navigate to="/login" />;
  if (!parentId) return <Navigate to="/admin/manage-accounts" />;

  // Get parent's students
  const parentStudents = useMemo(() => {
    if (!parent || !allStudents) return [];
    
    return allStudents.filter(student => 
      student.parentId === parent._id ||
      (student.parents && student.parents.includes(parent._id))
    );
  }, [parent, allStudents]);

  // Filter students by search
  const filteredStudents = useMemo(() => {
    if (!parentStudents) return [];
    
    return parentStudents.filter(student => 
      searchQuery === "" ||
      student.fullName.toLowerCase().includes(searchQuery.toLowerCase()) ||
      student.gradeLevel.toLowerCase().includes(searchQuery.toLowerCase())
    );
  }, [parentStudents, searchQuery]);

  // Calculate statistics
  const stats = useMemo(() => {
    return {
      totalStudents: parentStudents?.length || 0,
      activeStudents: parentStudents?.filter(s => s.isActive).length || 0,
    };
  }, [parentStudents]);

  // Handlers
  const handleToggleStatus = async () => {
    if (!parent) return;
    
    try {
      await toggleParentStatus({ 
        userId: parent._id, 
        status: !parent.isActive 
      });
    } catch (error) {
      console.error("Error toggling parent status:", error);
    }
  };

  const handleDeleteParent = async () => {
    if (!parent) return;
    
    try {
      await deleteParent({ userId: parent._id });
      // Redirect after deletion
      window.location.href = "/admin/manage-accounts";
    } catch (error) {
      console.error("Error deleting parent:", error);
    }
  };

  const handleRemoveStudent = async (studentId: Id<"students">) => {
    if (!parent) return;
    
    if (!window.confirm("Are you sure you want to remove this student from the parent?")) return;
    
    try {
      await removeStudentFromParent({
        parentId: parent._id,
        studentId
      });
    } catch (error) {
      console.error("Error removing student:", error);
    }
  };

  const handleAddStudent = async (studentId: string) => {
    if (!parent) return;
    
    try {
      await addStudentToParent({
        parentId: parent._id,
        studentId: studentId as Id<"students">
      });
      
      setShowAddStudentModal(false);
    } catch (error) {
      console.error("Error adding student:", error);
    }
  };

  if (parent === undefined) {
    return (
      <div className="flex items-center justify-center min-h-[400px]">
        <div className="text-center">
          <i className="fas fa-spinner fa-spin text-3xl text-primary-red mb-3"></i>
          <p className="text-gray-600">Loading parent information...</p>
        </div>
      </div>
    );
  }

  if (parent === null) {
    return (
      <div className="max-w-4xl mx-auto px-4 py-8">
        <div className="bg-white rounded-xl border border-gray-200 p-8 text-center">
          <i className="fas fa-user-slash text-4xl text-gray-300 mb-4"></i>
          <h2 className="text-xl font-bold text-gray-800 mb-2">Parent Not Found</h2>
          <p className="text-gray-600 mb-6">The parent account you're looking for doesn't exist or has been deleted.</p>
          <Link
            to="/admin/manage-accounts"
            className="inline-flex items-center gap-2 px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700"
          >
            <i className="fas fa-arrow-left"></i>
            Back to Parent Management
          </Link>
        </div>
      </div>
    );
  }

  return (
    <div className="max-w-7xl mx-auto px-4 py-8 space-y-6">
      {/* Header with breadcrumb */}
      <div className="flex items-center gap-2 text-sm text-gray-600 mb-4">
        <Link to="/admin" className="hover:text-primary-red">Dashboard</Link>
        <i className="fas fa-chevron-right text-xs"></i>
        <Link to="/admin/manage-accounts" className="hover:text-primary-red">Manage Accounts</Link>
        <i className="fas fa-chevron-right text-xs"></i>
        <span className="font-medium text-gray-900">{parent.fullName}</span>
      </div>

      {/* Parent Header */}
      <div className="bg-white rounded-xl border border-gray-200 p-6">
        <div className="flex flex-col md:flex-row md:items-center justify-between gap-6">
          <div className="flex items-center gap-4">
            <div className="w-20 h-20 rounded-full bg-primary-red/10 flex items-center justify-center">
              <i className="fas fa-user text-3xl text-primary-red"></i>
            </div>
            <div>
              <h1 className="text-2xl md:text-3xl font-bold text-gray-900">{parent.fullName}</h1>
              <div className="flex flex-wrap items-center gap-2 mt-2">
                <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                  parent.isActive 
                    ? "bg-green-100 text-green-800" 
                    : "bg-red-100 text-red-800"
                }`}>
                  {parent.isActive ? "Active" : "Disabled"}
                </span>
                <span className="text-gray-600">•</span>
                <span className="text-gray-600">{parent.email}</span>
                <span className="text-gray-600">•</span>
                <span className="text-gray-600">Parent since {new Date(parent._creationTime).toLocaleDateString()}</span>
              </div>
            </div>
          </div>

          <div className="flex flex-wrap gap-2">
            <button
              onClick={() => setShowEditModal(true)}
              className="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2"
            >
              <i className="fas fa-edit"></i>
              Edit Profile
            </button>
            <button
              onClick={handleToggleStatus}
              className={`px-4 py-2 rounded-lg flex items-center gap-2 ${
                parent.isActive
                  ? "bg-red-50 text-red-600 hover:bg-red-100"
                  : "bg-green-50 text-green-600 hover:bg-green-100"
              }`}
            >
              <i className={`fas fa-${parent.isActive ? "ban" : "check"}`}></i>
              {parent.isActive ? "Disable Account" : "Activate Account"}
            </button>
            <button
              onClick={() => setShowConfirmDelete(true)}
              className="px-4 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 flex items-center gap-2"
            >
              <i className="fas fa-trash"></i>
              Delete
            </button>
          </div>
        </div>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div className="bg-white border border-gray-200 rounded-xl p-5">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Registered Students</p>
              <p className="text-2xl font-bold text-gray-900">{stats.totalStudents}</p>
            </div>
            <div className="w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center">
              <i className="fas fa-user-graduate text-blue-600 text-xl"></i>
            </div>
          </div>
        </div>

        <div className="bg-white border border-gray-200 rounded-xl p-5">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Active Students</p>
              <p className="text-2xl font-bold text-green-600">{stats.activeStudents}</p>
            </div>
            <div className="w-12 h-12 rounded-full bg-green-50 flex items-center justify-center">
              <i className="fas fa-check-circle text-green-600 text-xl"></i>
            </div>
          </div>
        </div>
      </div>

      {/* Tabs */}
      <div className="bg-white rounded-xl border border-gray-200">
        <div className="border-b border-gray-200">
          <nav className="flex -mb-px">
            <button
              onClick={() => setActiveTab("overview")}
              className={`px-6 py-4 font-medium text-sm border-b-2 ${
                activeTab === "overview"
                  ? "border-primary-red text-primary-red"
                  : "border-transparent text-gray-500 hover:text-gray-700"
              }`}
            >
              <i className="fas fa-info-circle mr-2"></i>
              Overview
            </button>
            <button
              onClick={() => setActiveTab("students")}
              className={`px-6 py-4 font-medium text-sm border-b-2 ${
                activeTab === "students"
                  ? "border-primary-red text-primary-red"
                  : "border-transparent text-gray-500 hover:text-gray-700"
              }`}
            >
              <i className="fas fa-user-graduate mr-2"></i>
              Students ({parentStudents.length})
            </button>
          </nav>
        </div>

        <div className="p-6">
          {/* Overview Tab */}
          {activeTab === "overview" && (
            <div className="space-y-6">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {/* Contact Information */}
                <div className="bg-gray-50 rounded-lg p-5">
                  <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                    <i className="fas fa-address-card text-primary-red"></i>
                    Contact Information
                  </h3>
                  <div className="space-y-3">
                    <div>
                      <p className="text-sm text-gray-500">Full Name</p>
                      <p className="font-medium">{parent.fullName}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Email Address</p>
                      <p className="font-medium">{parent.email}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Phone Number</p>
                      <p className="font-medium">{parent.phone || "Not provided"}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Address</p>
                      <p className="font-medium">{parent.address || "Not provided"}</p>
                    </div>
                  </div>
                </div>

                {/* Account Information */}
                <div className="bg-gray-50 rounded-lg p-5">
                  <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                    <i className="fas fa-user-cog text-primary-red"></i>
                    Account Information
                  </h3>
                  <div className="space-y-3">
                    <div>
                      <p className="text-sm text-gray-500">Account Status</p>
                      <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                        parent.isActive 
                          ? "bg-green-100 text-green-800" 
                          : "bg-red-100 text-red-800"
                      }`}>
                        {parent.isActive ? "Active" : "Disabled"}
                      </span>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Account Created</p>
                      <p className="font-medium">{new Date(parent._creationTime).toLocaleDateString()}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Last Login</p>
                      <p className="font-medium">
                        {parent.lastLogin 
                          ? new Date(parent.lastLogin).toLocaleString()
                          : "Never logged in"
                        }
                      </p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">User ID</p>
                      <p className="font-medium font-mono text-sm">{parent._id}</p>
                    </div>
                  </div>
                </div>
              </div>

              {/* Additional Information */}
              {(parent.emergencyContact || parent.notes) && (
                <div className="bg-gray-50 rounded-lg p-5">
                  <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                    <i className="fas fa-sticky-note text-primary-red"></i>
                    Additional Information
                  </h3>
                  <div className="space-y-4">
                    {parent.emergencyContact && (
                      <div>
                        <p className="text-sm text-gray-500">Emergency Contact</p>
                        <p className="font-medium">{parent.emergencyContact}</p>
                      </div>
                    )}
                    {parent.notes && (
                      <div>
                        <p className="text-sm text-gray-500">Admin Notes</p>
                        <p className="font-medium whitespace-pre-wrap">{parent.notes}</p>
                      </div>
                    )}
                  </div>
                </div>
              )}
            </div>
          )}

          {/* Students Tab */}
          {activeTab === "students" && (
            <div className="space-y-6">
              <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                <h3 className="text-lg font-semibold text-gray-900">
                  Registered Students ({parentStudents.length})
                </h3>
                <div className="flex gap-2">
                  <div className="relative">
                    <i className="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    <input
                      type="text"
                      placeholder="Search students..."
                      className="pl-10 pr-4 py-2 border border-gray-300 rounded-lg w-full sm:w-64"
                      value={searchQuery}
                      onChange={(e) => setSearchQuery(e.target.value)}
                    />
                  </div>
                  <button
                    onClick={() => setShowAddStudentModal(true)}
                    className="px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700 flex items-center gap-2"
                  >
                    <i className="fas fa-plus"></i>
                    Add Student
                  </button>
                </div>
              </div>

              {parentStudents.length === 0 ? (
                <div className="text-center py-12 bg-gray-50 rounded-lg">
                  <i className="fas fa-user-graduate text-4xl text-gray-300 mb-4"></i>
                  <h4 className="text-lg font-medium text-gray-700 mb-2">No Students Registered</h4>
                  <p className="text-gray-500 mb-6">This parent doesn't have any registered students yet.</p>
                  <button
                    onClick={() => setShowAddStudentModal(true)}
                    className="px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700 flex items-center gap-2 mx-auto"
                  >
                    <i className="fas fa-plus"></i>
                    Add First Student
                  </button>
                </div>
              ) : filteredStudents.length === 0 ? (
                <div className="text-center py-12 bg-gray-50 rounded-lg">
                  <i className="fas fa-search text-4xl text-gray-300 mb-4"></i>
                  <h4 className="text-lg font-medium text-gray-700 mb-2">No Students Found</h4>
                  <p className="text-gray-500">Try adjusting your search query.</p>
                </div>
              ) : (
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                  {filteredStudents.map(student => (
                    <div key={student._id} className="bg-white border border-gray-200 rounded-xl p-5 hover:shadow-sm transition-shadow">
                      <div className="flex items-start justify-between mb-4">
                        <div>
                          <h4 className="font-semibold text-gray-900">{student.fullName}</h4>
                          <p className="text-sm text-gray-500">{student.gradeLevel}</p>
                        </div>
                        <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                          student.isActive 
                            ? "bg-green-100 text-green-800" 
                            : "bg-red-100 text-red-800"
                        }`}>
                          {student.isActive ? "Active" : "Inactive"}
                        </span>
                      </div>
                      
                      <div className="space-y-2 mb-4">
                        <div className="flex items-center gap-2 text-sm">
                          <i className="fas fa-id-card text-gray-400"></i>
                          <span>ID: {student.studentId || "N/A"}</span>
                        </div>
                        <div className="flex items-center gap-2 text-sm">
                          <i className="fas fa-birthday-cake text-gray-400"></i>
                          <span>DOB: {student.dateOfBirth 
                            ? new Date(student.dateOfBirth).toLocaleDateString()
                            : "N/A"
                          }</span>
                        </div>
                        <div className="flex items-center gap-2 text-sm">
                          <i className="fas fa-calendar-alt text-gray-400"></i>
                          <span>Enrolled: {student.enrollmentDate 
                            ? new Date(student.enrollmentDate).toLocaleDateString()
                            : "N/A"
                          }</span>
                        </div>
                      </div>

                      <div className="flex gap-2 pt-4 border-t border-gray-100">
                        <Link
                          to={`/staff/performance/${student._id}`}
                          className="flex-1 px-3 py-1.5 bg-gray-50 text-gray-700 rounded text-sm hover:bg-gray-100 text-center"
                        >
                          View Profile
                        </Link>
                        <button
                          onClick={() => handleRemoveStudent(student._id)}
                          className="px-3 py-1.5 bg-red-50 text-red-600 rounded text-sm hover:bg-red-100"
                        >
                          Remove
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}
        </div>
      </div>

      {/* Modals - Keep the same EditParentModal, AddStudentModal, and ConfirmDeleteModal */}
      {showEditModal && (
        <EditParentModal
          parent={parent}
          onClose={() => setShowEditModal(false)}
          onSave={updateParent}
        />
      )}

      {showAddStudentModal && (
        <AddStudentModal
          parentId={parent._id}
          parentStudents={parentStudents}
          allStudents={allStudents || []}
          onClose={() => setShowAddStudentModal(false)}
          onAdd={handleAddStudent}
        />
      )}

      {showConfirmDelete && (
        <ConfirmDeleteModal
          parentName={parent.fullName}
          studentCount={parentStudents.length}
          onClose={() => setShowConfirmDelete(false)}
          onConfirm={handleDeleteParent}
        />
      )}
    </div>
  );
}

// EditParentModal, AddStudentModal, and ConfirmDeleteModal components remain the same
// They don't have any activity log dependencies
And here are the simplified admin.ts functions without activity logging:

typescript
// Add these to your existing admin.ts file

// Get detailed parent information
export const getParentDetails = query({
  args: { parentId: v.id("users") },
  handler: async (ctx, args) => {
    const parent = await ctx.db.get(args.parentId);
    if (!parent || parent.role !== "parent") return null;
    
    return parent;
  },
});

// Update parent information
export const updateParent = mutation({
  args: {
    parentId: v.id("users"),
    fullName: v.string(),
    email: v.string(),
    phone: v.optional(v.string()),
    address: v.optional(v.string()),
    emergencyContact: v.optional(v.string()),
    notes: v.optional(v.string()),
  },
  handler: async (ctx, args) => {
    const { parentId, ...updates } = args;
    
    // Check if email already exists for another user
    if (updates.email) {
      const existingUser = await ctx.db
        .query("users")
        .withIndex("by_email", (q) => q.eq("email", updates.email))
        .first();
      
      if (existingUser && existingUser._id !== parentId) {
        throw new Error("Email already exists for another user");
      }
    }
    
    await ctx.db.patch(parentId, updates);
    return parentId;
  },
});

// Add student to parent
export const addStudentToParent = mutation({
  args: {
    parentId: v.id("users"),
    studentId: v.id("students"),
  },
  handler: async (ctx, args) => {
    const student = await ctx.db.get(args.studentId);
    if (!student) throw new Error("Student not found");
    
    // Update student's parentId field
    await ctx.db.patch(args.studentId, {
      parentId: args.parentId,
    });
    
    return args.studentId;
  },
});

// Remove student from parent
export const removeStudentFromParent = mutation({
  args: {
    parentId: v.id("users"),
    studentId: v.id("students"),
  },
  handler: async (ctx, args) => {
    const student = await ctx.db.get(args.studentId);
    if (!student) throw new Error("Student not found");
    
    // Remove parentId from student
    await ctx.db.patch(args.studentId, {
      parentId: undefined,
    });
    
    return args.studentId;
  },
});
Key simplifications made:

Removed Activity Log tab and all related code

Removed userActivity table dependency (no need to create it)

Simplified stats - only show student counts, not login activity

Removed activity logging mutations from all handlers

Simplified UI - only 2 tabs now (Overview and Students)

Fewer API calls - no need to fetch activity logs

Cleaner codebase - much less complex without the activity tracking system

This simplified version still provides all the essential functionality:

✅ View complete parent information

✅ Manage parent account (edit, disable/enable, delete)

✅ View and manage parent's students

✅ Add/remove students from parent account

✅ Search students

✅ Responsive design

✅ Confirmation modals for destructive actions

The page is now much simpler, faster to load, and easier to maintain while still providing all the core functionality needed for parent management.

okay bro I'm gonna provide my whole schema, make it accordingly 

import { defineSchema, defineTable } from "convex/server";
import { v } from "convex/values";

export default defineSchema({

  users: defineTable({
    email: v.string(),
    passwordHash: v.string(),
    fullName: v.string(),
    role: v.union(
      v.literal("parent"),
      v.literal("staff"),
      v.literal("admin")
    ),
    isActive: v.boolean(),
  }).index("by_email", ["email"]),

  sessions: defineTable({
    userId: v.id("users"),
    token: v.string(),
    expiresAt: v.number(),
  }).index("by_token", ["token"]),

  parents: defineTable({
    email: v.string(),
    passwordHash: v.string(),
    fullName: v.string(),
    isActive: v.boolean(),
  }).index("by_email", ["email"]),

  students: defineTable({
    parentId: v.id("users"),
    fullName: v.string(),
    gradeLevel: v.string(),
    overall: v.optional(v.number()),
    letterGrade: v.optional(v.string()),
  }).index("by_parent", ["parentId"]),


  admins: defineTable({
    email: v.string(),
    passwordHash: v.string(),
    fullName: v.string(),
    isActive: v.boolean(),
  }).index("by_email", ["email"]),

  staff: defineTable({
    email: v.string(),
    passwordHash: v.string(),
    fullName: v.string(),
    isActive: v.boolean(),
  }).index("by_email", ["email"]),

  messages: defineTable({
    name: v.string(),
    email: v.string(),
    contactNo: v.string(),
    message: v.string(),
    createdAt: v.number(),
    status: v.union(
      v.literal("new"),
      v.literal("read"),
      v.literal("archived")
    ),

  }).index("by_status", ["status"])
    .index("by_createdAt", ["createdAt"]),

  terms: defineTable({
    name: v.string(), // "Term 1"
    startDate: v.string(),
    endDate: v.string(),
    isActive: v.boolean(),
  }),

 classSubjects: defineTable({
  subjectId: v.id("subjects"),
  gradeLevel: v.string(),
  termId: v.id("terms"),
  weight: v.number(),
}).index("by_grade_term", ["gradeLevel", "termId"]),



  // GRADES COMPONENTS


  grades: defineTable({
    studentId: v.id("students"),
    subject: v.string(),
    score: v.number(),
    term: v.string(), // e.g. "Term 1"
    createdAt: v.number(),
  }).index("by_student", ["studentId"]),

  subjects: defineTable({
    name: v.string(),
  }).index("by_name", ["name"]),

  subjectComponents: defineTable({
    classSubjectId: v.id("classSubjects"),
    name: v.string(),
    weight: v.number(),
  }).index("by_classSubject", ["classSubjectId"]),

  componentGrades: defineTable({
    studentId: v.id("students"),
    classSubjectId: v.id("classSubjects"),
    componentId: v.id("subjectComponents"),
    score: v.number(),
  })
    .index("by_student_classSubject", ["studentId", "classSubjectId"])
    .index("by_component", ["componentId"]),


    
staffApplications: defineTable({
  userId: v.id("users"),
  position: v.string(),
  status: v.union(
    v.literal("draft"),
    v.literal("submitted"),
    v.literal("approved"),
    v.literal("rejected")
  ),
  submittedAt: v.optional(v.number()),
}),

documents: defineTable({
  ownerType: v.union(
    v.literal("studentApplication"),
    v.literal("staffApplication"),
    v.literal("event")
  ),

  ownerId: v.union(
    v.id("studentApplications"),
    v.id("staffApplications"),
    v.id("events")
  ),

  documentType: v.string(), // validated in backend
  fileId: v.id("_storage"),
  originalFilename: v.string(),

  uploadedBy: v.id("users"),
  uploadedAt: v.number(),
})
.index("by_owner", ["ownerType", "ownerId"]),

events: defineTable({
  title: v.string(),
  description: v.optional(v.string()),
  createdBy: v.id("users"),
  createdAt: v.number(),
}),




studentApplications: defineTable({
  /* =====================
     STUDENT INFORMATION
     ===================== */
  studentFirstName: v.string(),
  studentLastName: v.string(),
  middleName: v.optional(v.string()),
  dateOfBirth: v.string(),
  gender: v.optional(v.string()),

  programType: v.string(),        // e.g. Preschool, Primary, Secondary
  intendedGradeLevel: v.optional(v.string()),
  startDate: v.string(),

  medicalInfo: v.optional(v.string()),

  /* =====================
     PARENT / GUARDIAN
     ===================== */
  primaryParentName: v.string(),
  relationship: v.string(),
  email: v.string(),
  phone: v.string(),

  secondaryParentName: v.optional(v.string()),
  secondaryRelationship: v.optional(v.string()),
  secondaryEmail: v.optional(v.string()),
  secondaryPhone: v.optional(v.string()),

  emergencyName: v.string(),
  emergencyRelationship: v.string(),
  emergencyPhone: v.string(),

  /* =====================
     APPLICATION METADATA
     ===================== */
  submittedBy: v.optional(v.id("users")),   // parent account (optional for public registrations)
  termId: v.optional(v.id("terms")), // intake term (Fall 2026, etc.)

  status: v.union(
    v.literal("draft"),
    v.literal("submitted"),
    v.literal("under_review"),
    v.literal("approved"),
    v.literal("rejected")
  ),

  reviewedBy: v.optional(v.id("users")), // staff/admin
  reviewedAt: v.optional(v.number()),
  rejectionReason: v.optional(v.string()),

  createdAt: v.number(),
  updatedAt: v.optional(v.number()),
})
  .index("by_status", ["status"])
  .index("by_parent", ["submittedBy"])
  .index("by_term", ["termId"]),


});


userActivity: defineTable({
  userId: v.id("users"),
  type: v.string(), // "login", "logout", "profile_update", "status_change", etc.
  description: v.string(),
  timestamp: v.number(),
  ipAddress: v.optional(v.string()),
})
.index("by_user", ["userId"])
Looking at your schema, I can see we have the basic structure but need to make some adjustments for the parent profile page. Based on your schema, here's the updated parent profile page and the required admin functions:

tsx
// pages/AdminParentProfile.tsx
import { useQuery, useMutation } from "convex/react";
import { api } from "../../convex/_generated/api";
import { Navigate, Link, useParams } from "react-router-dom";
import { useAuth } from "../hooks/useAuth";
import { useState, useMemo } from "react";
import { Id } from "../../convex/_generated/dataModel";

type TabType = "overview" | "students";

export default function AdminParentProfile() {
  const { user, role, isLoading } = useAuth();
  const { parentId } = useParams<{ parentId: string }>();
  
  // State
  const [activeTab, setActiveTab] = useState<TabType>("overview");
  const [showEditModal, setShowEditModal] = useState(false);
  const [showAddStudentModal, setShowAddStudentModal] = useState(false);
  const [showConfirmDelete, setShowConfirmDelete] = useState(false);
  const [searchQuery, setSearchQuery] = useState("");

  // Queries - using existing queries from your schema
  const parent = useQuery(api.users.getById, 
    parentId ? { userId: parentId as Id<"users"> } : "skip"
  );
  
  const allStudents = useQuery(api.students.listAll);
  const parentStudents = useQuery(api.admin.getParentStudents, 
    parentId ? { parentId: parentId as Id<"users"> } : "skip"
  );

  // Mutations - using existing mutations
  const updateUser = useMutation(api.users.update);
  const toggleUserStatus = useMutation(api.admin.toggleUserStatus);
  const deleteUser = useMutation(api.admin.deleteUser);
  const assignStudentToParent = useMutation(api.admin.assignStudentToParent);
  const unassignStudentFromParent = useMutation(api.admin.unassignStudentFromParent);

  if (isLoading) return null;
  if (!user || role !== "admin") return <Navigate to="/login" />;
  if (!parentId) return <Navigate to="/admin/manage-accounts" />;

  // Validate that this is actually a parent
  if (parent && parent.role !== "parent") {
    return <Navigate to="/admin/manage-accounts" />;
  }

  // Filter students by search
  const filteredStudents = useMemo(() => {
    if (!parentStudents) return [];
    
    return parentStudents.filter(student => 
      searchQuery === "" ||
      student.fullName.toLowerCase().includes(searchQuery.toLowerCase()) ||
      student.gradeLevel.toLowerCase().includes(searchQuery.toLowerCase())
    );
  }, [parentStudents, searchQuery]);

  // Calculate statistics
  const stats = useMemo(() => {
    return {
      totalStudents: parentStudents?.length || 0,
      activeStudents: parentStudents?.length || 0, // Assuming all students are active in your schema
    };
  }, [parentStudents]);

  // Handlers
  const handleToggleStatus = async () => {
    if (!parent) return;
    
    try {
      await toggleUserStatus({ 
        userId: parent._id, 
        status: !parent.isActive 
      });
    } catch (error) {
      console.error("Error toggling parent status:", error);
    }
  };

  const handleDeleteParent = async () => {
    if (!parent) return;
    
    try {
      await deleteUser({ userId: parent._id });
      // Redirect after deletion
      window.location.href = "/admin/manage-accounts";
    } catch (error) {
      console.error("Error deleting parent:", error);
    }
  };

  const handleRemoveStudent = async (studentId: Id<"students">) => {
    if (!parent) return;
    
    if (!window.confirm("Are you sure you want to remove this student from the parent?")) return;
    
    try {
      await unassignStudentFromParent({
        parentId: parent._id,
        studentId
      });
    } catch (error) {
      console.error("Error removing student:", error);
    }
  };

  const handleAddStudent = async (studentId: string) => {
    if (!parent) return;
    
    try {
      await assignStudentToParent({
        parentId: parent._id,
        studentId: studentId as Id<"students">
      });
      
      setShowAddStudentModal(false);
    } catch (error) {
      console.error("Error adding student:", error);
    }
  };

  if (parent === undefined) {
    return (
      <div className="flex items-center justify-center min-h-[400px]">
        <div className="text-center">
          <i className="fas fa-spinner fa-spin text-3xl text-primary-red mb-3"></i>
          <p className="text-gray-600">Loading parent information...</p>
        </div>
      </div>
    );
  }

  if (parent === null) {
    return (
      <div className="max-w-4xl mx-auto px-4 py-8">
        <div className="bg-white rounded-xl border border-gray-200 p-8 text-center">
          <i className="fas fa-user-slash text-4xl text-gray-300 mb-4"></i>
          <h2 className="text-xl font-bold text-gray-800 mb-2">Parent Not Found</h2>
          <p className="text-gray-600 mb-6">The parent account you're looking for doesn't exist or has been deleted.</p>
          <Link
            to="/admin/manage-accounts"
            className="inline-flex items-center gap-2 px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700"
          >
            <i className="fas fa-arrow-left"></i>
            Back to Parent Management
          </Link>
        </div>
      </div>
    );
  }

  return (
    <div className="max-w-7xl mx-auto px-4 py-8 space-y-6">
      {/* Header with breadcrumb */}
      <div className="flex items-center gap-2 text-sm text-gray-600 mb-4">
        <Link to="/admin" className="hover:text-primary-red">Dashboard</Link>
        <i className="fas fa-chevron-right text-xs"></i>
        <Link to="/admin/manage-accounts" className="hover:text-primary-red">Manage Accounts</Link>
        <i className="fas fa-chevron-right text-xs"></i>
        <span className="font-medium text-gray-900">{parent.fullName}</span>
      </div>

      {/* Parent Header */}
      <div className="bg-white rounded-xl border border-gray-200 p-6">
        <div className="flex flex-col md:flex-row md:items-center justify-between gap-6">
          <div className="flex items-center gap-4">
            <div className="w-20 h-20 rounded-full bg-primary-red/10 flex items-center justify-center">
              <i className="fas fa-user text-3xl text-primary-red"></i>
            </div>
            <div>
              <h1 className="text-2xl md:text-3xl font-bold text-gray-900">{parent.fullName}</h1>
              <div className="flex flex-wrap items-center gap-2 mt-2">
                <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                  parent.isActive 
                    ? "bg-green-100 text-green-800" 
                    : "bg-red-100 text-red-800"
                }`}>
                  {parent.isActive ? "Active" : "Disabled"}
                </span>
                <span className="text-gray-600">•</span>
                <span className="text-gray-600">{parent.email}</span>
                <span className="text-gray-600">•</span>
                <span className="text-gray-600">Parent since {new Date(parent._creationTime).toLocaleDateString()}</span>
              </div>
            </div>
          </div>

          <div className="flex flex-wrap gap-2">
            <button
              onClick={() => setShowEditModal(true)}
              className="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2"
            >
              <i className="fas fa-edit"></i>
              Edit Profile
            </button>
            <button
              onClick={handleToggleStatus}
              className={`px-4 py-2 rounded-lg flex items-center gap-2 ${
                parent.isActive
                  ? "bg-red-50 text-red-600 hover:bg-red-100"
                  : "bg-green-50 text-green-600 hover:bg-green-100"
              }`}
            >
              <i className={`fas fa-${parent.isActive ? "ban" : "check"}`}></i>
              {parent.isActive ? "Disable Account" : "Activate Account"}
            </button>
            <button
              onClick={() => setShowConfirmDelete(true)}
              className="px-4 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 flex items-center gap-2"
            >
              <i className="fas fa-trash"></i>
              Delete
            </button>
          </div>
        </div>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div className="bg-white border border-gray-200 rounded-xl p-5">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Registered Students</p>
              <p className="text-2xl font-bold text-gray-900">{stats.totalStudents}</p>
            </div>
            <div className="w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center">
              <i className="fas fa-user-graduate text-blue-600 text-xl"></i>
            </div>
          </div>
        </div>

        <div className="bg-white border border-gray-200 rounded-xl p-5">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Account Status</p>
              <div className="text-2xl font-bold">
                <span className={parent.isActive ? "text-green-600" : "text-red-600"}>
                  {parent.isActive ? "Active" : "Disabled"}
                </span>
              </div>
            </div>
            <div className={`w-12 h-12 rounded-full flex items-center justify-center ${
              parent.isActive ? "bg-green-50" : "bg-red-50"
            }`}>
              <i className={`fas fa-${parent.isActive ? "check-circle" : "ban"} text-xl ${
                parent.isActive ? "text-green-600" : "text-red-600"
              }`}></i>
            </div>
          </div>
        </div>
      </div>

      {/* Tabs */}
      <div className="bg-white rounded-xl border border-gray-200">
        <div className="border-b border-gray-200">
          <nav className="flex -mb-px">
            <button
              onClick={() => setActiveTab("overview")}
              className={`px-6 py-4 font-medium text-sm border-b-2 ${
                activeTab === "overview"
                  ? "border-primary-red text-primary-red"
                  : "border-transparent text-gray-500 hover:text-gray-700"
              }`}
            >
              <i className="fas fa-info-circle mr-2"></i>
              Overview
            </button>
            <button
              onClick={() => setActiveTab("students")}
              className={`px-6 py-4 font-medium text-sm border-b-2 ${
                activeTab === "students"
                  ? "border-primary-red text-primary-red"
                  : "border-transparent text-gray-500 hover:text-gray-700"
              }`}
            >
              <i className="fas fa-user-graduate mr-2"></i>
              Students ({parentStudents?.length || 0})
            </button>
          </nav>
        </div>

        <div className="p-6">
          {/* Overview Tab */}
          {activeTab === "overview" && (
            <div className="space-y-6">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {/* Contact Information */}
                <div className="bg-gray-50 rounded-lg p-5">
                  <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                    <i className="fas fa-address-card text-primary-red"></i>
                    Contact Information
                  </h3>
                  <div className="space-y-3">
                    <div>
                      <p className="text-sm text-gray-500">Full Name</p>
                      <p className="font-medium">{parent.fullName}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Email Address</p>
                      <p className="font-medium">{parent.email}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Account Role</p>
                      <p className="font-medium capitalize">{parent.role}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Account Created</p>
                      <p className="font-medium">{new Date(parent._creationTime).toLocaleDateString()}</p>
                    </div>
                  </div>
                </div>

                {/* Account Information */}
                <div className="bg-gray-50 rounded-lg p-5">
                  <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                    <i className="fas fa-user-cog text-primary-red"></i>
                    Account Information
                  </h3>
                  <div className="space-y-3">
                    <div>
                      <p className="text-sm text-gray-500">Account Status</p>
                      <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                        parent.isActive 
                          ? "bg-green-100 text-green-800" 
                          : "bg-red-100 text-red-800"
                      }`}>
                        {parent.isActive ? "Active" : "Disabled"}
                      </span>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">User ID</p>
                      <p className="font-medium font-mono text-sm break-all">{parent._id}</p>
                    </div>
                    <div>
                      <p className="text-sm text-gray-500">Associated Students</p>
                      <p className="font-medium">{parentStudents?.length || 0} student(s)</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Students Tab */}
          {activeTab === "students" && (
            <div className="space-y-6">
              <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                <h3 className="text-lg font-semibold text-gray-900">
                  Registered Students ({parentStudents?.length || 0})
                </h3>
                <div className="flex gap-2">
                  <div className="relative">
                    <i className="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    <input
                      type="text"
                      placeholder="Search students..."
                      className="pl-10 pr-4 py-2 border border-gray-300 rounded-lg w-full sm:w-64"
                      value={searchQuery}
                      onChange={(e) => setSearchQuery(e.target.value)}
                    />
                  </div>
                  <button
                    onClick={() => setShowAddStudentModal(true)}
                    className="px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700 flex items-center gap-2"
                  >
                    <i className="fas fa-plus"></i>
                    Add Student
                  </button>
                </div>
              </div>

              {parentStudents === undefined ? (
                <div className="text-center py-8">
                  <i className="fas fa-spinner fa-spin text-2xl text-primary-red mb-3"></i>
                  <p className="text-gray-600">Loading students...</p>
                </div>
              ) : parentStudents.length === 0 ? (
                <div className="text-center py-12 bg-gray-50 rounded-lg">
                  <i className="fas fa-user-graduate text-4xl text-gray-300 mb-4"></i>
                  <h4 className="text-lg font-medium text-gray-700 mb-2">No Students Registered</h4>
                  <p className="text-gray-500 mb-6">This parent doesn't have any registered students yet.</p>
                  <button
                    onClick={() => setShowAddStudentModal(true)}
                    className="px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700 flex items-center gap-2 mx-auto"
                  >
                    <i className="fas fa-plus"></i>
                    Add First Student
                  </button>
                </div>
              ) : filteredStudents.length === 0 ? (
                <div className="text-center py-12 bg-gray-50 rounded-lg">
                  <i className="fas fa-search text-4xl text-gray-300 mb-4"></i>
                  <h4 className="text-lg font-medium text-gray-700 mb-2">No Students Found</h4>
                  <p className="text-gray-500">Try adjusting your search query.</p>
                </div>
              ) : (
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                  {filteredStudents.map(student => (
                    <div key={student._id} className="bg-white border border-gray-200 rounded-xl p-5 hover:shadow-sm transition-shadow">
                      <div className="flex items-start justify-between mb-4">
                        <div>
                          <h4 className="font-semibold text-gray-900">{student.fullName}</h4>
                          <p className="text-sm text-gray-500">{student.gradeLevel}</p>
                        </div>
                        {student.overall !== undefined && (
                          <div className="text-right">
                            <div className={`text-lg font-bold ${
                              student.overall >= 85 ? "text-green-600" :
                              student.overall >= 70 ? "text-blue-600" :
                              student.overall >= 60 ? "text-yellow-600" : "text-red-600"
                            }`}>
                              {student.overall}%
                            </div>
                            <div className="text-xs text-gray-500">Overall</div>
                          </div>
                        )}
                      </div>
                      
                      <div className="space-y-2 mb-4">
                        <div className="flex items-center gap-2 text-sm">
                          <i className="fas fa-graduation-cap text-gray-400"></i>
                          <span>Grade: {student.gradeLevel}</span>
                        </div>
                        {student.letterGrade && (
                          <div className="flex items-center gap-2 text-sm">
                            <i className="fas fa-award text-gray-400"></i>
                            <span>Grade: {student.letterGrade}</span>
                          </div>
                        )}
                      </div>

                      <div className="flex gap-2 pt-4 border-t border-gray-100">
                        <Link
                          to={`/staff/performance/${student._id}`}
                          className="flex-1 px-3 py-1.5 bg-gray-50 text-gray-700 rounded text-sm hover:bg-gray-100 text-center"
                        >
                          View Profile
                        </Link>
                        <button
                          onClick={() => handleRemoveStudent(student._id)}
                          className="px-3 py-1.5 bg-red-50 text-red-600 rounded text-sm hover:bg-red-100"
                        >
                          Remove
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}
        </div>
      </div>

      {/* Modals */}
      {showEditModal && (
        <EditParentModal
          parent={parent}
          onClose={() => setShowEditModal(false)}
          onSave={updateUser}
        />
      )}

      {showAddStudentModal && (
        <AddStudentModal
          parentId={parent._id}
          parentStudents={parentStudents || []}
          allStudents={allStudents || []}
          onClose={() => setShowAddStudentModal(false)}
          onAdd={handleAddStudent}
        />
      )}

      {showConfirmDelete && (
        <ConfirmDeleteModal
          parentName={parent.fullName}
          studentCount={parentStudents?.length || 0}
          onClose={() => setShowConfirmDelete(false)}
          onConfirm={handleDeleteParent}
        />
      )}
    </div>
  );
}

// Edit Parent Modal Component
function EditParentModal({ parent, onClose, onSave }: { 
  parent: any; 
  onClose: () => void; 
  onSave: any;
}) {
  const [formData, setFormData] = useState({
    fullName: parent.fullName || "",
    email: parent.email || "",
    isActive: parent.isActive,
  });

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    try {
      await onSave({
        userId: parent._id,
        ...formData
      });
      onClose();
    } catch (error) {
      console.error("Error updating parent:", error);
    }
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        <div className="p-6">
          <div className="flex items-center justify-between mb-6">
            <h2 className="text-xl font-bold text-gray-900">Edit Parent Profile</h2>
            <button
              onClick={onClose}
              className="text-gray-400 hover:text-gray-600"
            >
              <i className="fas fa-times"></i>
            </button>
          </div>

          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Full Name *
              </label>
              <input
                type="text"
                required
                className="w-full p-2 border border-gray-300 rounded-lg"
                value={formData.fullName}
                onChange={(e) => setFormData({ ...formData, fullName: e.target.value })}
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Email Address *
              </label>
              <input
                type="email"
                required
                className="w-full p-2 border border-gray-300 rounded-lg"
                value={formData.email}
                onChange={(e) => setFormData({ ...formData, email: e.target.value })}
              />
            </div>

            <div className="flex items-center gap-2">
              <input
                type="checkbox"
                id="isActive"
                checked={formData.isActive}
                onChange={(e) => setFormData({ ...formData, isActive: e.target.checked })}
                className="rounded border-gray-300"
              />
              <label htmlFor="isActive" className="text-sm font-medium text-gray-700">
                Account is Active
              </label>
            </div>

            <div className="flex gap-3 pt-4">
              <button
                type="submit"
                className="flex-1 bg-primary-red text-white py-2.5 rounded-lg hover:bg-red-700"
              >
                Save Changes
              </button>
              <button
                type="button"
                onClick={onClose}
                className="flex-1 border border-gray-300 py-2.5 rounded-lg hover:bg-gray-50"
              >
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}

// Add Student Modal Component
function AddStudentModal({ 
  parentId, 
  parentStudents, 
  allStudents, 
  onClose, 
  onAdd 
}: { 
  parentId: Id<"users">; 
  parentStudents: any[];
  allStudents: any[];
  onClose: () => void; 
  onAdd: (studentId: string) => void;
}) {
  const [search, setSearch] = useState("");
  const [selectedStudent, setSelectedStudent] = useState<string>("");
  
  // Get student IDs already assigned to this parent
  const assignedStudentIds = useMemo(() => {
    return new Set(parentStudents.map(student => student._id));
  }, [parentStudents]);

  const filteredStudents = useMemo(() => {
    return allStudents.filter(student => 
      // Filter out already assigned students
      !assignedStudentIds.has(student._id) &&
      // Filter by search
      (search === "" ||
        student.fullName.toLowerCase().includes(search.toLowerCase()) ||
        student.gradeLevel.toLowerCase().includes(search.toLowerCase()))
    );
  }, [allStudents, search, assignedStudentIds]);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!selectedStudent) return;
    await onAdd(selectedStudent);
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        <div className="p-6">
          <div className="flex items-center justify-between mb-6">
            <h2 className="text-xl font-bold text-gray-900">Add Student to Parent</h2>
            <button
              onClick={onClose}
              className="text-gray-400 hover:text-gray-600"
            >
              <i className="fas fa-times"></i>
            </button>
          </div>

          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Search Students
              </label>
              <input
                type="text"
                className="w-full p-2 border border-gray-300 rounded-lg"
                placeholder="Search by name or grade level..."
                value={search}
                onChange={(e) => setSearch(e.target.value)}
              />
            </div>

            <div className="max-h-60 overflow-y-auto border border-gray-200 rounded-lg">
              {filteredStudents.length === 0 ? (
                <div className="p-4 text-center text-gray-500">
                  {search ? "No unassigned students found" : "All students are already assigned"}
                </div>
              ) : (
                <div className="divide-y divide-gray-100">
                  {filteredStudents.map(student => (
                    <label
                      key={student._id}
                      className={`flex items-center gap-3 p-3 cursor-pointer hover:bg-gray-50 ${
                        selectedStudent === student._id ? "bg-blue-50" : ""
                      }`}
                    >
                      <input
                        type="radio"
                        name="student"
                        value={student._id}
                        checked={selectedStudent === student._id}
                        onChange={(e) => setSelectedStudent(e.target.value)}
                        className="text-primary-red"
                      />
                      <div className="flex-1 min-w-0">
                        <div className="font-medium truncate">{student.fullName}</div>
                        <div className="text-sm text-gray-500">{student.gradeLevel}</div>
                      </div>
                      {student.parentId && student.parentId !== parentId && (
                        <span className="text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded">
                          Has other parent
                        </span>
                      )}
                    </label>
                  ))}
                </div>
              )}
            </div>

            <div className="flex gap-3 pt-4">
              <button
                type="submit"
                disabled={!selectedStudent}
                className={`flex-1 py-2.5 rounded-lg ${
                  selectedStudent
                    ? "bg-primary-red text-white hover:bg-red-700"
                    : "bg-gray-200 text-gray-400 cursor-not-allowed"
                }`}
              >
                Add Student
              </button>
              <button
                type="button"
                onClick={onClose}
                className="flex-1 border border-gray-300 py-2.5 rounded-lg hover:bg-gray-50"
              >
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}

// Confirm Delete Modal Component
function ConfirmDeleteModal({ 
  parentName, 
  studentCount, 
  onClose, 
  onConfirm 
}: { 
  parentName: string;
  studentCount: number;
  onClose: () => void;
  onConfirm: () => void;
}) {
  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-md w-full">
        <div className="p-6">
          <div className="text-center mb-6">
            <div className="w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4">
              <i className="fas fa-exclamation-triangle text-2xl text-red-600"></i>
            </div>
            <h2 className="text-xl font-bold text-gray-900 mb-2">Delete Parent Account</h2>
            <p className="text-gray-600">
              Are you sure you want to delete <span className="font-semibold">{parentName}</span>?
            </p>
          </div>

          <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
            <div className="flex items-start gap-3">
              <i className="fas fa-exclamation-circle text-red-600 mt-0.5"></i>
              <div>
                <p className="font-medium text-red-800 mb-1">This action cannot be undone</p>
                <ul className="text-sm text-red-700 space-y-1">
                  <li>• The parent account will be permanently deleted</li>
                  <li>• All associated login credentials will be removed</li>
                  {studentCount > 0 && (
                    <li>• {studentCount} student{studentCount !== 1 ? 's' : ''} will lose access to this parent account</li>
                  )}
                </ul>
              </div>
            </div>
          </div>

          <div className="flex gap-3">
            <button
              onClick={onConfirm}
              className="flex-1 bg-red-600 text-white py-2.5 rounded-lg hover:bg-red-700 font-medium"
            >
              Yes, Delete Account
            </button>
            <button
              onClick={onClose}
              className="flex-1 border border-gray-300 py-2.5 rounded-lg hover:bg-gray-50"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}
Now, here are the required admin functions for your convex/admin.ts file:

typescript
// convex/admin.ts
import { query, mutation } from "./_generated/server";
import { v } from "convex/values";

// ... your existing admin functions ...

// Get parent's students
export const getParentStudents = query({
  args: { parentId: v.id("users") },
  handler: async (ctx, args) => {
    const students = await ctx.db
      .query("students")
      .withIndex("by_parent", (q) => q.eq("parentId", args.parentId))
      .collect();
    
    return students;
  },
});

// Assign student to parent
export const assignStudentToParent = mutation({
  args: {
    parentId: v.id("users"),
    studentId: v.id("students"),
  },
  handler: async (ctx, args) => {
    // Verify parent exists and is actually a parent
    const parent = await ctx.db.get(args.parentId);
    if (!parent || parent.role !== "parent") {
      throw new Error("Invalid parent account");
    }
    
    // Verify student exists
    const student = await ctx.db.get(args.studentId);
    if (!student) {
      throw new Error("Student not found");
    }
    
    // Assign student to parent
    await ctx.db.patch(args.studentId, {
      parentId: args.parentId,
    });
    
    return args.studentId;
  },
});

// Unassign student from parent
export const unassignStudentFromParent = mutation({
  args: {
    parentId: v.id("users"),
    studentId: v.id("students"),
  },
  handler: async (ctx, args) => {
    // Verify student exists and belongs to this parent
    const student = await ctx.db.get(args.studentId);
    if (!student) {
      throw new Error("Student not found");
    }
    
    if (student.parentId !== args.parentId) {
      throw new Error("Student does not belong to this parent");
    }
    
    // Remove parent assignment
    await ctx.db.patch(args.studentId, {
      parentId: undefined,
    });
    
    return args.studentId;
  },
});
You'll also need to add this user function to your convex/users.ts:

typescript
// convex/users.ts - Add this function
import { query } from "./_generated/server";
import { v } from "convex/values";

export const getById = query({
  args: { userId: v.id("users") },
  handler: async (ctx, args) => {
    return await ctx.db.get(args.userId);
  },
});

export const update = mutation({
  args: {
    userId: v.id("users"),
    fullName: v.string(),
    email: v.string(),
    isActive: v.boolean(),
  },
  handler: async (ctx, args) => {
    const { userId, ...updates } = args;
    
    // Check if email already exists for another user
    if (updates.email) {
      const existingUser = await ctx.db
        .query("users")
        .withIndex("by_email", (q) => q.eq("email", updates.email))
        .first();
      
      if (existingUser && existingUser._id !== userId) {
        throw new Error("Email already exists for another user");
      }
    }
    
    await ctx.db.patch(userId, updates);
    return userId;
  },
});
And add this student function to your convex/students.ts:

typescript
// convex/students.ts - Add this function
import { query } from "./_generated/server";

export const listAll = query({
  handler: async (ctx) => {
    return await ctx.db
      .query("students")
      .collect();
  },
});
Key adjustments made for your schema:

Using existing tables: Leverages your users table with role-based filtering

Simple student-parent relationship: Uses the parentId field in students table

No extra fields needed: Works with your current schema structure

Role validation: Ensures the user is actually a parent

Simplified UI: Shows only the information available in your schema

The parent profile page now:

✅ Shows parent information from users table

✅ Lists all students with parentId matching the parent

✅ Allows adding/removing students (updates parentId field)

✅ Allows editing basic parent info (name, email, status)

✅ Shows student grades/letter grades if available

✅ Has proper error handling and validation

✅ Responsive design for all devices

Could not find public function for 'users:getById'. Did you forget to run `npx convex dev` or `npx convex deploy`?
You're right! I need to create the missing query functions. Let me provide all the necessary functions for your Convex backend:

1. Create convex/users.ts:
typescript
// convex/users.ts
import { query, mutation } from "./_generated/server";
import { v } from "convex/values";

// Get user by ID
export const getById = query({
  args: { userId: v.id("users") },
  handler: async (ctx, args) => {
    return await ctx.db.get(args.userId);
  },
});

// Update user
export const update = mutation({
  args: {
    userId: v.id("users"),
    fullName: v.string(),
    email: v.string(),
    isActive: v.boolean(),
  },
  handler: async (ctx, args) => {
    const { userId, ...updates } = args;
    
    // Check if email already exists for another user
    if (updates.email) {
      const existingUser = await ctx.db
        .query("users")
        .withIndex("by_email", (q) => q.eq("email", updates.email))
        .first();
      
      if (existingUser && existingUser._id !== userId) {
        throw new Error("Email already exists for another user");
      }
    }
    
    await ctx.db.patch(userId, updates);
    return userId;
  },
});

// List all users (for admin)
export const listAll = query({
  handler: async (ctx) => {
    return await ctx.db
      .query("users")
      .collect();
  },
});
2. Update convex/admin.ts with all required functions:
typescript
// convex/admin.ts
import { query, mutation } from "./_generated/server";
import { v } from "convex/values";
import bcrypt from "bcryptjs";

const hashPassword = async (password: string): Promise<string> => {
  return await bcrypt.hash(password, 10);
};

// Your existing functions
export const listParents = query({
  handler: async (ctx) => {
    return ctx.db
      .query("users")
      .filter(q => q.eq(q.field("role"), "parent"))
      .collect();
  },
});

export const listStaff = query({
  handler: async (ctx) => {
    return ctx.db
      .query("users")
      .filter(q => q.eq(q.field("role"), "staff"))
      .collect();
  },
});

export const toggleUserStatus = mutation({
  args: {
    userId: v.id("users"),
    status: v.boolean(),
  },
  handler: async (ctx, args) => {
    await ctx.db.patch(args.userId, {
      isActive: args.status,
    });
  },
});

export const updateUserRole = mutation({
  args: {
    userId: v.id("users"),
    newRole: v.union(v.literal("parent"), v.literal("staff"), v.literal("admin")),
  },
  handler: async (ctx, args) => {
    const user = await ctx.db.get(args.userId);
    if (!user) throw new Error("User not found");
    
    await ctx.db.patch(args.userId, { role: args.newRole });
    return args.userId;
  },
});

export const deleteUser = mutation({
  args: {
    userId: v.id("users"),
  },
  handler: async (ctx, args) => {
    const user = await ctx.db.get(args.userId);
    if (!user) throw new Error("User not found");
    
    await ctx.db.delete(args.userId);
    return args.userId;
  },
});

export const createStaffAccount = mutation({
  args: {
    email: v.string(),
    password: v.string(),
    fullName: v.string(),
    position: v.optional(v.string()),
    department: v.optional(v.string()),
  },
  handler: async (ctx, args) => {
    // Check if email already exists
    const existing = await ctx.db
      .query("users")
      .withIndex("by_email", (q) => q.eq("email", args.email))
      .first();
    
    if (existing) throw new Error("Email already exists");

    // Create the staff account
    const userId = await ctx.db.insert("users", {
      email: args.email,
      passwordHash: await hashPassword(args.password),
      fullName: args.fullName,
      role: "staff",
      isActive: true,
    });

    return userId;
  },
});

// NEW FUNCTIONS FOR PARENT PROFILE

// Get parent's students
export const getParentStudents = query({
  args: { parentId: v.id("users") },
  handler: async (ctx, args) => {
    const students = await ctx.db
      .query("students")
      .withIndex("by_parent", (q) => q.eq("parentId", args.parentId))
      .collect();
    
    return students;
  },
});

// Get all unassigned students (students without parents)
export const getUnassignedStudents = query({
  handler: async (ctx) => {
    const students = await ctx.db
      .query("students")
      .filter(q => q.eq(q.field("parentId"), undefined))
      .collect();
    
    return students;
  },
});

// Assign student to parent
export const assignStudentToParent = mutation({
  args: {
    parentId: v.id("users"),
    studentId: v.id("students"),
  },
  handler: async (ctx, args) => {
    // Verify parent exists and is actually a parent
    const parent = await ctx.db.get(args.parentId);
    if (!parent || parent.role !== "parent") {
      throw new Error("Invalid parent account");
    }
    
    // Verify student exists
    const student = await ctx.db.get(args.studentId);
    if (!student) {
      throw new Error("Student not found");
    }
    
    // Assign student to parent
    await ctx.db.patch(args.studentId, {
      parentId: args.parentId,
    });
    
    return args.studentId;
  },
});

// Unassign student from parent
export const unassignStudentFromParent = mutation({
  args: {
    parentId: v.id("users"),
    studentId: v.id("students"),
  },
  handler: async (ctx, args) => {
    // Verify student exists and belongs to this parent
    const student = await ctx.db.get(args.studentId);
    if (!student) {
      throw new Error("Student not found");
    }
    
    if (student.parentId !== args.parentId) {
      throw new Error("Student does not belong to this parent");
    }
    
    // Remove parent assignment
    await ctx.db.patch(args.studentId, {
      parentId: undefined,
    });
    
    return args.studentId;
  },
});

// Get parent details with validation
export const getParentDetails = query({
  args: { parentId: v.id("users") },
  handler: async (ctx, args) => {
    const parent = await ctx.db.get(args.parentId);
    if (!parent || parent.role !== "parent") return null;
    
    return parent;
  },
});

// Update parent information (using the users.update function)
export const updateParent = mutation({
  args: {
    parentId: v.id("users"),
    fullName: v.string(),
    email: v.string(),
    isActive: v.boolean(),
  },
  handler: async (ctx, args) => {
    const { parentId, ...updates } = args;
    
    // Check if email already exists for another user
    if (updates.email) {
      const existingUser = await ctx.db
        .query("users")
        .withIndex("by_email", (q) => q.eq("email", updates.email))
        .first();
      
      if (existingUser && existingUser._id !== parentId) {
        throw new Error("Email already exists for another user");
      }
    }
    
    await ctx.db.patch(parentId, updates);
    return parentId;
  },
});
3. Create convex/students.ts:
typescript
// convex/students.ts
import { query } from "./_generated/server";

export const listAll = query({
  handler: async (ctx) => {
    return await ctx.db
      .query("students")
      .collect();
  },
});

// Get student by ID
export const getById = query({
  args: { studentId: v.id("students") },
  handler: async (ctx, args) => {
    return await ctx.db.get(args.studentId);
  },
});
4. Update your API exports in convex/_generated/api.d.ts (or run npx convex dev):
Make sure you export all the functions from your Convex files. Your convex/_generated/api.d.ts should have these imports after you run npx convex dev:

5. Run Convex development mode:
bash
npx convex dev
This will:

Generate the TypeScript types for all your functions

Deploy the functions to your Convex development environment

Update the API types in convex/_generated/api.d.ts

6. Update the imports in your AdminParentProfile.tsx:
Since we're using the users.update function from the users module, update the import in your AdminParentProfile.tsx:

tsx
// Change this line:
const updateUser = useMutation(api.users.update);

// And make sure you have this import:
import { api } from "../../convex/_generated/api";
7. If you still get the error, check:
Make sure all functions are exported: Each function in your .ts files should have export keyword

Run convex dev: npx convex dev in your terminal

Check convex.json: Make sure it points to the right project

Restart dev server: Sometimes the TypeScript server needs a restart

Quick fix - If you want to use admin functions instead:
Alternatively, you can modify the AdminParentProfile.tsx to use only admin functions:

tsx
// In AdminParentProfile.tsx, change:
const updateUser = useMutation(api.admin.updateParent); // Use admin.updateParent instead of users.update
This way you're using the updateParent function we just added to admin.ts instead of trying to use a users.update function.

The key is to make sure:

All functions are properly exported from their respective .ts files

You run npx convex dev to deploy and generate types

You're using the correct import path in your React components

import { useAuth } from "../hooks/useAuth";
import { Navigate, Link } from "react-router-dom";

export default function StaffDashboard() {
  const { user, role, isLoading, logout } = useAuth();

  if (isLoading) return null;
  if (!user || role !== "staff") return <Navigate to="/login" />;

  return (
    <div className="max-w-6xl mx-auto">
      <div className="mb-8">
        <h1 className="text-3xl font-bold text-gray-900 mb-2">
          Welcome, {user.fullName}
        </h1>
        <p className="text-gray-600">
          Staff Dashboard • Manage grades and student performance
        </p>
      </div>

      {/* Quick Actions */}
      <div className="grid grid-cols-1 lg:grid-cols-1 gap-8">
        {/* Left Column */}
        <div className="space-y-6">
          <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <h2 className="text-xl font-bold text-gray-900 mb-4">Quick Actions</h2>
            <div className="space-y-3">
              <Link
                to="/staff/grades"
                className="flex items-center justify-between p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors group"
              >
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center">
                    <i className="fas fa-edit text-blue-600"></i>
                  </div>
                  <div>
                    <h3 className="font-medium text-gray-900">Enter Grades</h3>
                    <p className="text-sm text-gray-500">Update student assessments</p>
                  </div>
                </div>
                <i className="fas fa-arrow-right text-gray-400 group-hover:text-blue-600"></i>
              </Link>

              <Link
                to="/staff/performance"
                className="flex items-center justify-between p-4 bg-green-50 hover:bg-green-100 rounded-lg transition-colors group"
              >
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center">
                    <i className="fas fa-chart-line text-green-600"></i>
                  </div>
                  <div>
                    <h3 className="font-medium text-gray-900">View Performance</h3>
                    <p className="text-sm text-gray-500">Monitor student progress</p>
                  </div>
                </div>
                <i className="fas fa-arrow-right text-gray-400 group-hover:text-green-600"></i>
              </Link>

              <Link
                to="/account"
                className="flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors group"
              >
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center">
                    <i className="fas fa-cog text-gray-600"></i>
                  </div>
                  <div>
                    <h3 className="font-medium text-gray-900">Account Settings</h3>
                    <p className="text-sm text-gray-500">Update profile & preferences</p>
                  </div>
                </div>
                <i className="fas fa-arrow-right text-gray-400 group-hover:text-gray-600"></i>
              </Link>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

create an admin dashboard page similar to this
Here's an admin dashboard page similar to your staff dashboard:

tsx
// pages/AdminDashboard.tsx
import { useAuth } from "../hooks/useAuth";
import { Navigate, Link } from "react-router-dom";
import { useQuery } from "convex/react";
import { api } from "../convex/_generated/api";

export default function AdminDashboard() {
  const { user, role, isLoading } = useAuth();

  // Fetch dashboard statistics
  const stats = useQuery(api.admin.getDashboardStats);
  const recentRegistrations = useQuery(api.admin.getRecentRegistrations);
  const recentMessages = useQuery(api.admin.getRecentMessages);

  if (isLoading) return null;
  if (!user || role !== "admin") return <Navigate to="/login" />;

  return (
    <div className="max-w-7xl mx-auto px-4 py-8">
      {/* Welcome Header */}
      <div className="mb-8">
        <h1 className="text-3xl font-bold text-gray-900 mb-2">
          Welcome, {user.fullName}
        </h1>
        <p className="text-gray-600">
          Administrator Dashboard • Manage the entire school system
        </p>
      </div>

      {/* Stats Overview */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Total Users</p>
              <p className="text-2xl font-bold text-gray-900">
                {stats?.totalUsers || 0}
              </p>
            </div>
            <div className="w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center">
              <i className="fas fa-users text-blue-600 text-xl"></i>
            </div>
          </div>
          <div className="mt-4 flex items-center text-sm">
            <span className="text-green-600 font-medium">
              {stats?.activeUsers || 0} active
            </span>
            <span className="mx-2 text-gray-300">•</span>
            <span className="text-gray-500">
              {stats?.newUsersThisMonth || 0} this month
            </span>
          </div>
        </div>

        <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Pending Registrations</p>
              <p className="text-2xl font-bold text-gray-900">
                {stats?.pendingRegistrations || 0}
              </p>
            </div>
            <div className="w-12 h-12 rounded-full bg-amber-50 flex items-center justify-center">
              <i className="fas fa-clipboard-list text-amber-600 text-xl"></i>
            </div>
          </div>
          <div className="mt-4">
            <Link
              to="/admin/registrations"
              className="text-sm text-primary-red hover:text-red-700 font-medium flex items-center gap-1"
            >
              Review applications <i className="fas fa-arrow-right ml-1"></i>
            </Link>
          </div>
        </div>

        <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Unread Messages</p>
              <p className="text-2xl font-bold text-gray-900">
                {stats?.unreadMessages || 0}
              </p>
            </div>
            <div className="w-12 h-12 rounded-full bg-purple-50 flex items-center justify-center">
              <i className="fas fa-envelope text-purple-600 text-xl"></i>
            </div>
          </div>
          <div className="mt-4">
            <Link
              to="/admin/messages"
              className="text-sm text-primary-red hover:text-red-700 font-medium flex items-center gap-1"
            >
              View messages <i className="fas fa-arrow-right ml-1"></i>
            </Link>
          </div>
        </div>

        <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">Active Students</p>
              <p className="text-2xl font-bold text-gray-900">
                {stats?.totalStudents || 0}
              </p>
            </div>
            <div className="w-12 h-12 rounded-full bg-green-50 flex items-center justify-center">
              <i className="fas fa-user-graduate text-green-600 text-xl"></i>
            </div>
          </div>
          <div className="mt-4 flex items-center text-sm">
            <span className="text-gray-500">
              {stats?.activeStudents || 0} currently enrolled
            </span>
          </div>
        </div>
      </div>

      {/* Quick Actions & Recent Activity */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
        {/* Quick Actions */}
        <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
          <h2 className="text-xl font-bold text-gray-900 mb-4">Quick Actions</h2>
          <div className="space-y-3">
            <Link
              to="/admin/registrations"
              className="flex items-center justify-between p-4 bg-amber-50 hover:bg-amber-100 rounded-lg transition-colors group"
            >
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center">
                  <i className="fas fa-clipboard-check text-amber-600"></i>
                </div>
                <div>
                  <h3 className="font-medium text-gray-900">Review Registrations</h3>
                  <p className="text-sm text-gray-500">
                    Process new student applications
                  </p>
                </div>
              </div>
              <i className="fas fa-arrow-right text-gray-400 group-hover:text-amber-600"></i>
            </Link>

            <Link
              to="/admin/manage-accounts"
              className="flex items-center justify-between p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors group"
            >
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center">
                  <i className="fas fa-user-cog text-blue-600"></i>
                </div>
                <div>
                  <h3 className="font-medium text-gray-900">Manage Accounts</h3>
                  <p className="text-sm text-gray-500">
                    Manage parent and staff accounts
                  </p>
                </div>
              </div>
              <i className="fas fa-arrow-right text-gray-400 group-hover:text-blue-600"></i>
            </Link>

            <Link
              to="/admin/messages"
              className="flex items-center justify-between p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors group"
            >
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center">
                  <i className="fas fa-envelope-open-text text-purple-600"></i>
                </div>
                <div>
                  <h3 className="font-medium text-gray-900">View Messages</h3>
                  <p className="text-sm text-gray-500">
                    Read and respond to inquiries
                  </p>
                </div>
              </div>
              <i className="fas fa-arrow-right text-gray-400 group-hover:text-purple-600"></i>
            </Link>

            <Link
              to="/account"
              className="flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors group"
            >
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center">
                  <i className="fas fa-cog text-gray-600"></i>
                </div>
                <div>
                  <h3 className="font-medium text-gray-900">Account Settings</h3>
                  <p className="text-sm text-gray-500">
                    Update profile & preferences
                  </p>
                </div>
              </div>
              <i className="fas fa-arrow-right text-gray-400 group-hover:text-gray-600"></i>
            </Link>
          </div>
        </div>

        {/* Recent Activity */}
        <div className="space-y-6">
          {/* Recent Registrations */}
          <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-xl font-bold text-gray-900">Recent Registrations</h2>
              <Link
                to="/admin/registrations"
                className="text-sm text-primary-red hover:text-red-700 font-medium"
              >
                View all
              </Link>
            </div>
            {recentRegistrations === undefined ? (
              <div className="text-center py-4">
                <i className="fas fa-spinner fa-spin text-primary-red mr-2"></i>
                <span className="text-gray-600">Loading...</span>
              </div>
            ) : recentRegistrations.length === 0 ? (
              <div className="text-center py-4 text-gray-500">
                No recent registrations
              </div>
            ) : (
              <div className="space-y-3">
                {recentRegistrations.slice(0, 5).map((registration) => (
                  <div
                    key={registration._id}
                    className="flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg"
                  >
                    <div className="flex items-center gap-3">
                      <div className="w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center">
                        <span className="text-blue-600 font-medium">
                          {registration.studentFirstName?.charAt(0) || "?"}
                        </span>
                      </div>
                      <div>
                        <p className="font-medium text-gray-900">
                          {registration.studentFirstName} {registration.studentLastName}
                        </p>
                        <p className="text-sm text-gray-500">
                          {registration.intendedGradeLevel || "No grade specified"}
                        </p>
                      </div>
                    </div>
                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                      registration.status === "submitted"
                        ? "bg-amber-100 text-amber-800"
                        : registration.status === "approved"
                        ? "bg-green-100 text-green-800"
                        : registration.status === "rejected"
                        ? "bg-red-100 text-red-800"
                        : "bg-gray-100 text-gray-800"
                    }`}>
                      {registration.status.replace("_", " ")}
                    </span>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* Recent Messages */}
          <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-xl font-bold text-gray-900">Recent Messages</h2>
              <Link
                to="/admin/messages"
                className="text-sm text-primary-red hover:text-red-700 font-medium"
              >
                View all
              </Link>
            </div>
            {recentMessages === undefined ? (
              <div className="text-center py-4">
                <i className="fas fa-spinner fa-spin text-primary-red mr-2"></i>
                <span className="text-gray-600">Loading...</span>
              </div>
            ) : recentMessages.length === 0 ? (
              <div className="text-center py-4 text-gray-500">
                No recent messages
              </div>
            ) : (
              <div className="space-y-3">
                {recentMessages.slice(0, 5).map((message) => (
                  <Link
                    key={message._id}
                    to="/admin/messages"
                    className="flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg group"
                  >
                    <div className="flex items-center gap-3">
                      <div className="w-10 h-10 rounded-full bg-purple-50 flex items-center justify-center">
                        <i className="fas fa-envelope text-purple-600"></i>
                      </div>
                      <div className="min-w-0">
                        <p className="font-medium text-gray-900 truncate">
                          {message.name}
                        </p>
                        <p className="text-sm text-gray-500 truncate">
                          {message.email}
                        </p>
                      </div>
                    </div>
                    <div className="flex items-center gap-2">
                      <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                        message.status === "new"
                          ? "bg-blue-100 text-blue-800"
                          : message.status === "read"
                          ? "bg-gray-100 text-gray-800"
                          : "bg-gray-100 text-gray-800"
                      }`}>
                        {message.status}
                      </span>
                      <i className="fas fa-chevron-right text-gray-400 group-hover:text-primary-red"></i>
                    </div>
                  </Link>
                ))}
              </div>
            )}
          </div>
        </div>
      </div>

      {/* System Status */}
      <div className="mt-8 bg-white rounded-xl shadow-sm border border-gray-200 p-6">
        <h2 className="text-xl font-bold text-gray-900 mb-4">System Status</h2>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
            <div className="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center">
              <i className="fas fa-database text-green-600"></i>
            </div>
            <div>
              <p className="font-medium text-gray-900">Database</p>
              <p className="text-sm text-green-600">Operational</p>
            </div>
          </div>
          <div className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
            <div className="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center">
              <i className="fas fa-server text-green-600"></i>
            </div>
            <div>
              <p className="font-medium text-gray-900">API Server</p>
              <p className="text-sm text-green-600">Online</p>
            </div>
          </div>
          <div className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
            <div className="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
              <i className="fas fa-users text-blue-600"></i>
            </div>
            <div>
              <p className="font-medium text-gray-900">Active Users</p>
              <p className="text-sm text-blue-600">{stats?.activeUsers || 0} online</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
Now, add these query functions to your convex/admin.ts file:

typescript
// Add these to your convex/admin.ts file

// Get dashboard statistics
export const getDashboardStats = query({
  handler: async (ctx) => {
    // Get total users
    const allUsers = await ctx.db.query("users").collect();
    const totalUsers = allUsers.length;
    const activeUsers = allUsers.filter(u => u.isActive).length;
    
    // Get new users this month (users created in current month)
    const currentMonth = new Date().getMonth();
    const currentYear = new Date().getFullYear();
    const newUsersThisMonth = allUsers.filter(user => {
      const creationDate = new Date(user._creationTime);
      return creationDate.getMonth() === currentMonth && 
             creationDate.getFullYear() === currentYear;
    }).length;
    
    // Get pending registrations
    const pendingRegistrations = await ctx.db
      .query("studentApplications")
      .withIndex("by_status", (q) => q.eq("status", "submitted"))
      .collect();
    
    // Get unread messages
    const unreadMessages = await ctx.db
      .query("messages")
      .withIndex("by_status", (q) => q.eq("status", "new"))
      .collect();
    
    // Get total students
    const totalStudents = await ctx.db.query("students").collect();
    const activeStudents = totalStudents.length; // Assuming all are active
    
    return {
      totalUsers,
      activeUsers,
      newUsersThisMonth,
      pendingRegistrations: pendingRegistrations.length,
      unreadMessages: unreadMessages.length,
      totalStudents: totalStudents.length,
      activeStudents,
    };
  },
});

// Get recent registrations
export const getRecentRegistrations = query({
  handler: async (ctx) => {
    const registrations = await ctx.db
      .query("studentApplications")
      .order("desc")
      .take(10);
    
    return registrations;
  },
});

// Get recent messages
export const getRecentMessages = query({
  handler: async (ctx) => {
    const messages = await ctx.db
      .query("messages")
      .withIndex("by_createdAt", (q) => q.gt("createdAt", 0))
      .order("desc")
      .take(10);
    
    return messages;
  },
});
Key Features of this Admin Dashboard:

Stats Overview Cards: Shows key metrics at a glance

Quick Actions: Easy access to common admin tasks

Recent Registrations: Shows latest student applications with status badges

Recent Messages: Displays latest inquiries from users

System Status: Shows backend service status

Responsive Design: Works on all screen sizes

Loading States: Shows loading indicators while fetching data

Status Badges: Color-coded badges for different statuses

Navigation Links: Easy access to detailed pages

Consistent Styling: Matches your staff dashboard design

To use this dashboard:

Add the route to your App.tsx:

tsx
<Route path="/admin" element={<AdminDashboard />} />
Make sure the admin functions are exported and deployed with npx convex dev

Update your AdminSidePanel.tsx to link to the dashboard:

tsx
<NavLink to="/admin" className={linkClass}>
  <i className="fas fa-chart-line w-5"></i>
  Dashboard
</NavLink>
This admin dashboard provides a comprehensive overview of the system with quick access to all major administrative functions.

give this page a similar style to the others

import { useState } from "react";
import { Link, Navigate } from "react-router-dom";
import { useQuery } from "convex/react";
import { api } from "../../convex/_generated/api";
import { useAuth } from "../hooks/useAuth";

const TABS = ["submitted", "approved", "rejected"] as const;
type Tab = typeof TABS[number];

type SortOption =
  | "date-new"
  | "date-old"
  | "name-asc"
  | "name-desc";

export default function AdminRegistrations() {
  const { user } = useAuth();
  const [activeTab, setActiveTab] = useState<Tab>("submitted");
  const [search, setSearch] = useState("");
  const [sort, setSort] = useState<SortOption>("date-new");

  if (user === undefined) return null;
  if (!user || user.role !== "admin") {
    return <Navigate to="/login" />;
  }

  const registrations = useQuery(api.studentApplications.listByStatus, {
    status: activeTab,
  });

  const filtered = (registrations ?? [])
    .filter(r => {
      const q = search.toLowerCase();
      return (
        r.studentFirstName.toLowerCase().includes(q) ||
        r.studentLastName.toLowerCase().includes(q) ||
        r.primaryParentName.toLowerCase().includes(q)
      );
    })
    .sort((a, b) => {
      if (sort === "name-asc") {
        return (
          `${a.studentFirstName} ${a.studentLastName}`.localeCompare(
            `${b.studentFirstName} ${b.studentLastName}`
          )
        );
      }

      if (sort === "name-desc") {
        return (
          `${b.studentFirstName} ${b.studentLastName}`.localeCompare(
            `${a.studentFirstName} ${a.studentLastName}`
          )
        );
      }

      if (sort === "date-old") {
        return a.createdAt - b.createdAt;
      }

      return b.createdAt - a.createdAt; // date-new
    });

  return (
    <div className="container-wide px-4 py-10 space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <h1 className="text-2xl font-bold">Registrations</h1>
        <Link to="/admin" className="btn-secondary">
          Back to Dashboard
        </Link>
      </div>

      {/* Tabs */}
      <div className="flex gap-6 border-b">
        {TABS.map(tab => (
          <button
            key={tab}
            onClick={() => setActiveTab(tab)}
            className={`pb-2 font-medium capitalize ${
              activeTab === tab
                ? "border-b-2 border-red-600 text-red-600"
                : "text-gray-600 hover:text-black"
            }`}
          >
            {tab}
          </button>
        ))}
      </div>

      {/* Controls */}
      <div className="flex flex-col md:flex-row gap-4 justify-between items-center">
        <input
          type="text"
          placeholder="Search student or parent..."
          value={search}
          onChange={e => setSearch(e.target.value)}
          className="input-field md:w-80"
        />

        <select
          value={sort}
          onChange={e => setSort(e.target.value as SortOption)}
          className="input-field md:w-64"
        >
          <option value="date-new">Newest first</option>
          <option value="date-old">Oldest first</option>
          <option value="name-asc">Student name A–Z</option>
          <option value="name-desc">Student name Z–A</option>
        </select>
      </div>

      {/* Table */}
      {registrations === undefined ? (
        <div>Loading registrations…</div>
      ) : filtered.length === 0 ? (
        <div className="text-gray-600">No matching registrations.</div>
      ) : (
        <div className="overflow-x-auto">
          <table className="w-full border rounded-xl overflow-hidden">
            <thead className="bg-gray-50 text-left">
              <tr>
                <th className="px-4 py-3 text-sm font-serif text-red-600">
                  Student
                </th>
                <th className="px-4 py-3 text-sm font-serif text-red-600">
                  Parent
                </th>
                <th className="px-4 py-3 text-sm font-serif text-red-600">
                  Program
                </th>
                <th className="px-4 py-3 text-sm font-serif text-red-600">
                  Submitted
                </th>
              </tr>
            </thead>
            <tbody>
              {filtered.map(r => (
                <tr
                  key={r._id}
                  className="border-t hover:bg-red-50 transition"
                >
                  <td className="px-4 py-3 font-medium">
                    <Link
                      to={`/admin/registrations/${r._id}`}
                      className="hover:underline"
                    >
                      {r.studentFirstName} {r.studentLastName}
                    </Link>
                  </td>
                  <td className="px-4 py-3">
                    {r.primaryParentName}
                  </td>
                  <td className="px-4 py-3">
                    {r.programType}
                  </td>
                  <td className="px-4 py-3 text-sm text-gray-600">
                    {new Date(r.createdAt).toLocaleDateString()}
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      )}
    </div>
  );
}
Length limit reached. Please start a new chat.

